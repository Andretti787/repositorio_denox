****************************************************************************
Location : Local or Network Folders
Host     : PORTATIL-INFORM
Path     : C:\Código Fuente\Reporting SAGE\V12\ZSBONFACPF.rpt
****************************************************************************


Report Information
    Version:    14.0
    Title:    Factura Cliente formato Retrato (con subinforme)
    Printer:    No Printer

Main Body

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    X3ETA
            Data Type:    String
            Description:    Code de l'état
            List Type:    Static
            List Values:    NONINPUT
            Default Values:    NONINPUT

        Parameter:    X3DOS
            Data Type:    String
            Description:    Dossier
            List Type:    Static
            List Values:    GX3APP;aydaix05.sage.fr.adinternal.com;2050;150;FRA
            Default Values:    GX3APP;aydaix05.sage.fr.adinternal.com;2050;150;FRA

        Parameter:    X3OPE
            Data Type:    String
            Description:    Nom & Prénom de l'opérateur
            List Type:    Static
            List Values:    [Opérateur]
            Default Values:    [Opérateur]

        Parameter:    X3TIT
            Data Type:    String
            Description:    Titre de l'état
            List Type:    Static
            List Values:    ARC
            Default Values:    ARC

        Parameter:    X3EDT
            Data Type:    String
            Description:    Information éditeur
            List Type:    Static
            List Values:    Adonix & Prodstar
            Default Values:    Adonix & Prodstar

        Parameter:    X3CLI
            Data Type:    String
            Description:    Informations client
            List Type:    Static
            List Values:     
            Default Values:     

        Parameter:    X3LAN
            Data Type:    String
            Description:    Langue
            List Type:    Static
            List Values:    FRA
            Default Values:    FRA

        Parameter:    clientdeb
            Data Type:    String
            Description:    N° Tiers début ?
            List Type:    Static
            List Values:     
            Default Values:     

        Parameter:    clientfin
            Data Type:    String
            Description:    N° Tiers Fin ?
            List Type:    Static
            List Values:    ZZZZZZZZZZ
            Default Values:    ZZZZZZZZZZ

        Parameter:    facturedeb
            Data Type:    String
            Description:    N° facture début
            List Type:    Static
            List Values:     
            Default Values:     

        Parameter:    facturefin
            Data Type:    String
            Description:    N° facture fin
            List Type:    Static
            List Values:    zzzzzzzzzzzzzzz
            Default Values:    zzzzzzzzzzzzzzz

        Parameter:    sitedeb
            Data Type:    String
            Description:    Site début
            List Type:    Static
            List Values:     
            Default Values:     

        Parameter:    sitefin
            Data Type:    String
            Description:    Site fin
            List Type:    Static
            List Values:    zzz
            Default Values:    zzz

        Parameter:    impselections
            Data Type:    Number
            Description:    Impression des selections ?
            List Type:    Static
            List Values:    1
            Default Values:    1

        Parameter:    typedeb
            Data Type:    Number
            Description:    Type facture début
            List Type:    Static
            List Values:    1
            Default Values:    1

        Parameter:    typefin
            Data Type:    Number
            Description:    type facture fin
            List Type:    Static
            List Values:    3
            Default Values:    3

        Parameter:    usr
            Data Type:    String
            List Type:    Static

        Parameter:    etat
            Data Type:    String
            List Type:    Static

        Parameter:    numedt
            Data Type:    Number
            List Type:    Static

        Parameter:    euro
            Data Type:    String
            Description:    Devise euro
            List Type:    Static
            List Values:    EUR
            Default Values:    EUR

        Parameter:    datedeb
            Data Type:    Date
            List Type:    Static
            List Values:    22/02/2002 0:00:00
            Default Values:    22/02/2002 0:00:00

        Parameter:    datefin
            Data Type:    Date
            List Type:    Static
            List Values:    22/02/2002 0:00:00
            Default Values:    22/02/2002 0:00:00

        Parameter:    codact
            Data Type:    Number
            Description:    code activité DEB actif ?
            List Type:    Static
            List Values:    1
            Default Values:    1

        Parameter:    X3FCT
            Data Type:    String
            Description:    Fonction
            List Type:    Static

        Parameter:    X3PRF
            Data Type:    String
            Description:    Profil fonction
            List Type:    Static

        Parameter:    tauxagios
            Data Type:    Number
            Description:    Taux d'agios
            List Type:    Static
            List Values:    0
            Default Values:    0

        Parameter:    tauxescompte
            Data Type:    Number
            Description:    Taux d'escompte
            List Type:    Static
            List Values:    0
            Default Values:    0

        Parameter:    seqedt
            Data Type:    Number
            Description:    Séquence
            List Type:    Static
            List Values:    0
            Default Values:    0

        Parameter:    NBMAXTARIF
            Data Type:    Number
            Description:    Nombre maximum de colonnes Tarif
            List Type:    Static
            List Values:    3
            Default Values:    3

        Parameter:    mention
            Data Type:    Number
            Description:    Mention filigrane ?
            List Type:    Static

        Parameter:    mentionpays
            Data Type:    String
            List Type:    Static

        Parameter:    mentionmontant
            Data Type:    String
            List Type:    Static

        Parameter:    paramsddprn
            Data Type:    String
            Description:    SDDPRN actif ?
            List Type:    Static

        Parameter:    impcabecera
            Data Type:    Number
            Description:    Especificar impcabecera:
            List Type:    Static

        Parameter:    UsarPrecioNeto
            Data Type:    Number
            Description:    Especificar UsarPrecioNeto:
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.FACILITY
            Connection:    Connection #1
            Used Columns:    {FACILITY.FCY_0} : String[12]
                             {FACILITY.LEGCPY_0} : String[12]
                             {FACILITY.BPAADD_0} : String[12]

        Table:    x3famesa.FAMESAOF.BPARTNER
            Connection:    Connection #1
            Used Columns:    {BPARTNER.BPRNUM_0} : String[32]
                             {BPARTNER.BPRNAM_0} : String[72]
                             {BPARTNER.LAN_0} : String[8]
                             {BPARTNER.LEGETT_0} : Number

        Table:    x3famesa.FAMESAOF.ITMSALES
            Connection:    Connection #1
            Used Columns:    {ITMSALES.ITMREF_0} : String[42]

        Table:    x3famesa.FAMESAOF.SINVOICE
            Connection:    Connection #1
            Used Columns:    {SINVOICE.SIVTYP_0} : String[12]
                             {SINVOICE.INVTYP_0} : Number
                             {SINVOICE.NUM_0} : String[42]
                             {SINVOICE.BPR_0} : String[32]
                             {SINVOICE.CPY_0} : String[12]
                             {SINVOICE.FCY_0} : String[12]
                             {SINVOICE.GTE_0} : String[12]
                             {SINVOICE.ACCDAT_0} : Date
                             {SINVOICE.CUR_0} : String[8]
                             {SINVOICE.CURLED_0} : String[8]
                             {SINVOICE.CURLED_1} : String[8]
                             {SINVOICE.CURLED_2} : String[8]
                             {SINVOICE.CURLED_3} : String[8]
                             {SINVOICE.CURLED_4} : String[8]
                             {SINVOICE.CURLED_5} : String[8]
                             {SINVOICE.CURLED_6} : String[8]
                             {SINVOICE.CURLED_7} : String[8]
                             {SINVOICE.CURLED_8} : String[8]
                             {SINVOICE.CURLED_9} : String[8]
                             {SINVOICE.RATMLT_0} : Number
                             {SINVOICE.RATMLT_1} : Number
                             {SINVOICE.RATMLT_2} : Number
                             {SINVOICE.RATMLT_3} : Number
                             {SINVOICE.RATMLT_4} : Number
                             {SINVOICE.RATMLT_5} : Number
                             {SINVOICE.RATMLT_6} : Number
                             {SINVOICE.RATMLT_7} : Number
                             {SINVOICE.RATMLT_8} : Number
                             {SINVOICE.RATMLT_9} : Number
                             {SINVOICE.RATDIV_0} : Number
                             {SINVOICE.RATDIV_1} : Number
                             {SINVOICE.RATDIV_2} : Number
                             {SINVOICE.RATDIV_3} : Number
                             {SINVOICE.RATDIV_4} : Number
                             {SINVOICE.RATDIV_5} : Number
                             {SINVOICE.RATDIV_6} : Number
                             {SINVOICE.RATDIV_7} : Number
                             {SINVOICE.RATDIV_8} : Number
                             {SINVOICE.RATDIV_9} : Number
                             {SINVOICE.BPRPAY_0} : String[32]
                             {SINVOICE.BPYNAM_0} : String[72]
                             {SINVOICE.BPYADDLIG_0} : String[102]
                             {SINVOICE.BPYADDLIG_1} : String[102]
                             {SINVOICE.BPYADDLIG_2} : String[102]
                             {SINVOICE.BPYPOSCOD_0} : String[22]
                             {SINVOICE.BPYCTY_0} : String[82]
                             {SINVOICE.BPYSAT_0} : String[72]
                             {SINVOICE.BPRFCT_0} : String[32]
                             {SINVOICE.PTE_0} : String[32]
                             {SINVOICE.DEP_0} : String[12]
                             {SINVOICE.VAC_0} : String[12]
                             {SINVOICE.STA_0} : Number
                             {SINVOICE.AMTATI_0} : Number
                             {SINVOICE.AMTNOT_0} : Number
                             {SINVOICE.BPAINV_0} : String[12]
                             {SINVOICE.BPRNAM_0} : String[72]
                             {SINVOICE.BPAADDLIG_0} : String[102]
                             {SINVOICE.BPAADDLIG_1} : String[102]
                             {SINVOICE.BPAADDLIG_2} : String[102]
                             {SINVOICE.POSCOD_0} : String[22]
                             {SINVOICE.CTY_0} : String[82]
                             {SINVOICE.SAT_0} : String[72]
                             {SINVOICE.CRY_0} : String[8]
                             {SINVOICE.CRYNAM_0} : String[82]
                             {SINVOICE.CSHVAT_0} : Number
                             {SINVOICE.ZBANK_0} : String[12]

        Table:    x3famesa.FAMESAOF.SINVOICED
            Connection:    Connection #1
            Used Columns:    {SINVOICED.NUM_0} : String[42]
                             {SINVOICED.SIDLIN_0} : Number
                             {SINVOICED.SOHNUM_0} : String[42]
                             {SINVOICED.SOPLIN_0} : Number
                             {SINVOICED.SOQSEQ_0} : Number
                             {SINVOICED.SDHNUM_0} : String[42]
                             {SINVOICED.SIHORINUM_0} : String[42]
                             {SINVOICED.BPCINV_0} : String[32]
                             {SINVOICED.ITMREF_0} : String[42]
                             {SINVOICED.ITMDES_0} : String[82]
                             {SINVOICED.GROPRI_0} : Number
                             {SINVOICED.PRIREN_0} : Number
                             {SINVOICED.NETPRI_0} : Number
                             {SINVOICED.DISCRGVAL1_0} : Number
                             {SINVOICED.DISCRGVAL2_0} : Number
                             {SINVOICED.DISCRGVAL3_0} : Number
                             {SINVOICED.DISCRGVAL4_0} : Number
                             {SINVOICED.AMTNOTLIN_0} : Number
                             {SINVOICED.AMTATILIN_0} : Number
                             {SINVOICED.QTY_0} : Number
                             {SINVOICED.SAU_0} : String[8]
                             {SINVOICED.LINTYP_0} : Number
                             {SINVOICED.FOCFLG_0} : Number
                             {SINVOICED.SIDTEX_0} : String[26]
                             {SINVOICED.INVPRNBOM_0} : Number

        Table:    x3famesa.FAMESAOF.SINVOICEV
            Connection:    Connection #1
            Used Columns:    {SINVOICEV.NUM_0} : String[42]
                             {SINVOICEV.BPCORD_0} : String[32]
                             {SINVOICEV.BPAADD_0} : String[12]
                             {SINVOICEV.BPIEECNUM_0} : String[42]
                             {SINVOICEV.BPDNAM_0} : String[72]
                             {SINVOICEV.BPDADDLIG_0} : String[102]
                             {SINVOICEV.BPDADDLIG_1} : String[102]
                             {SINVOICEV.BPDADDLIG_2} : String[102]
                             {SINVOICEV.BPDPOSCOD_0} : String[22]
                             {SINVOICEV.BPDCTY_0} : String[82]
                             {SINVOICEV.BPDSAT_0} : String[72]
                             {SINVOICEV.INVTYP_0} : Number
                             {SINVOICEV.SIHORI_0} : Number
                             {SINVOICEV.SIHORINUM_0} : String[42]
                             {SINVOICEV.CUR_0} : String[8]
                             {SINVOICEV.INVREF_0} : String[62]
                             {SINVOICEV.PRITYP_0} : Number
                             {SINVOICEV.REP_0} : String[32]
                             {SINVOICEV.LAN_0} : String[8]
                             {SINVOICEV.SIHTEX1_0} : String[26]
                             {SINVOICEV.SIHTEX2_0} : String[26]
                             {SINVOICEV.INSORDNUM_0} : String[42]
                             {SINVOICEV.INSORDNUM_1} : String[42]
                             {SINVOICEV.INSORDNUM_2} : String[42]
                             {SINVOICEV.INSORDNUM_3} : String[42]
                             {SINVOICEV.INSLIN_0} : Number
                             {SINVOICEV.INSLIN_1} : Number
                             {SINVOICEV.INSLIN_2} : Number
                             {SINVOICEV.INSLIN_3} : Number
                             {SINVOICEV.PLISTC_0} : String[22]

        Table:    x3famesa.FAMESAOF.AREPORTM
            Connection:    Connection #1
            Used Columns:    {AREPORTM.USR_0} : String[12]
                             {AREPORTM.RPTCOD_0} : String[32]
                             {AREPORTM.NUMREQ_0} : Number
                             {AREPORTM.NUMLIG_0} : Number
                             {AREPORTM.SEQREQ_0} : Number
                             {AREPORTM.CLEA1_0} : String[82]

        Table:    x3famesa.FAMESAOF.TABUNIT
            Connection:    Connection #1
            Used Columns:    {TABUNIT.UOM_0} : String[8]
                             {TABUNIT.UOMDEC_0} : Number

        Table:    x3famesa.FAMESAOF.TABCUR
            Connection:    Connection #1
            Used Columns:    {TABCUR.CUR_0} : String[8]
                             {TABCUR.EURFLG_0} : Number
                             {TABCUR.DECNBR_0} : Number

        Table:    x3famesa.FAMESAOF.BPADDRESS
            Connection:    Connection #1
            Report Alias:    BPADDRESS_FCY
            Used Columns:    {BPADDRESS_FCY.BPATYP_0} : Number

        Table:    x3famesa.FAMESAOF.BPADDRESS
            Connection:    Connection #1
            Report Alias:    BPADDRESS_BPR
            Used Columns:    {BPADDRESS_BPR.BPATYP_0} : Number
                             {BPADDRESS_BPR.BPAADDLIG_0} : String[102]
                             {BPADDRESS_BPR.BPAADDLIG_1} : String[102]
                             {BPADDRESS_BPR.BPAADDLIG_2} : String[102]
                             {BPADDRESS_BPR.POSCOD_0} : String[22]
                             {BPADDRESS_BPR.CTY_0} : String[82]
                             {BPADDRESS_BPR.SAT_0} : String[72]
                             {BPADDRESS_BPR.CRY_0} : String[8]
                             {BPADDRESS_BPR.CRYNAM_0} : String[82]

        Table:    x3famesa.FAMESAOF.FACTOR
            Connection:    Connection #1
            Used Columns:    {FACTOR.FCTCOD_0} : String[32]
                             {FACTOR.TXTSBRGT_0} : String[156]
                             {FACTOR.TXTSBRGT_1} : String[156]
                             {FACTOR.TXTSBRGT_2} : String[156]
                             {FACTOR.TXTSBRGT_3} : String[156]
                             {FACTOR.TXTSBRGT_4} : String[156]
                             {FACTOR.TXTSBRGT_5} : String[156]

        Table:    x3famesa.FAMESAOF.SDELIVERY
            Connection:    Connection #1
            Used Columns:    {SDELIVERY.SDHNUM_0} : String[42]

        Table:    x3famesa.FAMESAOF.TEXCLOB
            Connection:    Connection #1
            Report Alias:    TEXCLOB_DEB
            Used Columns:    {TEXCLOB_DEB.TEXTE_0} : Unknown

        Table:    x3famesa.FAMESAOF.TEXCLOB
            Connection:    Connection #1
            Report Alias:    TEXCLOB_DET
            Used Columns:    {TEXCLOB_DET.TEXTE_0} : Unknown

        Table:    x3famesa.FAMESAOF.TEXCLOB
            Connection:    Connection #1
            Report Alias:    TEXCLOB_FIN
            Used Columns:    {TEXCLOB_FIN.TEXTE_0} : Unknown

        Table:    x3famesa.FAMESAOF.COMPANY
            Connection:    Connection #1
            Used Columns:    {COMPANY.CPY_0} : String[12]
                             {COMPANY.LEG_0} : String[42]
                             {COMPANY.CRY_0} : String[8]
                             {COMPANY.NAF_0} : String[22]
                             {COMPANY.NID_0} : String[162]
                             {COMPANY.CPYLOG_0} : String[22]
                             {COMPANY.RGCAMT_0} : Number
                             {COMPANY.RGCCUR_0} : String[8]
                             {COMPANY.BPAADD_0} : String[12]
                             {COMPANY.BIDNUM_0} : String[62]
                             {COMPANY.ACCCUR_0} : String[8]
                             {COMPANY.SCINUM_0} : String[72]

        Table:    x3famesa.FAMESAOF.SDELIVERY
            Connection:    Connection #1
            Report Alias:    SDELIVERY_1
            Used Columns:    {SDELIVERY_1.BPAADD_0} : String[12]
                             {SDELIVERY_1.SHIDAT_0} : Date
                             {SDELIVERY_1.BPDADDLIG_0} : String[102]
                             {SDELIVERY_1.BPDADDLIG_1} : String[102]
                             {SDELIVERY_1.BPDADDLIG_2} : String[102]
                             {SDELIVERY_1.BPDPOSCOD_0} : String[22]
                             {SDELIVERY_1.BPDCTY_0} : String[82]
                             {SDELIVERY_1.BPDSAT_0} : String[72]
                             {SDELIVERY_1.BPDCRYNAM_0} : String[82]

        Table:    x3famesa.FAMESAOF.AFCTFCY
            Connection:    Connection #1
            Used Columns:    {AFCTFCY.FCY_0} : String[12]
                             {AFCTFCY.PRFCOD_0} : String[12]
                             {AFCTFCY.FNC_0} : String[26]

        Table:    x3famesa.FAMESAOF.BPDLVCUST
            Connection:    Connection #1
            Used Columns:    {BPDLVCUST.BPCNUM_0} : String[32]
                             {BPDLVCUST.BPAADD_0} : String[12]
                             {BPDLVCUST.BPDNAM_0} : String[72]

        Table:    x3famesa.FAMESAOF.TABMODELIV
            Connection:    Connection #1
            Used Columns:    {TABMODELIV.MDL_0} : String[12]

        Table:    x3famesa.FAMESAOF.PRICSTRUCT
            Connection:    Connection #1
            Used Columns:    {PRICSTRUCT.BPCBPS_0} : Number
                             {PRICSTRUCT.PLISTC_0} : String[22]

        Table:    x3famesa.FAMESAOF.SORDERQ
            Connection:    Connection #1
            Used Columns:    {SORDERQ.SOHNUM_0} : String[42]
                             {SORDERQ.SOPLIN_0} : Number
                             {SORDERQ.SOQSEQ_0} : Number

        Table:    x3famesa.FAMESAOF.TABCOUNTRY
            Connection:    Connection #1
            Used Columns:    {TABCOUNTRY.CRY_0} : String[8]
                             {TABCOUNTRY.EECFLG_0} : Number

        Table:    x3famesa.FAMESAOF.SALESREP
            Connection:    Connection #1
            Used Columns:    {SALESREP.REPNUM_0} : String[32]
                             {SALESREP.REPNAM_0} : String[72]

        Table:    x3famesa.FAMESAOF.ITMBPC
            Connection:    Connection #1
            Used Columns:    {ITMBPC.ITMREF_0} : String[42]
                             {ITMBPC.BPCNUM_0} : String[32]
                             {ITMBPC.ITMREFBPC_0} : String[82]
                             {ITMBPC.ITMDESBPC_0} : String[82]

        Table:    x3famesa.FAMESAOF.ITMMASTER
            Connection:    Connection #1
            Used Columns:    {ITMMASTER.ITMREF_0} : String[42]
                             {ITMMASTER.SEAKEY_0} : String[42]
                             {ITMMASTER.EANCOD_0} : String[42]
                             {ITMMASTER.CUSREF_0} : String[26]

        Table:    x3famesa.FAMESAOF.SORDER
            Connection:    Connection #1
            Used Columns:    {SORDER.SOHNUM_0} : String[42]
                             {SORDER.CPY_0} : String[12]
                             {SORDER.CUSORDREF_0} : String[42]

        Table:    x3famesa.FAMESAOF.BPCUSTOMER
            Connection:    Connection #1
            Used Columns:    {BPCUSTOMER.BPCNUM_0} : String[32]
                             {BPCUSTOMER.BPCBPSNUM_0} : String[32]
                             {BPCUSTOMER.PAYBAN_0} : String[12]
                             {BPCUSTOMER.DAYMON_0} : Number
                             {BPCUSTOMER.DAYMON_1} : Number
                             {BPCUSTOMER.DAYMON_2} : Number
                             {BPCUSTOMER.DAYMON_3} : Number
                             {BPCUSTOMER.DAYMON_4} : Number
                             {BPCUSTOMER.DAYMON_5} : Number

        Table:    x3famesa.FAMESAOF.BID
            Connection:    Connection #1
            Used Columns:    {BID.BPANUM_0} : String[32]
                             {BID.BIDNUM_0} : String[62]
                             {BID.BPAADD_0} : String[12]

        Table:    x3famesa.FAMESAOF.BANK
            Connection:    Connection #1
            Used Columns:    {BANK.BAN_0} : String[12]
                             {BANK.BICCOD_0} : String[24]
                             {BANK.IBACOD_0} : String[70]

        Table:    x3famesa.FAMESAOF.SPREASON
            Connection:    Connection #1
            Used Columns:    {SPREASON.PRIREN_0} : Number
                             {SPREASON.DES_0} : String[82]

        Table:    x3famesa.FAMESAOF.BANK
            Connection:    Connection #1
            Report Alias:    BANK_1
            Used Columns:    {BANK_1.BICCOD_0} : String[24]
                             {BANK_1.IBACOD_0} : String[70]

    Table Links
        Joins:    x3famesa.FAMESAOF.AREPORTM LEFT OUTER JOIN x3famesa.FAMESAOF.SINVOICEV ON x3famesa.FAMESAOF.AREPORTM.CLEA1_0 = x3famesa.FAMESAOF.SINVOICEV.NUM_0
                  x3famesa.FAMESAOF.SINVOICEV LEFT OUTER JOIN x3famesa.FAMESAOF.SINVOICE ON x3famesa.FAMESAOF.SINVOICEV.NUM_0 = x3famesa.FAMESAOF.SINVOICE.NUM_0
                  x3famesa.FAMESAOF.SINVOICEV LEFT OUTER JOIN x3famesa.FAMESAOF.TABCUR ON x3famesa.FAMESAOF.SINVOICEV.CUR_0 = x3famesa.FAMESAOF.TABCUR.CUR_0
                  x3famesa.FAMESAOF.SINVOICEV LEFT OUTER JOIN x3famesa.FAMESAOF.SDELIVERY ON x3famesa.FAMESAOF.SINVOICEV.SIHORINUM_0 = x3famesa.FAMESAOF.SDELIVERY.SDHNUM_0
                  x3famesa.FAMESAOF.SINVOICEV LEFT OUTER JOIN x3famesa.FAMESAOF.TEXCLOB TEXCLOB_DEB ON x3famesa.FAMESAOF.SINVOICEV.SIHTEX1_0 = TEXCLOB_DEB.CODE_0
                  x3famesa.FAMESAOF.SINVOICEV LEFT OUTER JOIN x3famesa.FAMESAOF.TEXCLOB TEXCLOB_FIN ON x3famesa.FAMESAOF.SINVOICEV.SIHTEX2_0 = TEXCLOB_FIN.CODE_0
                  x3famesa.FAMESAOF.SINVOICEV LEFT OUTER JOIN x3famesa.FAMESAOF.BPDLVCUST ON x3famesa.FAMESAOF.SINVOICEV.BPCORD_0,BPAADD_0 = x3famesa.FAMESAOF.BPDLVCUST.BPCNUM_0,BPAADD_0
                  x3famesa.FAMESAOF.SINVOICEV LEFT OUTER JOIN x3famesa.FAMESAOF.PRICSTRUCT ON x3famesa.FAMESAOF.SINVOICEV.PLISTC_0 = x3famesa.FAMESAOF.PRICSTRUCT.PLISTC_0
                  x3famesa.FAMESAOF.SINVOICEV LEFT OUTER JOIN x3famesa.FAMESAOF.SALESREP ON x3famesa.FAMESAOF.SINVOICEV.REP_0 = x3famesa.FAMESAOF.SALESREP.REPNUM_0
                  x3famesa.FAMESAOF.SINVOICE LEFT OUTER JOIN x3famesa.FAMESAOF.BPARTNER ON x3famesa.FAMESAOF.SINVOICE.BPR_0 = x3famesa.FAMESAOF.BPARTNER.BPRNUM_0
                  x3famesa.FAMESAOF.SINVOICE LEFT OUTER JOIN x3famesa.FAMESAOF.FACILITY ON x3famesa.FAMESAOF.SINVOICE.FCY_0 = x3famesa.FAMESAOF.FACILITY.FCY_0
                  x3famesa.FAMESAOF.SINVOICE INNER JOIN x3famesa.FAMESAOF.SINVOICED ON x3famesa.FAMESAOF.SINVOICE.NUM_0 = x3famesa.FAMESAOF.SINVOICED.NUM_0
                  x3famesa.FAMESAOF.SINVOICE LEFT OUTER JOIN x3famesa.FAMESAOF.FACTOR ON x3famesa.FAMESAOF.SINVOICE.BPRFCT_0 = x3famesa.FAMESAOF.FACTOR.FCTCOD_0
                  x3famesa.FAMESAOF.SINVOICE LEFT OUTER JOIN x3famesa.FAMESAOF.BPADDRESS BPADDRESS_BPR ON x3famesa.FAMESAOF.SINVOICE.BPAINV_0,BPR_0 = BPADDRESS_BPR.BPAADD_0,BPANUM_0
                  x3famesa.FAMESAOF.SINVOICE LEFT OUTER JOIN x3famesa.FAMESAOF.AFCTFCY ON x3famesa.FAMESAOF.SINVOICE.FCY_0 = x3famesa.FAMESAOF.AFCTFCY.FCY_0
                  x3famesa.FAMESAOF.SINVOICE LEFT OUTER JOIN x3famesa.FAMESAOF.BANK ON x3famesa.FAMESAOF.SINVOICE.ZBANK_0 = x3famesa.FAMESAOF.BANK.BAN_0
                  x3famesa.FAMESAOF.FACILITY LEFT OUTER JOIN x3famesa.FAMESAOF.BPADDRESS BPADDRESS_FCY ON x3famesa.FAMESAOF.FACILITY.BPAADD_0,FCY_0 = BPADDRESS_FCY.BPAADD_0,BPANUM_0
                  x3famesa.FAMESAOF.FACILITY LEFT OUTER JOIN x3famesa.FAMESAOF.COMPANY ON x3famesa.FAMESAOF.FACILITY.LEGCPY_0 = x3famesa.FAMESAOF.COMPANY.CPY_0
                  x3famesa.FAMESAOF.COMPANY LEFT OUTER JOIN x3famesa.FAMESAOF.TABCOUNTRY ON x3famesa.FAMESAOF.COMPANY.CRY_0 = x3famesa.FAMESAOF.TABCOUNTRY.CRY_0
                  x3famesa.FAMESAOF.COMPANY LEFT OUTER JOIN x3famesa.FAMESAOF.BID ON x3famesa.FAMESAOF.COMPANY.CPY_0,BPAADD_0,BIDNUM_0 = x3famesa.FAMESAOF.BID.BPANUM_0,BPAADD_0,BIDNUM_0
                  x3famesa.FAMESAOF.SINVOICED LEFT OUTER JOIN x3famesa.FAMESAOF.ITMSALES ON x3famesa.FAMESAOF.SINVOICED.ITMREF_0 = x3famesa.FAMESAOF.ITMSALES.ITMREF_0
                  x3famesa.FAMESAOF.SINVOICED LEFT OUTER JOIN x3famesa.FAMESAOF.TABUNIT ON x3famesa.FAMESAOF.SINVOICED.SAU_0 = x3famesa.FAMESAOF.TABUNIT.UOM_0
                  x3famesa.FAMESAOF.SINVOICED LEFT OUTER JOIN x3famesa.FAMESAOF.TEXCLOB TEXCLOB_DET ON x3famesa.FAMESAOF.SINVOICED.SIDTEX_0 = TEXCLOB_DET.CODE_0
                  x3famesa.FAMESAOF.SINVOICED LEFT OUTER JOIN x3famesa.FAMESAOF.SDELIVERY SDELIVERY_1 ON x3famesa.FAMESAOF.SINVOICED.SDHNUM_0 = SDELIVERY_1.SDHNUM_0
                  x3famesa.FAMESAOF.SINVOICED LEFT OUTER JOIN x3famesa.FAMESAOF.SORDERQ ON x3famesa.FAMESAOF.SINVOICED.SOHNUM_0,SOPLIN_0,SOQSEQ_0 = x3famesa.FAMESAOF.SORDERQ.SOHNUM_0,SOPLIN_0,SOQSEQ_0
                  x3famesa.FAMESAOF.SINVOICED LEFT OUTER JOIN x3famesa.FAMESAOF.ITMBPC ON x3famesa.FAMESAOF.SINVOICED.ITMREF_0,BPCINV_0 = x3famesa.FAMESAOF.ITMBPC.ITMREF_0,BPCNUM_0
                  x3famesa.FAMESAOF.SINVOICED LEFT OUTER JOIN x3famesa.FAMESAOF.ITMMASTER ON x3famesa.FAMESAOF.SINVOICED.ITMREF_0 = x3famesa.FAMESAOF.ITMMASTER.ITMREF_0
                  x3famesa.FAMESAOF.SINVOICED LEFT OUTER JOIN x3famesa.FAMESAOF.SPREASON ON x3famesa.FAMESAOF.SINVOICED.PRIREN_0 = x3famesa.FAMESAOF.SPREASON.PRIREN_0
                  x3famesa.FAMESAOF.SDELIVERY SDELIVERY_1 LEFT OUTER JOIN x3famesa.FAMESAOF.TABMODELIV ON SDELIVERY_1.MDL_0 = x3famesa.FAMESAOF.TABMODELIV.MDL_0
                  x3famesa.FAMESAOF.SORDERQ LEFT OUTER JOIN x3famesa.FAMESAOF.SORDER ON x3famesa.FAMESAOF.SORDERQ.SOHNUM_0 = x3famesa.FAMESAOF.SORDER.SOHNUM_0
                  x3famesa.FAMESAOF.BPARTNER LEFT OUTER JOIN x3famesa.FAMESAOF.BPCUSTOMER ON x3famesa.FAMESAOF.BPARTNER.BPRNUM_0 = x3famesa.FAMESAOF.BPCUSTOMER.BPCNUM_0
                  x3famesa.FAMESAOF.BPCUSTOMER LEFT OUTER JOIN x3famesa.FAMESAOF.BANK BANK_1 ON x3famesa.FAMESAOF.BPCUSTOMER.PAYBAN_0 = BANK_1.BAN_0

    Record Selection Formulas
        Formula:    {AREPORTM.RPTCOD_0} = {?etat} and
                    {AREPORTM.NUMREQ_0} = {?numedt} and
                    {AREPORTM.USR_0}    = {?usr} and
                    {BPADDRESS_FCY.BPATYP_0} = 3 and
                    {BPADDRESS_BPR.BPATYP_0} = 1.00 and
                    {AFCTFCY.FNC_0} = {?X3FCT} and
                    {AFCTFCY.PRFCOD_0} = {?X3PRF} and
                    {AREPORTM.SEQREQ_0} = {?seqedt} and
                    {PRICSTRUCT.BPCBPS_0} = 1
                    

    Record Sorting
        Sort By:    AREPORTM.NUMLIG_0 -- Ascending Order Group #1
                    SINVOICEV.NUM_0 -- Descending Order Group #2
                    SINVOICED.SDHNUM_0 -- Ascending Order Group #3
                    SINVOICED.SIDLIN_0 -- Ascending Order 

    Formula Fields

        Field:    Mt_net
            Formula:    // Prise en colpte des avoirs en valeur si la quantité = 0
                        if {SINVOICED.QTY_0} = 0 then
                          If {SINVOICEV.PRITYP_0} = 1 then {SINVOICED.AMTNOTLIN_0} else {SINVOICED.AMTATILIN_0}
                        else
                          round ( {SINVOICED.QTY_0} * {SINVOICED.NETPRI_0} , {@decimald} );
                        

        Field:    lbl_mntnet
            Formula:    // fonction de PRITYP
                        //WhilePrintingRecords;
                        //global stringVar totht;
                        //global stringVar totttc;
                        //If {SINVOICEV.PRITYP_0} = 1 then totht else totttc;
                        WhilePrintingRecords;
                        global stringVar txtImporte;

        Field:    lbl_gratuit
            Formula:    WhilePrintingRecords;
                        global stringVar gratuit;

        Field:    lbl_option_ou_kit
            Formula:    WhilePrintingRecords;
                        global stringVar Opt;
                        global stringVar kit;
                        
                        If {SINVOICED.LINTYP_0} = 4 or  
                           {SINVOICED.LINTYP_0} = 8 
                           then 
                                    opt 
                           else 
                                    if {SINVOICED.LINTYP_0} = 2 
                                    then 
                                            kit
                                    else  "";
                        

        Field:    Mtacompte_Facture_non_validee
            Formula:    //Bug 52478
                        //Pour calculer le montant des acomptes réglés, dans les états SBONFAC, SBONFACP,SBONFACP2,SBONFACP2PI  :
                        //[F :SIV]INSORDNUM : N°Commande
                        //[F :SIV]INSLIN   : N°Ligne
                        //Nous permettent d’aller lire les échéances de l’acompte dans GACCDUDATE avec la clé DUD0 
                        //TYP : *SO
                        //NUM : [F :SIV]INSORDNUM
                        //LIG : 1
                        //DUDLIG : [F :SIV]INSLIN
                        //On peut avoir jusqu’à 4 acomptes sur une facture. Le pb ensuite, c’est qu’il n’y a pas de lien entre les échéances de la facture et la ou les échéances de l’acompte.
                        //Pour la facture, dans GACCDUDATE nous avons
                        //TYP : [F :SIH]GTE
                        //NUM : [F :SIV]NUM
                        //C’est pour cette raison que l'on décrémente chaque échéance de la facture en fonction du montant total des acomptes réglés. 
                        //Si on a plusieurs acomptes, il faut calculer le total réglé. Et si on a plusieurs échéances sur la facture, il faut déduire le maximum sur la 1ère, puis sur la 2ème etc
                        //{SINVOICEV.INSATI_0} + {SINVOICEV.INSATI_1} + {SINVOICEV.INSATI_2} + {SINVOICEV.INSATI_3}
                        
                        //--CPO 83064
                        //if ({SINVOICEV.INSATI_0} + {SINVOICEV.INSATI_1} + {SINVOICEV.INSATI_2} + {SINVOICEV.INSATI_3}) < {@TotalMtAcptEcheance} then
                        //    {SINVOICEV.INSATI_0} + {SINVOICEV.INSATI_1} + {SINVOICEV.INSATI_2} + {SINVOICEV.INSATI_3}
                        //else
                        //    {@TotalMtAcptEcheance};
                        {@TotalAcptesVerses};
                        //--/CPO
                        

        Field:    decimald
            Formula:    {TABCUR.DECNBR_0}

        Field:    decimalsau
            Formula:    {TABUNIT.UOMDEC_0}

        Field:    lbl_typefac
            Formula:    WhilePrintingRecords;
                        global stringVar facture;
                        global stringVar avoir;
                        global stringVar proforma;
                        
                        if {SINVOICEV.INVTYP_0} = 1 then facture
                           else 
                           if {SINVOICEV.INVTYP_0} = 2 then avoir
                           else 
                           if {SINVOICEV.INVTYP_0} = 5 then proforma;
                        
                        

        Field:    lbl_total
            Formula:    WhilePrintingRecords;
                        global stringVar totht;
                        global stringVar totttc;
                        
                        If {SINVOICEV.PRITYP_0} = 1 then totht else totttc;
                        

        Field:    Mt_total
            Formula:    If {SINVOICEV.PRITYP_0} = 1 then {SINVOICE.AMTNOT_0} else {SINVOICE.AMTATI_0};
                        

        Field:    Province_BPADDRESS_BPR
            Formula:    // Si la province SAT est présente elle est affichée et le pays situé à la même place n'est pas affiché.
                        //    Le pays est affiché dans ce cas à la droite de la province.
                        // Sinon, le pays est affiché comme auparavant.
                        // Fait pour la V140 et la V5. (Pour la V6, le champs SAT n'est plus soumis a code activité et est affiché)
                        if {BPADDRESS_BPR.SAT_0} <> "" then 
                           {BPADDRESS_BPR.SAT_0}
                        else 
                           {BPADDRESS_BPR.CRYNAM_0};
                        

        Field:    Province_SINVOICE
            Formula:    // Si la province SAT est présente elle est affichée et le pays situé à la même place n'est pas affiché.
                        //    Le pays est affiché dans ce cas à la droite de la province.
                        // Sinon, le pays est affiché comme auparavant.
                        // Fait pour la V140 et la V5. (Pour la V6, le champs SAT n'est plus soumis a code activité et est affiché)
                        if {SINVOICE.SAT_0} <> "" then 
                           {SINVOICE.SAT_0}
                        else 
                           {SINVOICE.CRYNAM_0};
                        

        Field:    Mtacompte_Facture_validee
            Formula:    // Déclaration d'une variable Shared pour que le sous-états affichant le montant des accomptes puisse la MAJ
                        Shared NumberVar Mtacompte_Facture_validee := 0;
                        

        Field:    lbl_formejuridique
            Formula:    WhilePrintingRecords;
                        global stringVar aucapitalde;
                        global stringVar naf;
                        local stringVar txtformejuridique;
                        
                        txtformejuridique := {COMPANY.CPYLOG_0} + " " +  aucapitalde + " " +  ToText({COMPANY.RGCAMT_0},2," ",",") + " " + {COMPANY.RGCCUR_0} + " " + {COMPANY.NID_0} + " " + naf +  " "  +{COMPANY.NAF_0};
                        
                        

        Field:    rupture_origlivraison_fact
            Formula:    WhilePrintingRecords;
                        global BooleanVar ruptureLivraison := false;
                        global StringVar sauvNumLivraison;
                        // Bug 60458
                        global BooleanVar ruptureOrigFact := false;
                        global StringVar sauvNumOrigFact;
                        
                        If {SINVOICEV.SIHORI_0} = 3 and len({SINVOICEV.SIHORINUM_0})=0 and {SINVOICED.SDHNUM_0} <> "" and sauvNumLivraison <> {SINVOICED.SDHNUM_0} then
                        (
                            ruptureLivraison := true;
                            sauvNumLivraison := {SINVOICED.SDHNUM_0};
                        )
                        // Bug 60458
                        else
                        If {SINVOICEV.SIHORI_0} = 4 and {SINVOICEV.INVTYP_0} = 2 and len({SINVOICEV.SIHORINUM_0})=0 and {SINVOICED.SIHORINUM_0} <> "" and sauvNumOrigFact <> {SINVOICED.SIHORINUM_0} then
                        (
                            ruptureOrigFact := true;
                            sauvNumOrigFact := {SINVOICED.SIHORINUM_0};
                        );
                        

        Field:    gcolrem0
            Formula:    WhilePrintingRecords;
                        Global StringVar Array Tarif_colonne;
                        Local  NumberVar i := 1;
                        
                        if {?NBMAXTARIF} >= i then
                          Tarif_colonne[i]
                        else
                          "";
                        

        Field:    gfmtrem0
            Formula:    WhilePrintingRecords;
                        Global NumberVar Array Tarif_format_Dec;
                        local numbervar i := 1;
                        
                        if {?NBMAXTARIF} >= i then
                          Tarif_format_Dec[i]
                        else
                          {@decimald};
                        

        Field:    lbl_baseTVA
            Formula:    WhilePrintingRecords;
                        global stringVar baseTVA;
                        

        Field:    lbl_mtTVA
            Formula:    WhilePrintingRecords;
                        global stringVar mtTVA;
                        

        Field:    lbl_taux
            Formula:    WhilePrintingRecords;
                        global stringVar taux;
                        taux;

        Field:    sumtax
            Formula:    Shared numbervar sumtax;
                        

        Field:    lbl_totalttcU
            Formula:    WhilePrintingRecords;
                        global stringVar totttc;
                        UpperCase (totttc);

        Field:    lbl_acomptesd
            Formula:    WhilePrintingRecords;
                        global stringVar acomptesd;
                        acomptesd;

        Field:    InitMtAcpt
            Formula:    //Bug 52478
                        //Pour calculer le montant des acomptes réglés, dans les états SBONFAC, SBONFACP,SBONFACP2,SBONFACP2PI  :
                        //[F :SIV]INSORDNUM : N°Commande
                        //[F :SIV]INSLIN   : N°Ligne
                        //Nous permettent d’aller lire les échéances de l’acompte dans GACCDUDATE avec la clé DUD0 
                        //TYP : *SO
                        //NUM : [F :SIV]INSORDNUM
                        //LIG : 1
                        //DUDLIG : [F :SIV]INSLIN
                        //On peut avoir jusqu’à 4 acomptes sur une facture. Le pb ensuite, c’est qu’il n’y a pas de lien entre les échéances de la facture et la ou les échéances de l’acompte.
                        //Pour la facture, dans GACCDUDATE nous avons
                        //TYP : [F :SIH]GTE
                        //NUM : [F :SIV]NUM
                        //C’est pour cette raison que l'on décrémente chaque échéance de la facture en fonction du montant total des acomptes réglés. 
                        //Si on a plusieurs acomptes, il faut calculer le total réglé. Et si on a plusieurs échéances sur la facture, il faut déduire le maximum sur la 1ère, puis sur la 2ème etc
                        Shared numbervar MtAcptEcheance;
                        MtAcptEcheance :=0;
                        //--CPO 83064
                        //Shared numbervar TotalMtAcptEcheance;
                        //TotalMtAcptEcheance := 0;
                        Shared numbervar TotalAcptesDdes;
                        Shared numbervar TotalAcptesVerses;
                        TotalAcptesDdes   := 0;
                        TotalAcptesVerses := 0;
                        
                        

        Field:    Mtacompte_demandé_Facture
            Formula:    //Bug 52478
                        //Pour calculer le montant des acomptes réglés, dans les états SBONFAC, SBONFACP,SBONFACP2,SBONFACP2PI  :
                        //[F :SIV]INSORDNUM : N°Commande
                        //[F :SIV]INSLIN   : N°Ligne
                        //Nous permettent d’aller lire les échéances de l’acompte dans GACCDUDATE avec la clé DUD0 
                        //TYP : *SO
                        //NUM : [F :SIV]INSORDNUM
                        //LIG : 1
                        //DUDLIG : [F :SIV]INSLIN
                        //On peut avoir jusqu’à 4 acomptes sur une facture. Le pb ensuite, c’est qu’il n’y a pas de lien entre les échéances de la facture et la ou les échéances de l’acompte.
                        //Pour la facture, dans GACCDUDATE nous avons
                        //TYP : [F :SIH]GTE
                        //NUM : [F :SIV]NUM
                        //C’est pour cette raison que l'on décrémente chaque échéance de la facture en fonction du montant total des acomptes réglés. 
                        //Si on a plusieurs acomptes, il faut calculer le total réglé. Et si on a plusieurs échéances sur la facture, il faut déduire le maximum sur la 1ère, puis sur la 2ème etc
                        
                        //--CPO 83064
                        //if ({SINVOICEV.INSATI_0} + {SINVOICEV.INSATI_1} + {SINVOICEV.INSATI_2} + {SINVOICEV.INSATI_3}) < {@TotalMtAcptEcheance} then
                        //    0
                        //else
                        //    {SINVOICEV.INSATI_0} + {SINVOICEV.INSATI_1} + {SINVOICEV.INSATI_2} + {SINVOICEV.INSATI_3} - {@TotalMtAcptEcheance};
                        {@TotalAcptesDdes};
                        //--/CPO

        Field:    lbl_acomptev
            Formula:    WhilePrintingRecords;
                        shared stringVar acomptev;
                        acomptev;

        Field:    lbl_total_lig
            Formula:    // Bug 54231 52497
                        // fonction de PRITYP
                        WhilePrintingRecords;
                        global stringVar total_light;
                        global stringVar total_ligttc;
                        
                        If {SINVOICEV.PRITYP_0} = 1 then total_light else total_ligttc;
                        

        Field:    lbl_dontTVA
            Formula:    // Bug 54231 52497
                        WhilePrintingRecords;
                        global stringVar mtTaxes;
                        
                        

        Field:    lbl_dontTaxesSoumises
            Formula:    // Bug 64355 Mentions légales : taxes soumises, TVA, taxes non soumises
                        WhilePrintingRecords;
                        global stringVar dontTaxesSoumises;
                        global stringVar mtTaxesSoumises;
                        
                        If {SINVOICEV.PRITYP_0} = 2 then dontTaxesSoumises  else mtTaxesSoumises;

        Field:    lbl_dontTaxesNonSoumises
            Formula:    // Bug 64355 Mentions légales : taxes soumises, TVA, taxes non soumises
                        WhilePrintingRecords;
                        global stringVar dontTaxesNonSoumises;
                        global stringVar mtTaxesNonSoumises;
                        
                        If {SINVOICEV.PRITYP_0} = 2 then dontTaxesNonSoumises  else mtTaxesNonSoumises;

        Field:    lbl_dontTaxesTVA
            Formula:    // Bug 64355 Mentions légales : taxes soumises, TVA, taxes non soumises
                        WhilePrintingRecords;
                        global stringVar dontTaxesTVA;
                        global stringVar mtTaxesTVA;
                        
                        If {SINVOICEV.PRITYP_0} = 2 then dontTaxesTVA  else mtTaxesTVA;

        Field:    sumTaxSoumise
            Formula:    // 64355
                        Shared numbervar sumTaxSoumise;

        Field:    sumTaxNonSoumise
            Formula:    // 64355
                        Shared numbervar sumTaxNonSoumise;

        Field:    sumTaxTVA
            Formula:    // 64355
                        Shared numbervar sumTaxTVA;

        Field:    sumTaxTVA_Euro
            Formula:    //64355
                        if {SINVOICE.CUR_0}<>{?euro} then
                            if      {SINVOICE.CURLED_0} = {?euro} and {SINVOICE.RATDIV_0}<>0 then
                                ({@sumTaxTVA}*{SINVOICE.RATMLT_0})/{SINVOICE.RATDIV_0}
                            else if {SINVOICE.CURLED_1} = {?euro} and {SINVOICE.RATDIV_1}<>0 then
                                ({@sumTaxTVA}*{SINVOICE.RATMLT_1})/{SINVOICE.RATDIV_1}
                            else if {SINVOICE.CURLED_2} = {?euro} and {SINVOICE.RATDIV_2}<>0 then
                                ({@sumTaxTVA}*{SINVOICE.RATMLT_2})/{SINVOICE.RATDIV_2}
                            else if {SINVOICE.CURLED_3} = {?euro} and {SINVOICE.RATDIV_3}<>0 then
                                ({@sumTaxTVA}*{SINVOICE.RATMLT_3})/{SINVOICE.RATDIV_3}
                            else if {SINVOICE.CURLED_4} = {?euro} and {SINVOICE.RATDIV_4}<>0 then
                                ({@sumTaxTVA}*{SINVOICE.RATMLT_4})/{SINVOICE.RATDIV_4}
                            else if {SINVOICE.CURLED_5} = {?euro} and {SINVOICE.RATDIV_5}<>0 then
                                ({@sumTaxTVA}*{SINVOICE.RATMLT_5})/{SINVOICE.RATDIV_5}
                            else if {SINVOICE.CURLED_6} = {?euro} and {SINVOICE.RATDIV_6}<>0 then
                                ({@sumTaxTVA}*{SINVOICE.RATMLT_6})/{SINVOICE.RATDIV_6}
                            else if {SINVOICE.CURLED_7} = {?euro} and {SINVOICE.RATDIV_7}<>0 then
                                ({@sumTaxTVA}*{SINVOICE.RATMLT_7})/{SINVOICE.RATDIV_7}
                            else if {SINVOICE.CURLED_8} = {?euro} and {SINVOICE.RATDIV_8}<>0 then
                                ({@sumTaxTVA}*{SINVOICE.RATMLT_8})/{SINVOICE.RATDIV_8}
                            else if {SINVOICE.CURLED_9} = {?euro} and {SINVOICE.RATDIV_9}<>0 then
                                ({@sumTaxTVA}*{SINVOICE.RATMLT_9})/{SINVOICE.RATDIV_9};

        Field:    lbl_dontTaxesTVA_Euro
            Formula:    // 64355 Mentions légales : taxes soumises, TVA, taxes non soumises
                        WhilePrintingRecords;
                        global stringVar dontTaxesTVA_Euros;
                        global stringVar mtTaxesTVA_Euros;
                        
                        If {SINVOICEV.PRITYP_0} = 2 then dontTaxesTVA_Euros  else mtTaxesTVA_Euros;

        Field:    TotalAcptesDdes
            Formula:    //--CPO 83064
                        Shared numbervar TotalAcptesDdes;

        Field:    TotalAcptesVerses
            Formula:    //--CPO 83064
                        Shared numbervar TotalAcptesVerses;

        Field:    param_X3DOS
            Formula:    //71937 Adaptation multi-législation
                        //Afin de passer le paramètre X3DOS au sous-états (pas possible sinon pour ce type de param)
                        shared stringvar param_X3DOS :={?X3DOS};
                        

        Field:    imprimer retard paiement
            Formula:    //86064 Nouvelle mention obligatoire
                        WhilePrintingRecords;
                        Local Stringvar array arrpays;
                        Local Stringvar array arrmontant;
                        Local Numbervar I;
                        Local Numbervar montant:=0;
                        Global StringVar retardpaiement;
                        
                        arrpays := split({?mentionpays},",");
                        arrmontant := split({?mentionmontant},",");
                        
                        // Imprimer la mention si :
                        // le pays de la société appartient à la liste despays passés en paramètre
                        // le client facturé n'est pas une personne physique
                        // un code escompte est renseigné sur la facture
                        // il s'agit d'une facture
                          
                        For I:=1 to UBound(arrpays) Do
                        ( If {COMPANY.CRY_0}=arrpays[I] and NumericText(arrmontant[I]) Then
                         (
                           montant := ToNumber(arrmontant[I]);
                           Exit For
                          )
                        );
                         
                        
                        If {COMPANY.CRY_0} in arrpays and {BPARTNER.LEGETT_0}<>2 and {SINVOICE.DEP_0}<>"" and {SINVOICE.INVTYP_0}=1 then
                        (
                         retardpaiement := replace(retardpaiement,"~~",ToText(montant));
                         retardpaiement := replace(retardpaiement,"$$",{COMPANY.ACCCUR_0});
                         )
                        else
                         retardpaiement := ""
                        ;

        Field:    lbl_retardpaiement
            Formula:    //86064 Nouvelle mention obligatoire
                        WhilePrintingRecords;
                        global stringVar retardpaiement;
                        retardpaiement;
                        

        Field:    param_tauxagios
            Formula:    //71937 Adaptation multi-législation
                        //Afin de passer le paramètre tauxagios au sous-états (pas possible sinon pour ce type de param)
                        shared numbervar param_tauxagios :={?tauxagios};

        Field:    param_tauxescompte
            Formula:    //71937 Adaptation multi-législation
                        //Afin de passer le paramètre tauxescompte au sous-états (pas possible sinon pour ce type de param)
                        shared numbervar param_tauxescompte :={?tauxescompte};

        Field:    SddAffiche
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        if {?paramsddprn}>'1' and  {SINVOICE.BPRPAY_0}={SINVOICE.BPR_0} then true
                        
                        
                        

        Field:    SddFormNbSddIni
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        shared numbervar NbEchSdd;

        Field:    Sdd1FormNbSddTot
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        shared numbervar NbEchSddtot;
                        shared numbervar NbEchSdd;
                        NbEchSddTot := NbEchSdd ;
                        

        Field:    Sdd1FormSiPlus4Ech
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        shared numbervar NbEchSddtot;
                        IF NbEchSddTot >4 THEN TRUE
                        

        Field:    Sdd1Affiche2
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --#
                        WhilePrintingRecords; 
                        shared numbervar NbEchSdd2;
                        IF  NbEchSdd2>0 and  {SINVOICE.BPRPAY_0}={SINVOICE.BPR_0} THEN TRUE else FALSE

        Field:    Sdd1AAPageNumber
            Formula:     // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        
                        //(PageNumber < TotalPageCount and not {@Sdd1AffichePageSup2}) OR (PageNumber < TotalPageCount -1  and  {@Sdd1AffichePageSup2})
                        
                        PageNumber ;

        Field:    Sdd1AATotalPageCount
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        TotalPageCount ;

        Field:    Sdd1AffichePageSup
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --#
                        WhilePrintingRecords; 
                        shared numbervar NbEch;
                        shared numbervar NbEchSdd2;
                        //IF ((NbEch>0 and NbEch<5) or NbEch>4)  and NbEchSdd2>0  THEN TRUE else FALSE
                        IF NbEch>0  and NbEchSdd2>0  THEN TRUE else FALSE

        Field:    Sdd1FormNbEch
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        WhilePrintingRecords;
                        shared numbervar NbEch;

        Field:    Sdd1FormNbEchSdd
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        //WhilePrintingRecords;
                        shared numbervar NbEchSdd;
                        NbEchSdd ;

        Field:    Sdd1FormNbEchSdd2
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --#
                        //Sdd1FormNbEchSdd2 
                        WhilePrintingRecords;
                        shared numbervar NbEchSdd2;
                        NbEchSdd2 ;

        Field:    lbl_cshvatspa
            Formula:    WhilePrintingRecords;
                        global stringVar txtcshvat;
                        txtcshvat;

        Field:    Suma y sigue
            Formula:    "Suma y sigue..."

        Field:    ClienteCodART
            Formula:    if {ITMBPC.ITMREFBPC_0}<>"" then
                            {ITMBPC.ITMREFBPC_0}
                        else
                            {SINVOICED.ITMREF_0}
                            

        Field:    ClienteDesART
            Formula:    //if {ITMBPC.ITMREFBPC_0}<>"" then
                        if {ITMBPC.ITMDESBPC_0}<>"" then
                            {ITMBPC.ITMDESBPC_0}
                        else
                            {SINVOICED.ITMDES_0}

        Field:    lblNumIVAIntra
            Formula:    WhilePrintingRecords;
                        global stringVar txtNumII;

        Field:    lblNumFactura
            Formula:    WhilePrintingRecords;
                        global stringVar txtNumFactura;

        Field:    lblRepresentante
            Formula:    WhilePrintingRecords;
                        global stringVar txtRepresentante;

        Field:    lblFecha
            Formula:    WhilePrintingRecords;
                        global stringVar txtFecha;

        Field:    lblcodcliente
            Formula:    WhilePrintingRecords;
                        global stringVar txtCodCliente;

        Field:    lblEntregadoel
            Formula:    WhilePrintingRecords;
                        global stringVar txtEntregadoel;

        Field:    lblEntreganum
            Formula:    WhilePrintingRecords;
                        global stringVar txtEntreganum;

        Field:    lblFacOrigen
            Formula:    WhilePrintingRecords;
                        global stringVar txtFacOrigen;

        Field:    lblArticulo
            Formula:    WhilePrintingRecords;
                        global stringVar txtArticulo;

        Field:    lblDescripcion
            Formula:    WhilePrintingRecords;
                        global stringVar txtDescripcion;

        Field:    lblCantidad
            Formula:    WhilePrintingRecords;
                        global stringVar txtCantidad;

        Field:    lblCodPedCli
            Formula:    WhilePrintingRecords;
                        global stringVar txtCodPedCli;

        Field:    lblPrecio
            Formula:    WhilePrintingRecords;
                        global stringVar txtPrecio;

        Field:    lblCondPago
            Formula:    WhilePrintingRecords;
                        global stringVar txtCondPago;

        Field:    lblPortes
            Formula:    WhilePrintingRecords;
                        global stringVar txtPortes;

        Field:    lblNumProvCliente
            Formula:    WhilePrintingRecords;
                        global stringVar txtNumProvCliente;

        Field:    lblAIngresar
            Formula:    WhilePrintingRecords;
                        global stringVar txtAIngresar;

        Field:    IBANCCC
            Formula:    if {SINVOICE.ZBANK_0}<>"" and (left({SINVOICE.PTE_0},2)="TR" or left({SINVOICE.PTE_0},3)="ANT" or left({SINVOICE.PTE_0},2)="CF") then
                            {BANK.BICCOD_0} & " - " & left({BANK.IBACOD_0},4)& " " & Mid({BANK.IBACOD_0},5,4) & " " & Mid({BANK.IBACOD_0},9,4) & " " & Mid({BANK.IBACOD_0},13,4) & " " & Mid({BANK.IBACOD_0},17,4)& " " & Mid({BANK.IBACOD_0},21,4) 
                        else if ({SINVOICE.ZBANK_0}="" or ISNULL({SINVOICE.ZBANK_0}) )  and (left({SINVOICE.PTE_0},2)="TR" or left({SINVOICE.PTE_0},3)="ANT" or left({SINVOICE.PTE_0},2)="CF") then
                            {BANK_1.BICCOD_0} & " - " & left({BANK_1.IBACOD_0},4)& " " & Mid({BANK_1.IBACOD_0},5,4) & " " & Mid({BANK_1.IBACOD_0},9,4) & " " & Mid({BANK_1.IBACOD_0},13,4) & " " & Mid({BANK_1.IBACOD_0},17,4)& " " & Mid({BANK_1.IBACOD_0},21,4) 
                        //else  
                        //   {BID.BICCOD_0} & " - " & {BID.IBAN_0} & " " & left({BID.BIDNUM_0},4) & " " & Mid({BID.BIDNUM_0},5,4) & " " & Mid({BID.BIDNUM_0},9,4) & " " & Mid({BID.BIDNUM_0},13,4) & " " & Mid({BID.BIDNUM_0},17,4) & " - " & {BID.PAB1_0};

        Field:    txtdias_pago
            Formula:    WhilePrintingRecords;
                        local stringVar txtdias_pago2;
                        if {BPCUSTOMER.DAYMON_0} <> 0 then
                        (    txtdias_pago2 :=CStr({BPCUSTOMER.DAYMON_0},0);
                            (if {BPCUSTOMER.DAYMON_1} <> 0 then
                                txtdias_pago2 := txtdias_pago2 +" / "+CStr({BPCUSTOMER.DAYMON_1},0);
                                (if {BPCUSTOMER.DAYMON_2} <> 0 then
                                    txtdias_pago2 := txtdias_pago2 +" / "+CStr({BPCUSTOMER.DAYMON_2},0);
                                    (if {BPCUSTOMER.DAYMON_3} <> 0 then
                                        txtdias_pago2 := txtdias_pago2 +" / "+CStr({BPCUSTOMER.DAYMON_3},0);
                                        (if {BPCUSTOMER.DAYMON_4} <> 0 then
                                            txtdias_pago2 := txtdias_pago2 +" / "+CStr({BPCUSTOMER.DAYMON_4},0);
                                            (if {BPCUSTOMER.DAYMON_5} <> 0 then
                                                txtdias_pago2 := txtdias_pago2 +" / "+CStr({BPCUSTOMER.DAYMON_5},0)
                                             )
                                         )
                                    )
                                )
                            )
                        );
                        
                        
                                            
                        
                        txtdias_pago2
                        
                        

        Field:    lbl_diaspago
            Formula:    WhilePrintingRecords;
                        global stringVar txtdias_pago;
                        if {BPCUSTOMER.DAYMON_0} = 0 then
                            txtdias_pago := "";
                                           
                        
                        txtdias_pago
                        
                        

        Field:    lblDir
            Formula:    WhilePrintingRecords;
                        global stringVar txtDir;

        Field:    TEXTOPIE
            Formula:    SELECT {BPARTNER.LAN_0}
                            CASE "SPA": "De acuerdo con el Real Decreto 782/98 Art. 18.1 del Reglamento de la Ley de Envases y Residuos de Envases, la responsabilidad de una correcta gestión medioambiental de los envases industriales será del poseedor final."
                            CASE "FRA": "Conformément à l'article arrêté royal 782/98. 18.1 du Règlement de la loi sur les emballages et les déchets d'emballage, la responsabilité de la gestion de l'environnement de l'emballage industriel sera le détenteur final."
                            DEFAULT: "According with the Royal decree 782/98 Art. 18.1 of the Regulation of the Law of packings (packages) and Residues of Packings (Packages), the responsability of a correct environmental management of the industrial of packing (packages) will belong to the final holder.";

        Field:    Poscod
            Formula:    if {SINVOICE.CRY_0}<>'ES' then
                            SELECT {SINVOICE.CRY_0}
                                case "PT": left({SINVOICE.POSCOD_0},4) + "-" + mid({SINVOICE.POSCOD_0},5,3)
                                default:{SINVOICE.POSCOD_0}
                        else
                            {SINVOICE.POSCOD_0}

        Field:    Poscod_BPR
            Formula:    if {BPADDRESS_BPR.CRY_0}<>'ES' then
                            SELECT {BPADDRESS_BPR.CRY_0}
                                case "PT": left({BPADDRESS_BPR.POSCOD_0},4) + "-" + mid({BPADDRESS_BPR.POSCOD_0},5,3)
                                default:{BPADDRESS_BPR.POSCOD_0}
                        else
                            {BPADDRESS_BPR.POSCOD_0}

        Field:    Precio
            Formula:    if ({?UsarPrecioNeto} = 1) then {SINVOICED.NETPRI_0} else {SINVOICED.GROPRI_0}

    Unused Formula Fields

        Field:    lbltypefacdeb
            Formula:    TextForCode ({?X3DOS},"{SINVOICEV.INVTYP_0}",{?typedeb} )
                        

        Field:    lbltypefacfin
            Formula:    TextForCode ({?X3DOS},"{SINVOICEV.INVTYP_0}",{?typefin} )
                        

        Field:    netapayer
            Formula:    // attention : Calcul différent si la facture est validée ou non !
                        // SINVOICE.STA = Statut de facture / Menu Local n° 429 
                        // (1 = Non Imprimée / 2 = Imprimée  / 3 = Validée)
                        Shared Numbervar Mtacompte_Facture_validee;
                        if {SINVOICE.STA_0} <> 3 then 
                           {SINVOICE.AMTATI_0} - {@Mtacompte_Facture_non_validee}
                        else 
                           {SINVOICE.AMTATI_0} - Mtacompte_Facture_validee;
                        

        Field:    lbltxtent
            Formula:    WhilePrintingRecords;
                        if {SINVOICEV.SIHTEX1_0}[1] <> " " then X3TextFromServer ({?X3DOS},{SINVOICEV.SIHTEX1_0})
                        

        Field:    lbltxtfin
            Formula:    WhilePrintingRecords;
                        if {SINVOICEV.SIHTEX2_0}[1] <> " " then X3TextFromServer ({?X3DOS},{SINVOICEV.SIHTEX2_0})
                        

        Field:    lbltxtlin
            Formula:    if {SINVOICED.SIDTEX_0}[1] <> " " then X3TextFromServer ({?X3DOS},{SINVOICED.SIDTEX_0})
                        

        Field:    Mt_euro
            Formula:    if      {TABCUR.EURRAT_0} = 0
                        then {@netapayer} 
                        else  {@netapayer} / {TABCUR.EURRAT_0}
                        

        Field:    lbl_produit
            Formula:    WhilePrintingRecords;
                        global stringVar totht1;
                        global stringVar totttc1;
                        
                        If {SINVOICEV.PRITYP_0} = 1 then totht1 else totttc1;
                        

        Field:    Mt_produit
            Formula:    If {SINVOICEV.PRITYP_0} = 1 then {SINVOICED.AMTNOTLIN_0} else {SINVOICED.AMTATILIN_0};
                        

        Field:    Mt_sfoot0
            Formula:    if {SINVOICEV.PRITYP_0} = 1 and {SFOOTINV_0.CLCBAS_0} = 1
                           then {SINVOICEV.DTANOT_0}
                           else {SINVOICEV.DTANOT_0} + {SINVOICEV.DTAVATAMT_0}
                        
                        
                        

        Field:    Mt_sfoot1
            Formula:    if {SINVOICEV.PRITYP_0} = 1 and {SFOOTINV_1.CLCBAS_0} = 1
                           then {SINVOICEV.DTANOT_1}
                           else {SINVOICEV.DTANOT_1} + {SINVOICEV.DTAVATAMT_1}
                        

        Field:    Mt_sfoot2
            Formula:    if {SINVOICEV.PRITYP_0} = 1 and {SFOOTINV_2.CLCBAS_0} = 1
                           then {SINVOICEV.DTANOT_2}
                           else {SINVOICEV.DTANOT_2} + {SINVOICEV.DTAVATAMT_2}
                        

        Field:    Mt_sfoot3
            Formula:    if {SINVOICEV.PRITYP_0} = 1 and {SFOOTINV_3.CLCBAS_0} = 1
                           then {SINVOICEV.DTANOT_3}
                           else {SINVOICEV.DTANOT_3} + {SINVOICEV.DTAVATAMT_3}
                        

        Field:    Mt_sfoot4
            Formula:    if {SINVOICEV.PRITYP_0} = 1 and {SFOOTINV_4.CLCBAS_0} = 1
                           then {SINVOICEV.DTANOT_4}
                           else {SINVOICEV.DTANOT_4} + {SINVOICEV.DTAVATAMT_4}
                        

        Field:    lbl_commande
            Formula:    if {SINVOICEV.SIHORI_0} = 2 then {SINVOICEV.SIHORINUM_0}
                         else
                           if {SINVOICEV.SIHORI_0} = 3 then {SDELIVERY.SOHNUM_0}
                        

        Field:    lbl_origlivraison-fact
            Formula:    //if {SINVOICEV.SIHORI_0} = 3 then {SINVOICEV.SIHORINUM_0}
                        // Bug 60458
                        if {SINVOICEV.SIHORI_0} = 3 or ({SINVOICEV.SIHORI_0} = 4 and {SINVOICEV.INVTYP_0} = 2) then {SINVOICEV.SIHORINUM_0};
                        

        Field:    textofchapter
            Formula:    WhilePrintingRecords;
                        global stringVar gratuit    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,1);
                        global stringVar opt        := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,2);
                        global stringVar kit        := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,3);
                        global stringVar mntht      := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,4);
                        global stringVar mntttc     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,5);
                        global stringVar prixht     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,6);
                        global stringVar prixttc    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,7);
                        global stringVar totht      := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,8);
                        global stringVar totttc     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,9);
                        global stringVar produitht  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,10);
                        global stringVar produitttc := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,11);
                        global stringVar facture    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,12);
                        global stringVar avoir      := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,13);
                        global stringVar proforma   := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,14);
                        global stringVar totht1     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,15);
                        global stringVar totttc1    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,16);
                        // rajout du légal
                        //global stringVar modetransp := TranslatedTextForCode ({?X3DOS},{BPARTNER.LAN_0},"{SINVOICEV.EECTRN_0}",{SINVOICEV.EECTRN_0} );
                        //71937 Adaptation multi-législation (lecture dans le sous-état)
                        shared stringVar txtcondiV1 := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,50);
                        shared stringVar txtcondiV2 := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,51);
                        shared stringVar txtcondiV3 := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,52);
                        //71937 Adaptation multi-législation
                        //global stringVar txtexoTVA  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,58);
                        shared stringVar txtexoTVA  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,58);
                        global stringVar aucapitalde  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,59);
                        //71937 Adaptation multi-législation (lecture dans le sous-état)
                        shared stringVar noescompte  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,60);
                        global stringVar naf  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,72);
                        // rajout pour Pied de Pièce
                        // Bug 63666 : TVA -> taxe
                        global stringVar baseTVA    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,108);
                        global stringVar mtTVA      := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,109);
                        global stringVar mtTaxes    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,110);
                        global stringVar acomptesd  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,99);
                        shared stringVar acomptev   := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,41);
                        global stringVar netpayer   := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,42);
                        global stringVar taux       := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,49);
                        // Bug 64355 Mentions légales : taxes soumises, TVA, taxes non soumises
                        global stringVar mtTaxesSoumises        := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,111);
                        global stringVar dontTaxesSoumises      := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,114);
                        global stringVar mtTaxesNonSoumises     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,113);
                        global stringVar dontTaxesNonSoumises   := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,115);
                        global stringVar mtTaxesTVA             := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,40);
                        global stringVar dontTaxesTVA           := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,103);
                        global stringVar mtTaxesTVA_Euros       := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,112);
                        global stringVar dontTaxesTVA_Euros     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,116);
                        // Bug 54231 52497
                        global stringVar eltfact    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,100);
                        global stringVar total_light  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,101);
                        global stringVar total_ligttc := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,102);
                        global stringVar dontTVA    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,103);
                        // Bug 10177 Condition paiement proforma
                        global stringVar condireglt := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,54);
                        // 86064 Nouvelle mention obligatoire : 
                        // Tout retard de paiement entraîne l'exigibilité d'une indemnité forfaitaire pour frais de recouvrement de
                        global stringVar retardpaiement := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2285 ,18);
                        // For SPA 90370 requirement 
                        global stringVar txtcshvat := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2285,19);
                        
                        //Textos personalizados
                        global stringvar txtTel := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,12);
                        global stringvar txtFax := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,13);
                        global stringvar txtNumII := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,25);
                        global stringvar txtNumFactura := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,26);
                        global stringvar txtRepresentante := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,27);
                        global stringvar txtFecha := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,3);
                        global stringvar txtCodCliente := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,4);
                        global stringvar txtCodPedCli := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,5);
                        global stringvar txtReferencia := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,28);
                        global stringvar txtPedidonum := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,2);
                        global stringvar txtEntregadoel := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,29);
                        global stringvar txtEntreganum := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,16);
                        global stringvar txtDir := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,49);
                        global stringvar txtFacOrigen := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,30);
                        global stringvar txtDescripcion := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,31);
                        global stringvar txtArticulo := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,8);
                        global stringvar txtCantidad := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,10);
                        global stringvar txtPrecio := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,38);
                        global stringvar txtCondPago := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,40);
                        global stringvar  txtNumProvCliente:= TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,41); 
                        global stringvar txtPortes := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6970,{SINVOICE.ZPORTES_0});
                        global stringvar  txtImporte:= TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,43); 
                        global stringvar  txtDto:= TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,44); 
                        global stringvar  txtAIngresar:= TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,53);
                        global stringvar txtDias_pago := TextOfChapter ({?X3DOS},"SPA",6969,57);
                        
                        

        Field:    tax_0
            Formula:    if {SINVOICE.TAX_0} = {SINVOICEV.VAT_0} then {SINVOICEV.VATRAT_0}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.VAT_1} then {SINVOICEV.VATRAT_1}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.VAT_2} then {SINVOICEV.VATRAT_2}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.VAT_3} then {SINVOICEV.VATRAT_3}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.VAT_4} then {SINVOICEV.VATRAT_4}
                        
                        else if {SINVOICE.TAX_0} = {SINVOICEV.DTAVAT_0} then {SINVOICEV.DTAVATRAT_0}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.DTAVAT_1} then {SINVOICEV.DTAVATRAT_1}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.DTAVAT_2} then {SINVOICEV.DTAVATRAT_2}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.DTAVAT_3} then {SINVOICEV.DTAVATRAT_3}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.DTAVAT_4} then {SINVOICEV.DTAVATRAT_4}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.DTAVAT_5} then {SINVOICEV.DTAVATRAT_5}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.DTAVAT_6} then {SINVOICEV.DTAVATRAT_6}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.DTAVAT_7} then {SINVOICEV.DTAVATRAT_7}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.DTAVAT_8} then {SINVOICEV.DTAVATRAT_8}
                        else if {SINVOICE.TAX_0} = {SINVOICEV.DTAVAT_9} then {SINVOICEV.DTAVATRAT_9}
                        
                        

        Field:    tax_1
            Formula:    if {SINVOICE.TAX_1} = {SINVOICEV.VAT_0} then {SINVOICEV.VATRAT_0}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.VAT_1} then {SINVOICEV.VATRAT_1}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.VAT_2} then {SINVOICEV.VATRAT_2}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.VAT_3} then {SINVOICEV.VATRAT_3}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.VAT_4} then {SINVOICEV.VATRAT_4}
                        
                        else if {SINVOICE.TAX_1} = {SINVOICEV.DTAVAT_0} then {SINVOICEV.DTAVATRAT_0}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.DTAVAT_1} then {SINVOICEV.DTAVATRAT_1}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.DTAVAT_2} then {SINVOICEV.DTAVATRAT_2}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.DTAVAT_3} then {SINVOICEV.DTAVATRAT_3}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.DTAVAT_4} then {SINVOICEV.DTAVATRAT_4}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.DTAVAT_5} then {SINVOICEV.DTAVATRAT_5}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.DTAVAT_6} then {SINVOICEV.DTAVATRAT_6}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.DTAVAT_7} then {SINVOICEV.DTAVATRAT_7}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.DTAVAT_8} then {SINVOICEV.DTAVATRAT_8}
                        else if {SINVOICE.TAX_1} = {SINVOICEV.DTAVAT_9} then {SINVOICEV.DTAVATRAT_9}
                        
                        

        Field:    tax_2
            Formula:    if {SINVOICE.TAX_2} = {SINVOICEV.VAT_0} then {SINVOICEV.VATRAT_0}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.VAT_1} then {SINVOICEV.VATRAT_1}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.VAT_2} then {SINVOICEV.VATRAT_2}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.VAT_3} then {SINVOICEV.VATRAT_3}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.VAT_4} then {SINVOICEV.VATRAT_4}
                        
                        else if {SINVOICE.TAX_2} = {SINVOICEV.DTAVAT_0} then {SINVOICEV.DTAVATRAT_0}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.DTAVAT_1} then {SINVOICEV.DTAVATRAT_1}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.DTAVAT_2} then {SINVOICEV.DTAVATRAT_2}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.DTAVAT_3} then {SINVOICEV.DTAVATRAT_3}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.DTAVAT_4} then {SINVOICEV.DTAVATRAT_4}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.DTAVAT_5} then {SINVOICEV.DTAVATRAT_5}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.DTAVAT_6} then {SINVOICEV.DTAVATRAT_6}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.DTAVAT_7} then {SINVOICEV.DTAVATRAT_7}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.DTAVAT_8} then {SINVOICEV.DTAVATRAT_8}
                        else if {SINVOICE.TAX_2} = {SINVOICEV.DTAVAT_9} then {SINVOICEV.DTAVATRAT_9}
                        
                        

        Field:    lbl_modetransp
            Formula:    WhilePrintingRecords;
                        stringVar X3TEX := "TABMODELIV~SHOAXX~"+{TABMODELIV.MDL_0}+"~~";
                        X3TranslatedText ({?X3DOS},{BPARTNER.LAN_0},X3TEX)

        Field:    lbl_txtexoTVA
            Formula:    WhilePrintingRecords;
                        //71937 Adaptation multi-législation
                        //global stringVar txtexoTVA;
                        shared stringVar txtexoTVA;
                        txtexoTVA;

        Field:    gcolrem1
            Formula:    WhilePrintingRecords;
                        Global StringVar Array Tarif_colonne;
                        Local  NumberVar i := 2;
                        
                        if {?NBMAXTARIF} >= i then
                          Tarif_colonne[i]
                        else
                          "";
                        

        Field:    gcolrem2
            Formula:    WhilePrintingRecords;
                        Global StringVar Array Tarif_colonne;
                        Local  NumberVar i := 3;
                        
                        if {?NBMAXTARIF} >= i then
                          Tarif_colonne[i]
                        else
                          "";
                        

        Field:    gfmtrem1
            Formula:    WhilePrintingRecords;
                        Global NumberVar Array Tarif_format_Dec;
                        local numbervar i := 2;
                        
                        if {?NBMAXTARIF} >= i then
                          Tarif_format_Dec[i]
                        else
                          {@decimald};
                        

        Field:    gfmtrem2
            Formula:    WhilePrintingRecords;
                        Global NumberVar Array Tarif_format_Dec;
                        local numbervar i := 3;
                        
                        if {?NBMAXTARIF} >= i then
                          Tarif_format_Dec[i]
                        else
                          {@decimald};
                        

        Field:    INIT_Colonnes_Tarif
            Formula:    WhilePrintingRecords;
                        Global StringVar Array Tarif_colonne;
                        // Global NumberVar Array Tarif_format_Ent;
                        Global NumberVar Array Tarif_format_Dec;
                        Local NumberVar i;
                        Local StringVar X3TEX;
                        Local Stringvar Array x := MakeArray ({PRICSTRUCT.FMTCOL_0}, {PRICSTRUCT.FMTCOL_1}, {PRICSTRUCT.FMTCOL_2}, {PRICSTRUCT.FMTCOL_3}, {PRICSTRUCT.FMTCOL_4}, {PRICSTRUCT.FMTCOL_5}, {PRICSTRUCT.FMTCOL_6}, {PRICSTRUCT.FMTCOL_7}, {PRICSTRUCT.FMTCOL_8});
                        Local Numbervar Array y := MakeArray ({PRICSTRUCT.VALTYP_0}, {PRICSTRUCT.VALTYP_1}, {PRICSTRUCT.VALTYP_2}, {PRICSTRUCT.VALTYP_3}, {PRICSTRUCT.VALTYP_4}, {PRICSTRUCT.VALTYP_5}, {PRICSTRUCT.VALTYP_6}, {PRICSTRUCT.VALTYP_7}, {PRICSTRUCT.VALTYP_8});
                        Local Stringvar Array z;
                        
                        if {?NBMAXTARIF} > 0 then
                         (
                           Redim Tarif_colonne    [{?NBMAXTARIF}];
                           Redim Tarif_format_Dec [{?NBMAXTARIF}];
                        
                           // Boucle sur le nombre MAX de colonne tarif pour remplir les décimaux an fonction de la structure tarif
                           for i := 1 to {?NBMAXTARIF} do
                            (
                              X3TEX := "PRICSTRUCT~SHOAXX(" + totext(i - 1,0) + ")~" + 
                                       ToText({PRICSTRUCT.BPCBPS_0},0) + "~" + 
                                       {PRICSTRUCT.PLISTC_0} + "~";
                              Tarif_colonne[i] := X3TranslatedText ({?X3DOS}, {?X3LAN}, X3TEX);
                                    // 1. Epuration des caractères alphabétiques pour les formats Numériques
                              X3TEX := join(split(x[i] ,"F"),"");
                              X3TEX := join(split(X3TEX,"#"),"");
                                    // 2. Si Format numérique, on le prend en compte
                              z := split(X3TEX,".");
                              If NumericText(join(z,"")) then
                               (
                                 // Tarif_format_Ent[i] := tonumber(z[1]);  // PAS BESOIN DE LA PARTIE ENTIERE !
                                 Tarif_format_Dec[i] := tonumber(z[2]);
                               )
                              else  // Sinon, en fonction du type de donnée, on fixe le format
                               (
                                 if y[i] = 2 or y[i] = 3 then          // %Cumul ou %Cascade
                                   Tarif_format_Dec[i] := 2
                                 else                                  // Montant
                                   Tarif_format_Dec[i] := {@decimald};
                               );
                            ); 
                         );
                        

        Field:    lbl_netpayerU
            Formula:    WhilePrintingRecords;
                        global stringVar netpayer;
                        UpperCase (netpayer);

        Field:    qt_rest_liv
            Formula:    if {SORDERQ.SOQSTA_0} < 3 then
                            if {SINVOICEV.SIHORI_0} = 2 and ({SORDERQ.QTY_0}-({SORDERQ.ODLQTY_0}+{SORDERQ.INVQTY_0}) > 0) then
                                {SORDERQ.QTY_0}-({SORDERQ.ODLQTY_0}+{SORDERQ.INVQTY_0})
                            else 
                                if {SINVOICEV.SIHORI_0} = 3 and ({SORDERQ.QTY_0}-({SORDERQ.ODLQTY_0}+{SORDERQ.DLVQTY_0}) > 0) then
                                    {SORDERQ.QTY_0}-({SORDERQ.ODLQTY_0}+{SORDERQ.DLVQTY_0})
                                else 
                                    0
                        else
                            0
                        

        Field:    txtptedes
            Formula:    // Bug 10177 Condition paiement proforma
                        WhilePrintingRecords;
                        stringVar X3TEX := "TABPAYTERM~DESAXX~"+{TABPAYTERM.PTE_0}+"~~";
                        X3TranslatedText ({?X3DOS},{BPARTNER.LAN_0},X3TEX)

        Field:    mention
            Formula:    // 2 = DUPLICATA
                        // 3 = PROVISOIRE
                        // Fiche 85859 - Mention "provisoire" lors de l'impression de plusieures factures
                        //if {?mention}=2 then
                        if {AREPORTM.CLEA11_0} = '2' then
                         TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2289 ,73)
                        else
                         //if {?mention}=3 then
                         if {AREPORTM.CLEA11_0} = '3' then
                          TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2289 ,74)
                         ;
                         

        Field:    decimalEuro
            Formula:    // 64355
                        

        Field:    copynum
            Formula:    if {AREPORTM.NUMCOP_0}>6 then
                            TextofChapter({?X3DOS},{?X3LAN},2280, 6)
                        else
                            if {AREPORTM.NUMCOP_0}>0 then
                                TextofChapter({?X3DOS},{?X3LAN},2280, {AREPORTM.NUMCOP_0})

        Field:    MtAcptEcheance
            Formula:    //CPO 83064
                        Shared numbervar MtAcptEcheance;

        Field:    Sdd1Affiche
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        if {?paramsddprn}>'1' and  {SINVOICE.BPRPAY_0}={SINVOICE.BPR_0} then true

        Field:    Sdd1FormNbSddIni
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        shared numbervar NbEchSdd;
                        

        Field:    IniImpPag
            Formula:    Shared numbervar sumpag;
                        sumpag:=0;
                        
                        sumpag;

        Field:    TImpoPag
            Formula:    Shared numbervar sumpag;
                        sumpag:=sumpag+{@Mt_net};
                        
                        sumpag;

        Field:    TImpPag
            Formula:    Shared numbervar sumpag;
                        
                        
                        sumpag;

        Field:    lblFax
            Formula:    WhilePrintingRecords;
                        global stringVar txtFax;

        Field:    lblTel
            Formula:    WhilePrintingRecords;
                        global stringVar txtTel;

        Field:    lblReferencia
            Formula:    WhilePrintingRecords;
                        global stringVar txtReferencia;

        Field:    lblPedidonum
            Formula:    WhilePrintingRecords;
                        global stringVar txtPedidonum;

        Field:    numhoja
            Formula:    WhilePrintingRecords;
                        global Numbervar txtlineas ;
                        
                        txtlineas :=txtlineas + 1

        Field:    numlineascero
            Formula:    WhilePrintingRecords;
                        global Numbervar txtlineas ;
                        
                        txtlineas:=0;

        Field:    CUSREFDES
            Formula:    WhileReadingRecords;
                        stringVar X3TEX := "ITMCUSNOM~DESAXX~"+{ITMMASTER.CUSREF_0}+"~~";
                        X3TranslatedText ({?X3DOS},{BPARTNER.LAN_0},X3TEX)
                        //{ATEXTRA_INTRASTAT.TEXTE_0}

        Field:    SumDto1

        Field:    lbltypefacdeb
            Formula:    TextForCode ({?X3DOS},"{SINVOICEV.INVTYP_0}",{?typedeb} )
                        

        Field:    lbltypefacfin
            Formula:    TextForCode ({?X3DOS},"{SINVOICEV.INVTYP_0}",{?typefin} )
                        

        Field:    textofchapter
            Formula:    WhilePrintingRecords;
                        global stringVar gratuit    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,1);
                        global stringVar opt        := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,2);
                        global stringVar kit        := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,3);
                        global stringVar mntht      := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,4);
                        global stringVar mntttc     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,5);
                        global stringVar prixht     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,6);
                        global stringVar prixttc    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,7);
                        global stringVar totht      := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,8);
                        global stringVar totttc     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,9);
                        global stringVar produitht  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,10);
                        global stringVar produitttc := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,11);
                        global stringVar facture    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,12);
                        global stringVar avoir      := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,13);
                        global stringVar proforma   := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,14);
                        global stringVar totht1     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,15);
                        global stringVar totttc1    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,16);
                        // rajout du légal
                        //global stringVar modetransp := TranslatedTextForCode ({?X3DOS},{BPARTNER.LAN_0},"{SINVOICEV.EECTRN_0}",{SINVOICEV.EECTRN_0} );
                        //71937 Adaptation multi-législation (lecture dans le sous-état)
                        shared stringVar txtcondiV1 := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,50);
                        shared stringVar txtcondiV2 := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,51);
                        shared stringVar txtcondiV3 := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,52);
                        //71937 Adaptation multi-législation
                        //global stringVar txtexoTVA  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,58);
                        shared stringVar txtexoTVA  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,58);
                        global stringVar aucapitalde  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,59);
                        //71937 Adaptation multi-législation (lecture dans le sous-état)
                        shared stringVar noescompte  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,60);
                        global stringVar naf  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,72);
                        // rajout pour Pied de Pièce
                        // Bug 63666 : TVA -> taxe
                        global stringVar baseTVA    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,108);
                        global stringVar mtTVA      := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,109);
                        global stringVar mtTaxes    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,110);
                        global stringVar acomptesd  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,99);
                        shared stringVar acomptev   := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,41);
                        global stringVar netpayer   := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,42);
                        global stringVar taux       := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,49);
                        // Bug 64355 Mentions légales : taxes soumises, TVA, taxes non soumises
                        global stringVar mtTaxesSoumises        := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,111);
                        global stringVar dontTaxesSoumises      := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,114);
                        global stringVar mtTaxesNonSoumises     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,113);
                        global stringVar dontTaxesNonSoumises   := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,115);
                        global stringVar mtTaxesTVA             := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,40);
                        global stringVar dontTaxesTVA           := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,103);
                        global stringVar mtTaxesTVA_Euros       := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,112);
                        global stringVar dontTaxesTVA_Euros     := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,116);
                        // Bug 54231 52497
                        global stringVar eltfact    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,100);
                        global stringVar total_light  := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,101);
                        global stringVar total_ligttc := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,102);
                        global stringVar dontTVA    := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,103);
                        // Bug 10177 Condition paiement proforma
                        global stringVar condireglt := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2281,54);
                        // 86064 Nouvelle mention obligatoire : 
                        // Tout retard de paiement entraîne l'exigibilité d'une indemnité forfaitaire pour frais de recouvrement de
                        global stringVar retardpaiement := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2285 ,18);
                        // For SPA 90370 requirement 
                        global stringVar txtcshvat := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2285,19);
                        
                        //Textos personalizados
                        global stringvar txtTel := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,12);
                        global stringvar txtFax := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,13);
                        global stringvar txtNumII := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,25);
                        global stringvar txtNumFactura := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,26);
                        global stringvar txtRepresentante := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,27);
                        global stringvar txtFecha := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,3);
                        global stringvar txtCodCliente := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,4);
                        global stringvar txtCodPedCli := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,5);
                        global stringvar txtReferencia := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,28);
                        global stringvar txtPedidonum := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,2);
                        global stringvar txtEntregadoel := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,29);
                        global stringvar txtEntreganum := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,16);
                        global stringvar txtDir := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,49);
                        global stringvar txtFacOrigen := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,30);
                        global stringvar txtDescripcion := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,31);
                        global stringvar txtArticulo := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,8);
                        global stringvar txtCantidad := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,10);
                        global stringvar txtPrecio := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,38);
                        global stringvar txtCondPago := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,40);
                        global stringvar  txtNumProvCliente:= TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,41); 
                        global stringvar txtPortes := TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6970,{SINVOICE.ZPORTES_0});
                        global stringvar  txtImporte:= TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,43); 
                        global stringvar  txtDto:= TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,44); 
                        global stringvar  txtAIngresar:= TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,53);
                        global stringvar txtDias_pago := TextOfChapter ({?X3DOS},"SPA",6969,57);
                        
                        

        Field:    copynum
            Formula:    if {AREPORTM.NUMCOP_0}>6 then
                            TextofChapter({?X3DOS},{?X3LAN},2280, 6)
                        else
                            if {AREPORTM.NUMCOP_0}>0 then
                                TextofChapter({?X3DOS},{?X3LAN},2280, {AREPORTM.NUMCOP_0})

        Field:    INIT_Colonnes_Tarif
            Formula:    WhilePrintingRecords;
                        Global StringVar Array Tarif_colonne;
                        // Global NumberVar Array Tarif_format_Ent;
                        Global NumberVar Array Tarif_format_Dec;
                        Local NumberVar i;
                        Local StringVar X3TEX;
                        Local Stringvar Array x := MakeArray ({PRICSTRUCT.FMTCOL_0}, {PRICSTRUCT.FMTCOL_1}, {PRICSTRUCT.FMTCOL_2}, {PRICSTRUCT.FMTCOL_3}, {PRICSTRUCT.FMTCOL_4}, {PRICSTRUCT.FMTCOL_5}, {PRICSTRUCT.FMTCOL_6}, {PRICSTRUCT.FMTCOL_7}, {PRICSTRUCT.FMTCOL_8});
                        Local Numbervar Array y := MakeArray ({PRICSTRUCT.VALTYP_0}, {PRICSTRUCT.VALTYP_1}, {PRICSTRUCT.VALTYP_2}, {PRICSTRUCT.VALTYP_3}, {PRICSTRUCT.VALTYP_4}, {PRICSTRUCT.VALTYP_5}, {PRICSTRUCT.VALTYP_6}, {PRICSTRUCT.VALTYP_7}, {PRICSTRUCT.VALTYP_8});
                        Local Stringvar Array z;
                        
                        if {?NBMAXTARIF} > 0 then
                         (
                           Redim Tarif_colonne    [{?NBMAXTARIF}];
                           Redim Tarif_format_Dec [{?NBMAXTARIF}];
                        
                           // Boucle sur le nombre MAX de colonne tarif pour remplir les décimaux an fonction de la structure tarif
                           for i := 1 to {?NBMAXTARIF} do
                            (
                              X3TEX := "PRICSTRUCT~SHOAXX(" + totext(i - 1,0) + ")~" + 
                                       ToText({PRICSTRUCT.BPCBPS_0},0) + "~" + 
                                       {PRICSTRUCT.PLISTC_0} + "~";
                              Tarif_colonne[i] := X3TranslatedText ({?X3DOS}, {?X3LAN}, X3TEX);
                                    // 1. Epuration des caractères alphabétiques pour les formats Numériques
                              X3TEX := join(split(x[i] ,"F"),"");
                              X3TEX := join(split(X3TEX,"#"),"");
                                    // 2. Si Format numérique, on le prend en compte
                              z := split(X3TEX,".");
                              If NumericText(join(z,"")) then
                               (
                                 // Tarif_format_Ent[i] := tonumber(z[1]);  // PAS BESOIN DE LA PARTIE ENTIERE !
                                 Tarif_format_Dec[i] := tonumber(z[2]);
                               )
                              else  // Sinon, en fonction du type de donnée, on fixe le format
                               (
                                 if y[i] = 2 or y[i] = 3 then          // %Cumul ou %Cascade
                                   Tarif_format_Dec[i] := 2
                                 else                                  // Montant
                                   Tarif_format_Dec[i] := {@decimald};
                               );
                            ); 
                         );
                        

        Field:    mention
            Formula:    // 2 = DUPLICATA
                        // 3 = PROVISOIRE
                        // Fiche 85859 - Mention "provisoire" lors de l'impression de plusieures factures
                        //if {?mention}=2 then
                        if {AREPORTM.CLEA11_0} = '2' then
                         TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2289 ,73)
                        else
                         //if {?mention}=3 then
                         if {AREPORTM.CLEA11_0} = '3' then
                          TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},2289 ,74)
                         ;
                         

    Summary Fields

        Field:    Mt_net
            Formula:    Sum ({@Mt_net}, {SINVOICED.SDHNUM_0})

        Field:    Mt_net
            Formula:    Sum ({@Mt_net}, {SINVOICEV.NUM_0})

    Running Totals

        Running Total:    RTotal0
            Field:    RTotal0
            Type:    RTotal0
            Evaluate:    RTotal0
            Evaluate Condition:    RTotal0
            Reset:    RTotal0
            Reset Condition:    RTotal0

    Report Header

        Conditional Formulas

            Condition:    EnableSuppress
                Formula:    if {?impselections} =0 then true else false

            Condition:    EnableResetPageNumberAfter
                Formula:    if {?impselections} = 1 then true else false ;
                            

        Section:    Section a

            Fields

                Field:    Champ1
                    Data Source:    {?X3TIT}
                    Data Type:    String

                Field:    Dateimpression2
                    Data Source:    PrintDate
                    Data Type:    Date
                    Format:    Date and Time
                        Order:    Date Time
                        Date Type:    System Default
                        Date Format:    DD/MM/YYYY hh:mm:ss  AM

                Field:    Heureimpression1
                    Data Source:    PrintTime
                    Data Type:    Time
                    Format:    Date and Time
                        Order:    Date Time
                        Date Type:    System Default
                        Time Format:    MM/DD/YY h:mm:ss

                Field:    X3DOS1
                    Data Source:    {?X3DOS}
                    Data Type:    String

                Field:    X3ETA1
                    Data Source:    {?X3ETA}
                    Data Type:    String

                Field:    X3OPE1
                    Data Source:    {?X3OPE}
                    Data Type:    String

                Field:    sitedeb1
                    Data Source:    {?sitedeb}
                    Data Type:    String

                Field:    facturedeb1
                    Data Source:    {?facturedeb}
                    Data Type:    String

                Field:    clientdeb1
                    Data Source:    {?clientdeb}
                    Data Type:    String

                Field:    lbltypefacdeb1
                    Data Source:    {@lbltypefacdeb}
                    Data Type:    String

                Field:    datedeb1
                    Data Source:    {?datedeb}
                    Data Type:    Date
                    Format:    Date and Time
                        Order:    Date Time
                        Date Type:    System Default
                        Date Format:    DD/MM/YYYY hh:mm:ss  AM

                Field:    lbltypefacfin1
                    Data Source:    {@lbltypefacfin}
                    Data Type:    String

                Field:    sitefin1
                    Data Source:    {?sitefin}
                    Data Type:    String

                Field:    facturefin1
                    Data Source:    {?facturefin}
                    Data Type:    String

                Field:    clientfin1
                    Data Source:    {?clientfin}
                    Data Type:    String

                Field:    datefin1
                    Data Source:    {?datefin}
                    Data Type:    Date
                    Format:    Date and Time
                        Order:    Date Time
                        Date Type:    System Default
                        Date Format:    DD/MM/YYYY hh:mm:ss  AM

                Field:    NUMREQ01
                    Data Source:    {AREPORTM.NUMREQ_0}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    False
                        Reverse Sign:    False
                        Number Style:    5555555

            Text Fields

                Text Field:    Text8

                Text Field:    Text10
                    Text:    Criterios de selección

                Text Field:    Text21
                    Text:    Planta de venta

                Text Field:    Text20
                    Text:    N° de factura

                Text Field:    Text13
                    Text:    Cliente

                Text Field:    Text16
                    Text:    Tipo factura

                Text Field:    Text12
                    Text:    Fecha factura

                Text Field:    Text26
                    Text:    De

                Text Field:    Text11
                    Text:    De

                Text Field:    Text14
                    Text:    De

                Text Field:    Text15
                    Text:    De

                Text Field:    Text17
                    Text:    De

                Text Field:    Text42
                    Text:    a

                Text Field:    Text18
                    Text:    a

                Text Field:    Text19
                    Text:    a

                Text Field:    Text22
                    Text:    a

                Text Field:    Text23
                    Text:    a

                Text Field:    Text24
                    Text:    Nº de petición

                Text Field:    Texte16
                    Text:    Ascendente

                Text Field:    Text30
                    Text:    Clasif. por nº de factura

            Boxes

                Box:    Box29
                    Ends in Section:    Section1
                    Size:    477x19
                    Line Type:    Single
                    Line Thickness:    0

                Box:    Box28
                    Ends in Section:    Section1
                    Size:    477x19
                    Line Type:    Single
                    Line Thickness:    0

                Box:    Box23
                    Ends in Section:    Section1
                    Size:    477x19
                    Line Type:    Single
                    Line Thickness:    0

                Box:    Box22
                    Ends in Section:    Section1
                    Size:    477x19
                    Line Type:    Single
                    Line Thickness:    0

                Box:    Box11
                    Ends in Section:    Section1
                    Size:    476x19
                    Line Type:    Single
                    Line Thickness:    0

                Box:    Box6
                    Ends in Section:    Section1
                    Size:    476x19
                    Line Type:    Single
                    Line Thickness:    0

                Box:    Box2
                    Ends in Section:    Section1
                    Size:    476x19
                    Line Type:    Single
                    Line Thickness:    0

                Box:    Box3
                    Ends in Section:    Section1
                    Size:    477x19
                    Line Type:    Single
                    Line Thickness:    0

            SubReports

                SubReport:    logo2.rpt
                    Links:    {?X3DOS} => {?X3DOS}

                SubReport:    logo3.rpt
                    Links:    {?X3DOS} => {?X3DOS}

        Section:    Section b

            Fields

                Field:    MtacompteDECLARATION1
                    Data Source:    {@Mtacompte_Facture_validee}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

            Text Fields

                Text Field:    Text25

    Page Header

        Section:    Section a

            Fields

                Field:    textofchapter1
                    Data Source:    {@textofchapter}
                    Data Type:    String

                Field:    imprimerretardpaiement1
                    Data Source:    {@imprimer retard paiement}
                    Data Type:    String

        Section:    Section b

            Fields

                Field:    Champ13
                    Data Source:    {@lbl_typefac}
                    Data Type:    String

                Field:    SCINUM01
                    Data Source:    {COMPANY.SCINUM_0}
                    Data Type:    String
                    Suppression Formula:    {?impcabecera}<>1 or (not {@SddAffiche})

            Text Fields

                Text Field:    Text34
                    Text:    Id Acreedor SEPA :
                    Suppression Formula:    {?impcabecera}<>1 or (not {@SddAffiche})

            Pictures

                Picture:    Picture2
                    Size:    654x64
                    Suppression Formula:    {?impcabecera}<>1 or ({SINVOICE.CPY_0}<>"GT500" and {SINVOICE.CPY_0}<>"IF250" and {SINVOICE.CPY_0}<>"IT350" and {SINVOICE.CPY_0}<>"TI300")

                Picture:    Picture4
                    Size:    695x72
                    Suppression Formula:    {?impcabecera}<>1 or ({SINVOICE.CPY_0}<>"GT500" and {SINVOICE.CPY_0}<>"IF250" and 
                                            {SINVOICE.CPY_0}<>"IT350" and {SINVOICE.CPY_0}<>"FA200")

            Lines

                Line:    Ligne2
                    Ends in Section:    Section10
                    Line Type:    Single
                    Line Thickness:    30

                Line:    Ligne3
                    Ends in Section:    Section10
                    Line Type:    Single
                    Line Thickness:    10

        Section:    Section c

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    //if len({SINVOICE.BPRNAM_0}+{SINVOICE.BPAADDLIG_0}+{SINVOICE.BPAADDLIG_1}+{SINVOICE.BPAADDLIG_2}+{SINVOICE.POSCOD_0}+{SINVOICE.CTY_0}+{SINVOICE.SAT_0}+{SINVOICE.CRYNAM_0})=0 then true
                                //else if {SINVOICE.INVTYP_0} = 2 or {SINVOICE.INVTYP_0} = 5 then true
                                //else false;
                                {SINVOICE.SIVTYP_0} = "ABC" OR {SINVOICE.SIVTYP_0} = "FRC"

            Fields

                Field:    BPYNAM01
                    Data Source:    {SINVOICE.BPYNAM_0}
                    Data Type:    String

                Field:    Champ25
                    Data Source:    {SINVOICE.BPRNAM_0}
                    Data Type:    String

                Field:    Champ26
                    Data Source:    {SINVOICE.BPAADDLIG_0}
                    Data Type:    String

                Field:    Champ27
                    Data Source:    {SINVOICE.BPAADDLIG_1}
                    Data Type:    String

                Field:    Champ28
                    Data Source:    {SINVOICE.BPAADDLIG_2}
                    Data Type:    String

                Field:    Champ29
                    Data Source:    {SINVOICE.CTY_0}
                    Data Type:    String

                Field:    Champ31
                    Data Source:    {SINVOICE.CRYNAM_0}
                    Data Type:    String
                    Suppression Formula:    // Si la province SAT est présente elle est affichée et le pays situé à la même place n'est pas affiché.
                                            //    Le pays est affiché dans ce cas à la droite de la province.
                                            // Sinon, le pays est affiché comme auparavant.
                                            // Pour la V140 et la V5. (Pour la V6, le champs SAT n'est plus soumis a code activité et est affiché)
                                            if {SINVOICE.SAT_0} = "" then 
                                               True
                                            else 
                                               False;
                                            

                Field:    ProvinceSINVOICE1
                    Data Source:    {@Province_SINVOICE}
                    Data Type:    String

                Field:    copynum1
                    Data Source:    {@copynum}
                    Data Type:    String

                Field:    BPYADDLIG01
                    Data Source:    {SINVOICE.BPYADDLIG_0}
                    Data Type:    String

                Field:    BPYADDLIG11
                    Data Source:    {SINVOICE.BPYADDLIG_1}
                    Data Type:    String

                Field:    BPYADDLIG21
                    Data Source:    {SINVOICE.BPYADDLIG_2}
                    Data Type:    String

                Field:    BPYPOSCOD01
                    Data Source:    {SINVOICE.BPYPOSCOD_0}
                    Data Type:    String

                Field:    BPYCTY01
                    Data Source:    {SINVOICE.BPYCTY_0}
                    Data Type:    String

                Field:    BPYSAT01
                    Data Source:    {SINVOICE.BPYSAT_0}
                    Data Type:    String

                Field:    Poscod1
                    Data Source:    {@Poscod}
                    Data Type:    String

            Boxes

                Box:    Cadre1
                    Ends in Section:    PageHeaderSection4
                    Size:    323x110
                    Line Type:    Single
                    Line Thickness:    20

        Section:    Section d

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    //if len({SINVOICE.BPRNAM_0}+{SINVOICE.BPAADDLIG_0}+{SINVOICE.BPAADDLIG_1}+{SINVOICE.BPAADDLIG_2}+{SINVOICE.POSCOD_0}+{SINVOICE.CTY_0}+{SINVOICE.SAT_0}+{SINVOICE.CRYNAM_0})=0 then false
                                {SINVOICE.SIVTYP_0} <> "ABC"
                                //else true;

            Fields

                Field:    Champ39
                    Data Source:    {BPADDRESS_BPR.BPAADDLIG_0}
                    Data Type:    String

                Field:    Champ40
                    Data Source:    {BPADDRESS_BPR.BPAADDLIG_1}
                    Data Type:    String

                Field:    Champ41
                    Data Source:    {BPADDRESS_BPR.BPAADDLIG_2}
                    Data Type:    String

                Field:    Champ43
                    Data Source:    {BPADDRESS_BPR.CTY_0}
                    Data Type:    String

                Field:    Champ44
                    Data Source:    {BPADDRESS_BPR.CRYNAM_0}
                    Data Type:    String
                    Suppression Formula:    // Si la province SAT est présente elle est affichée et le pays situé à la même place n'est pas affiché.
                                            //    Le pays est affiché dans ce cas à la droite de la province.
                                            // Sinon, le pays est affiché comme auparavant.
                                            // Pour la V140 et la V5. (Pour la V6, le champs SAT n'est plus soumis a code activité et est affiché)
                                            if {BPADDRESS_BPR.SAT_0} = "" then 
                                               True
                                            else 
                                               False;
                                            

                Field:    Champ45
                    Data Source:    {BPARTNER.BPRNAM_0}
                    Data Type:    String

                Field:    ProvinceBPADDRESSBPR1
                    Data Source:    {@Province_BPADDRESS_BPR}
                    Data Type:    String

                Field:    copynum2
                    Data Source:    {@copynum}
                    Data Type:    String

                Field:    PoscodBPR1
                    Data Source:    {@Poscod_BPR}
                    Data Type:    String

            Boxes

                Box:    Cadre2
                    Ends in Section:    PageHeaderSection5
                    Size:    323x110
                    Line Type:    Single
                    Line Thickness:    20

        Section:    Section e

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    //{SINVOICE.SIVTYP_0} = "ABC"
                                {SINVOICE.SIVTYP_0} <> "FRC"

            Fields

                Field:    BPAADDLIG01
                    Data Source:    {BPADDRESS_BPR.BPAADDLIG_0}
                    Data Type:    String

                Field:    BPAADDLIG11
                    Data Source:    {BPADDRESS_BPR.BPAADDLIG_1}
                    Data Type:    String

                Field:    BPAADDLIG21
                    Data Source:    {BPADDRESS_BPR.BPAADDLIG_2}
                    Data Type:    String

                Field:    CTY01
                    Data Source:    {BPADDRESS_BPR.CTY_0}
                    Data Type:    String

                Field:    CRYNAM01
                    Data Source:    {BPADDRESS_BPR.CRYNAM_0}
                    Data Type:    String
                    Suppression Formula:    // Si la province SAT est présente elle est affichée et le pays situé à la même place n'est pas affiché.
                                            //    Le pays est affiché dans ce cas à la droite de la province.
                                            // Sinon, le pays est affiché comme auparavant.
                                            // Pour la V140 et la V5. (Pour la V6, le champs SAT n'est plus soumis a code activité et est affiché)
                                            if {BPADDRESS_BPR.SAT_0} = "" then 
                                               True
                                            else 
                                               False;
                                            

                Field:    BPRNAM01
                    Data Source:    {BPARTNER.BPRNAM_0}
                    Data Type:    String

                Field:    ProvinceBPADDRESSBPR2
                    Data Source:    {@Province_BPADDRESS_BPR}
                    Data Type:    String

                Field:    copynum3
                    Data Source:    {@copynum}
                    Data Type:    String

                Field:    PoscodBPR2
                    Data Source:    {@Poscod_BPR}
                    Data Type:    String

                Field:    BPDNAM02
                    Data Source:    {SINVOICEV.BPDNAM_0}
                    Data Type:    String

                Field:    BPDADDLIG01
                    Data Source:    {SINVOICEV.BPDADDLIG_0}
                    Data Type:    String

                Field:    BPDADDLIG12
                    Data Source:    {SINVOICEV.BPDADDLIG_1}
                    Data Type:    String

                Field:    BPDADDLIG22
                    Data Source:    {SINVOICEV.BPDADDLIG_2}
                    Data Type:    String

                Field:    BPDPOSCOD02
                    Data Source:    {SINVOICEV.BPDPOSCOD_0}
                    Data Type:    String

                Field:    BPDCTY02
                    Data Source:    {SINVOICEV.BPDCTY_0}
                    Data Type:    String

                Field:    BPDSAT02
                    Data Source:    {SINVOICEV.BPDSAT_0}
                    Data Type:    String

            Boxes

                Box:    Box1
                    Ends in Section:    PageHeaderSection10
                    Size:    323x110
                    Line Type:    Single
                    Line Thickness:    20

        Section:    Section f

            Fields

                Field:    lblFecha1
                    Data Source:    {@lblFecha}
                    Data Type:    String

                Field:    lblNumFactura1
                    Data Source:    {@lblNumFactura}
                    Data Type:    String

                Field:    Champ22
                    Data Source:    {SINVOICEV.NUM_0}
                    Data Type:    String

                Field:    Champ23
                    Data Source:    {SINVOICE.ACCDAT_0}
                    Data Type:    Date
                    Format:    Date and Time
                        Order:    Date Time
                        Date Type:    Custom
                        Date Format:    DD/MM/YYYY hh:mm:ss  AM

                Field:    lblRepresentante2
                    Data Source:    {@lblRepresentante}
                    Data Type:    String

                Field:    REP01
                    Data Source:    {SINVOICEV.REP_0}
                    Data Type:    String

                Field:    lblcodcliente2
                    Data Source:    {@lblcodcliente}
                    Data Type:    String

                Field:    Champ24
                    Data Source:    {SINVOICE.BPR_0}
                    Data Type:    String

                Field:    lblNumProvCliente1
                    Data Source:    {@lblNumProvCliente}
                    Data Type:    String

                Field:    BPCBPSNUM01
                    Data Source:    {BPCUSTOMER.BPCBPSNUM_0}
                    Data Type:    String

                Field:    lblNumIVAIntra2
                    Data Source:    {@lblNumIVAIntra}
                    Data Type:    String

                Field:    Champ35
                    Data Source:    {SINVOICEV.BPIEECNUM_0}
                    Data Type:    String
                    Suppression Formula:    //if {?codact}= 0 then true
                                            //Si le type de régime de la table des régimes <> CEE (4)
                                            // ACA - 6.2 - Certification
                                            //if {ATABDIV.N1_0} <> 4 then true

                Field:    lblPortes1
                    Data Source:    {@lblPortes}
                    Data Type:    String

                Field:    REPNAM01
                    Data Source:    {SALESREP.REPNAM_0}
                    Data Type:    String

                Field:    lblCodPedCli1
                    Data Source:    {@lblCodPedCli}
                    Data Type:    String
                    Suppression Formula:    {SINVOICE.INVTYP_0}<>5

                Field:    INVREF01
                    Data Source:    {SINVOICEV.INVREF_0}
                    Data Type:    String
                    Suppression Formula:    {SINVOICE.INVTYP_0}<>5

            SubReports

                SubReport:    TABVACBPR_multileg.rpt
                    Links:    {COMPANY.LEG_0} => {?Pm-COMPANY.LEG_0}
                              {SINVOICE.VAC_0} => {?Pm-SINVOICE.VAC_0}

        Section:    Section g

            Fields

                Field:    TEXTE01
                    Data Source:    {TEXCLOB_DEB.TEXTE_0}
                    Data Type:    Unknown

                Field:    INITColonnesTarif1
                    Data Source:    {@INIT_Colonnes_Tarif}
                    Data Type:    Boolean

        Section:    Section h

            Text Fields

                Text Field:    Text44
                    Text:    Reg. Mercantil de Zaragoza, Tomo 239, General 145 - Sección 3ª , Folio 19-33, Hoja 3.437 - C.I.F.  A-50040112
                    Suppression Formula:    {?impcabecera}<>1 or ({SORDER.CPY_0}<>"FA200" )

        Section:    Section i

            Fields

                Field:    mention2
                    Data Source:    {@mention}
                    Data Type:    String

        Section:    Section j

            Fields

                Field:    gcolrem01
                    Data Source:    {@gcolrem0}
                    Data Type:    String

                Field:    lblArticulo1
                    Data Source:    {@lblArticulo}
                    Data Type:    String

                Field:    lblDescripcion1
                    Data Source:    {@lblDescripcion}
                    Data Type:    String

                Field:    lblCantidad1
                    Data Source:    {@lblCantidad}
                    Data Type:    String

                Field:    lblPrecio1
                    Data Source:    {@lblPrecio}
                    Data Type:    String

                Field:    Champ51
                    Data Source:    {@lbl_mntnet}
                    Data Type:    String

            Text Fields

                Text Field:    Text2
                    Text:    Dto.
                    Suppression Formula:    sum({SINVOICED.DISCRGVAL1_0},{SINVOICEV.NUM_0}) = 0  or {?UsarPrecioNeto} = 1

                Text Field:    Text4
                    Text:    Dto. 2
                    Suppression Formula:    sum({SINVOICED.DISCRGVAL2_0},{SINVOICEV.NUM_0}) = 0 or {?UsarPrecioNeto} = 1

                Text Field:    Text6
                    Text:    Dto . P.P.
                    Suppression Formula:    sum({SINVOICED.DISCRGVAL4_0},{SINVOICEV.NUM_0}) = 0  or {?UsarPrecioNeto} = 1

                Text Field:    Text9
                    Text:    Dto. 2
                    Suppression Formula:    sum({SINVOICED.DISCRGVAL3_0},{SINVOICEV.NUM_0}) = 0 or {?UsarPrecioNeto} = 1

            Boxes

                Box:    Cadre3
                    Ends in Section:    Section24
                    Size:    696x499
                    Line Type:    Single
                    Line Thickness:    0

                Box:    Box10
                    Ends in Section:    PageHeaderSection8
                    Size:    697x30
                    Line Type:    Single
                    Line Thickness:    0

            Lines

                Line:    Ligne8
                    Ends in Section:    Section24
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Ligne5
                    Ends in Section:    Section24
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Ligne11
                    Ends in Section:    Section24
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line2
                    Ends in Section:    Section24
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Ligne6
                    Ends in Section:    Section24
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line3
                    Ends in Section:    Section24
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line4
                    Ends in Section:    Section24
                    Line Type:    Single
                    Line Thickness:    0

    Groups

        Group:    Group #1
            Grouped By:    {AREPORTM.NUMLIG_0}

        Group:    Group #2
            Grouped By:    {SINVOICEV.NUM_0}

            Group Header

                Section:    Section a

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    // Bug 52310 on teste toute l'adresse
                                        //if len({SINVOICE.BPRNAM_0})=0 then true else false;
                                        //if len({SINVOICE.BPRNAM_0}+{SINVOICE.BPAADDLIG_0}+{SINVOICE.BPAADDLIG_1}+{SINVOICE.BPAADDLIG_2}+{SINVOICE.POSCOD_0}+{SINVOICE.CTY_0}+{SINVOICE.SAT_0}+{SINVOICE.CRYNAM_0})=0 then true else false;
                                        
                                        
                                        
                                        

                Section:    Section b

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    // Bug 52310 on teste toute l'adresse
                                        //if len({SINVOICE.BPRNAM_0})=0 then false else true;
                                        //if len({SINVOICE.BPRNAM_0}+{SINVOICE.BPAADDLIG_0}+{SINVOICE.BPAADDLIG_1}+{SINVOICE.BPAADDLIG_2}+{SINVOICE.POSCOD_0}+{SINVOICE.CTY_0}+{SINVOICE.SAT_0}+{SINVOICE.CRYNAM_0})=0 then false else true;
                                        
                                        

            Group Footer

                Section:    Section a

                    Fields

                        Field:    TEXTE03
                            Data Source:    {TEXCLOB_FIN.TEXTE_0}
                            Data Type:    Unknown

                Section:    Section c

                    Fields

                        Field:    Champ79
                            Data Source:    Sum ({@Mt_net}, {SINVOICEV.NUM_0})
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    lblbaseTVA1
                            Data Source:    {@lbl_baseTVA}
                            Data Type:    String

                        Field:    lblmtTVA1
                            Data Source:    {@lbl_mtTVA}
                            Data Type:    String

                        Field:    lbltaux1
                            Data Source:    {@lbl_taux}
                            Data Type:    String

                        Field:    lbltotallig1
                            Data Source:    {@lbl_total_lig}
                            Data Type:    String

                    Boxes

                        Box:    Box5
                            Ends in Section:    GroupFooterSection8
                            Size:    349x36
                            Line Type:    Single
                            Line Thickness:    0

                        Box:    Box4
                            Ends in Section:    Section38
                            Size:    332x181
                            Line Type:    Single
                            Line Thickness:    0

                    Lines

                        Line:    Line1
                            Ends in Section:    Section38
                            Line Type:    Single
                            Line Thickness:    0

                    SubReports

                        SubReport:    SINVOICEV_TAXE_Sumtaxe.rpt
                            Links:    {COMPANY.LEG_0} => {?Pm-COMPANY.LEG_0}
                                      {SINVOICEV.NUM_0} => {?Pm-SINVOICEV.NUM_0}

                Section:    Section d

                    Fields

                        Field:    InitMtAcpt1
                            Data Source:    {@InitMtAcpt}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                    SubReports

                        SubReport:    SINVOICEV_PIED.rpt
                            Links:    {SINVOICEV.NUM_0} => {?Pm-SINVOICEV.NUM_0}
                                      {SINVOICEV.PRITYP_0} => {?Pm-SINVOICEV.PRITYP_0}
                                      {BPARTNER.LAN_0} => {?Pm-BPARTNER.LAN_0}
                                      {@decimald} => {?Pm-@decimald}
                                      {?X3DOS} => {?Pm-?X3DOS}

                        SubReport:    SINVOICEV_TAXE.rpt - 01
                            Links:    {SINVOICEV.NUM_0} => {?Pm-SINVOICEV.NUM_0}
                                      {@decimald} => {?Pm-@decimald}
                                      {BPARTNER.LAN_0} => {?Pm-BPARTNER.LAN_0}
                                      {COMPANY.LEG_0} => {?Pm-COMPANY.LEG_0}

                Section:    Section e

                    Fields

                        Field:    Champ58
                            Data Source:    {@sumtax}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    lbldontTVA1
                            Data Source:    {@lbl_dontTVA}
                            Data Type:    String

                        Field:    lbldontTaxesTVA1
                            Data Source:    {@lbl_dontTaxesTVA}
                            Data Type:    String

                        Field:    sumTaxTVA1
                            Data Source:    {@sumTaxTVA}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    Champ91
                            Data Source:    {@Mt_total}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    Champ90
                            Data Source:    {@lbl_total}
                            Data Type:    String

                    Boxes

                        Box:    Box8
                            Ends in Section:    Section38
                            Size:    349x180
                            Line Type:    Single
                            Line Thickness:    0

                    SubReports

                        SubReport:    RechAcomptesDdesEtVerses.rpt
                            Links:    {AREPORTM.RPTCOD_0} => {?Pm-AREPORTM.RPTCOD_0}
                                      {AREPORTM.NUMREQ_0} => {?Pm-AREPORTM.NUMREQ_0}
                                      {AREPORTM.USR_0} => {?Pm-AREPORTM.USR_0}
                                      {AREPORTM.CLEA1_0} => {?Pm-AREPORTM.CLEA1_0}
                            Suppression Formula:    If 
                                                    {SINVOICEV.INSORDNUM_0} <> "" or {SINVOICEV.INSLIN_0} > 0 or
                                                    {SINVOICEV.INSORDNUM_1} <> "" or {SINVOICEV.INSLIN_1} > 0 or
                                                    {SINVOICEV.INSORDNUM_2} <> "" or {SINVOICEV.INSLIN_2} > 0 or
                                                    {SINVOICEV.INSORDNUM_3} <> "" or {SINVOICEV.INSLIN_3} > 0 
                                                    then 
                                                        false
                                                    else
                                                        true;

                Section:    Section f

                    Conditional Formulas

                        Condition:    EnableSuppressIfBlank
                            Formula:    //64355
                                        if {TABCOUNTRY.EECFLG_0} = 2 and 
                                           ({TABCUR.EURFLG_0} <> 2 or {SINVOICE.CUR_0} <> {?euro}) 
                                            then false 
                                            else true

                    Fields

                        Field:    lbldontTaxesTVAEuro1
                            Data Source:    {@lbl_dontTaxesTVA_Euro}
                            Data Type:    String
                            Suppression Formula:    //64355
                                                    if {TABCOUNTRY.EECFLG_0} = 2 and 
                                                       ({TABCUR.EURFLG_0} <> 2 or {SINVOICE.CUR_0} <> {?euro}) 
                                                        then false 
                                                        else true

                    SubReports

                        SubReport:    MONTANT_TVA_EURO.rpt
                            Links:    {?euro} => {?Pm-?euro}
                                      {@sumTaxTVA_Euro} => {?Pm-@sumTaxTVA_Euro}
                            Suppression Formula:    //64355
                                                    if {TABCOUNTRY.EECFLG_0} = 2 and 
                                                       ({TABCUR.EURFLG_0} <> 2 or {SINVOICE.CUR_0} <> {?euro}) 
                                                        then false 
                                                        else true

                Section:    Section g

                    Fields

                        Field:    sumTaxNonSoumise1
                            Data Source:    {@sumTaxNonSoumise}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    lbldontTaxesNonSoumises1
                            Data Source:    {@lbl_dontTaxesNonSoumises}
                            Data Type:    String

                        Field:    sumTaxSoumise1
                            Data Source:    {@sumTaxSoumise}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    lbldontTaxesSoumises1
                            Data Source:    {@lbl_dontTaxesSoumises}
                            Data Type:    String

                Section:    Section h

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    //If {SINVOICEV.PRITYP_0} = 1 then false else true;
                                        

                Section:    Section i

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    // Suppresion de la section si le statut de la facture est Validée.
                                        // SINVOICE.STA = Statut de facture / Menu Local n° 429 
                                        // (1 = Non Imprimée / 2 = Imprimée  / 3 = Validée)
                                        if {SINVOICE.STA_0} = 3 then 
                                           True
                                        else 
                                           if {@Mtacompte_demandé_Facture} = 0 then 
                                              true 
                                           else 
                                              false;
                                        

                    Fields

                        Field:    lblacomptesd2
                            Data Source:    {@lbl_acomptesd}
                            Data Type:    String
                            Suppression Formula:    
                                                    

                        Field:    MtacomptedemandéFacture1
                            Data Source:    {@Mtacompte_demandé_Facture}
                            Data Type:    Number
                            Suppression Formula:    // Suppresion de la section si le statut de la facture est Validée.
                                                    // SINVOICE.STA = Statut de facture / Menu Local n° 429 
                                                    // (1 = Non Imprimée / 2 = Imprimée  / 3 = Validée)
                                                    if {SINVOICE.STA_0} = 3 then 
                                                       True
                                                    else 
                                                       if {@Mtacompte_demandé_Facture} = 0 then 
                                                          true 
                                                       else 
                                                          false;
                                                    
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                Section:    Section j

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    // Suppresion de la section si le statut de la facture est Validée.
                                        // SINVOICE.STA = Statut de facture / Menu Local n° 429 
                                        // (1 = Non Imprimée / 2 = Imprimée  / 3 = Validée)
                                        if {SINVOICE.STA_0} = 3 then 
                                           True
                                        else 
                                           if {@Mtacompte_Facture_non_validee} = 0 then 
                                              true 
                                           else 
                                              false;
                                        

                    Fields

                        Field:    Champ96
                            Data Source:    {@Mtacompte_Facture_non_validee}
                            Data Type:    Number
                            Suppression Formula:    // Suppresion de la section si le statut de la facture est Validée.
                                                    // SINVOICE.STA = Statut de facture / Menu Local n° 429 
                                                    // (1 = Non Imprimée / 2 = Imprimée  / 3 = Validée)
                                                    if {SINVOICE.STA_0} = 3 then 
                                                       True
                                                    else 
                                                       if {@Mtacompte_Facture_non_validee} = 0 then 
                                                          true 
                                                       else 
                                                          false;
                                                    
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    lblacomptev1
                            Data Source:    {@lbl_acomptev}
                            Data Type:    String

                Section:    Section k

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    // Suppresion de la section si le statut de la facture est NON Validée.
                                        // SINVOICE.STAP = Statut de facture / Menu Local n° 429 
                                        // (1 = Non Imprimée / 2 = Imprimée  / 3 = Validée)
                                        //if {SINVOICE.STA_0} <> 3 then 
                                        //   True
                                        //else 
                                        //   False;
                                        

                    SubReports

                        SubReport:    mtacompte_Facture_validee
                            Links:    {SINVOICE.GTE_0} => {?Pm-SINVOICE.GTE_0}
                                      {SINVOICE.NUM_0} => {?Pm-SINVOICE.NUM_0}

                Section:    Section l

                    Fields

                        Field:    lbltotalttcU1
                            Data Source:    {@lbl_totalttcU}
                            Data Type:    String
                            Suppression Formula:    If {SINVOICEV.PRITYP_0} = 1 then false else true;

                        Field:    Champ95
                            Data Source:    {SINVOICE.AMTATI_0}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    CUR01
                            Data Source:    {SINVOICE.CUR_0}
                            Data Type:    String

                    Boxes

                        Box:    Box7
                            Ends in Section:    Section38
                            Size:    332x33
                            Line Type:    Single
                            Line Thickness:    20

                Section:    Section m

                    Fields

                        Field:    lblCondPago1
                            Data Source:    {@lblCondPago}
                            Data Type:    String

                        Field:    txtdiaspago1
                            Data Source:    {@txtdias_pago}
                            Data Type:    String

                        Field:    lbldiaspago1
                            Data Source:    {@lbl_diaspago}
                            Data Type:    String

                    SubReports

                        SubReport:    TABPAYTERM_multileg.rpt
                            Links:    {BPARTNER.LAN_0} => {?Pm-BPARTNER.LAN_0}
                                      {COMPANY.LEG_0} => {?Pm-COMPANY.LEG_0}
                                      {SINVOICE.PTE_0} => {?Pm-SINVOICE.PTE_0}
                                      {@param_X3DOS} => {?Pm-@param_X3DOS}

                Section:    Section n

                    Fields

                        Field:    lblCondPago2
                            Data Source:    {@lblCondPago}
                            Data Type:    String

                        Field:    lbldiaspago2
                            Data Source:    {@lbl_diaspago}
                            Data Type:    String

                        Field:    txtdiaspago2
                            Data Source:    {@txtdias_pago}
                            Data Type:    String

                    SubReports

                        SubReport:    TABPAYTERM_SPA.rpt
                            Links:    {SINVOICE.PTE_0} => {?Pm-SINVOICE.PTE_0}
                                      {COMPANY.LEG_0} => {?Pm-COMPANY.LEG_0}

                Section:    Section o

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    if {SINVOICEV.INVTYP_0} <> 1 then true else false;
                                        

                    SubReports

                        SubReport:    s-datech
                            Links:    {?X3DOS} => {?X3DOS}
                                      {SINVOICE.GTE_0} => {?Pm-SINVOICE.GTE_0}
                                      {SINVOICE.NUM_0} => {?Pm-SINVOICE.NUM_0}
                                      {SINVOICE.STA_0} => {?Pm-SINVOICE.STA_0}
                                      {@Mtacompte_Facture_non_validee} => {?Pm-@Mtacompte_Facture_non_validee}
                                      {COMPANY.LEG_0} => {?Pm-COMPANY.LEG_0}
                                      {@SddAffiche} => {?Pm-@afficheSdd}
                                      {BPARTNER.LAN_0} => {?Pm-BPARTNER.LAN_0}

                Section:    Section p

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    LEFT({SINVOICE.PTE_0},2)<>'TR' AND LEFT({SINVOICE.PTE_0},3)<>'ANT' AND LEFT({SINVOICE.PTE_0},2)<>'CF'
                                        //{SINVOICE.ZBANK_0}=''

                    Fields

                        Field:    lblAIngresar1
                            Data Source:    {@lblAIngresar}
                            Data Type:    String

                        Field:    IBANCCC1
                            Data Source:    {@IBANCCC}
                            Data Type:    String

                Section:    Section q

                    Fields

                        Field:    Sdd1FormNbEch1
                            Data Source:    {@Sdd1FormNbEch}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    Sdd1FormNbEchSdd1
                            Data Source:    {@Sdd1FormNbEchSdd}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    Sdd1FormNbEchSdd21
                            Data Source:    {@Sdd1FormNbEchSdd2}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    Sdd1AffichePageSup1
                            Data Source:    {@Sdd1AffichePageSup}
                            Data Type:    Boolean

                        Field:    Sdd1AAPageNumber1
                            Data Source:    {@Sdd1AAPageNumber}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    Sdd1AATotalPageCount1
                            Data Source:    {@Sdd1AATotalPageCount}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                        Field:    Sdd1FormSiPlus4Ech1
                            Data Source:    {@Sdd1FormSiPlus4Ech}
                            Data Type:    Boolean

                Section:    Section r

                    Fields

                        Field:    Champ101
                            Data Source:    {FACTOR.TXTSBRGT_0}
                            Data Type:    String

                        Field:    Champ102
                            Data Source:    {FACTOR.TXTSBRGT_1}
                            Data Type:    String

                        Field:    Champ103
                            Data Source:    {FACTOR.TXTSBRGT_2}
                            Data Type:    String

                        Field:    Champ104
                            Data Source:    {FACTOR.TXTSBRGT_3}
                            Data Type:    String

                        Field:    Champ105
                            Data Source:    {FACTOR.TXTSBRGT_4}
                            Data Type:    String

                        Field:    Champ106
                            Data Source:    {FACTOR.TXTSBRGT_5}
                            Data Type:    String

                        Field:    lblretardpaiement1
                            Data Source:    {@lbl_retardpaiement}
                            Data Type:    String

                    SubReports

                        SubReport:    TABDEPAGIO_multileg.rpt
                            Links:    {COMPANY.LEG_0} => {?Pm-COMPANY.LEG_0}
                                      {SINVOICE.DEP_0} => {?Pm-SINVOICE.DEP_0}
                                      {@param_tauxagios} => {?Pm-@param_tauxagios}
                                      {@param_tauxescompte} => {?Pm-@param_tauxescompte}
                                      {@param_X3DOS} => {?Pm-@param_X3DOS}
                                      {BPARTNER.LAN_0} => {?Pm-BPARTNER.LAN_0}

                Section:    Section s

                    SubReports

                        SubReport:    SINVOICEV_MENTIONS.rpt - 01
                            Links:    {SINVOICEV.NUM_0} => {?Pm-SINVOICEV.NUM_0}
                                      {BPARTNER.LAN_0} => {?Pm-BPARTNER.LAN_0}
                                      {COMPANY.LEG_0} => {?Pm-COMPANY.LEG_0}

                Section:    Section t

                    Fields

                        Field:    FormNbSddTot1
                            Data Source:    {@Sdd1FormNbSddTot}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                Section:    Section u

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    {SINVOICE.CSHVAT_0}<>2

                    Fields

                        Field:    lblcshvatspa1
                            Data Source:    {@lbl_cshvatspa}
                            Data Type:    String

                Section:    Section v

                    Fields

                        Field:    lblformejuridique1
                            Data Source:    {@lbl_formejuridique}
                            Data Type:    String

                Section:    Section w

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    //  not {@Sdd1Affiche} or not {@Sdd1FormSiPlus4Ech}
                                        
                                        not {@Sdd1Affiche2}

                    SubReports

                        SubReport:    s_datech_sdd.rpt
                            Links:    {SINVOICE.GTE_0} => {?Pm-SINVOICE.GTE_0}
                                      {SINVOICE.NUM_0} => {?Pm-SINVOICE.NUM_0}
                                      {SINVOICEV.LAN_0} => {?Pm-SINVOICEV.LAN_0}
                                      {SINVOICE.STA_0} => {?Pm-SINVOICE.STA_0}
                                      {@Mtacompte_Facture_non_validee} => {?Pm-@Mtacompte_Facture_non_validee}
                                      {COMPANY.LEG_0} => {?Pm-COMPANY.LEG_0}
                                      {@SddAffiche} => {?Pm-@afficheSdd}
                                      {?X3DOS} => {?X3DOS}

        Group:    Group #3
            Grouped By:    {SINVOICED.SDHNUM_0}

            Group Header

                Section:    Section a

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    {ITMMASTER.SEAKEY_0} <> 'RAPPEL'

                    Fields

                        Field:    SumadeMtnet2
                            Data Source:    Sum ({@Mt_net}, {SINVOICED.SDHNUM_0})
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                    Text Fields

                        Text Field:    Text7
                            Text:    {@ClienteCodART} {@ClienteDesART}

                Section:    Section b

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    {SINVOICED.SDHNUM_0} = ''

                    Fields

                        Field:    lblEntregadoel3
                            Data Source:    {@lblEntregadoel}
                            Data Type:    String

                        Field:    SDHNUM01
                            Data Source:    {SINVOICED.SDHNUM_0}
                            Data Type:    String

                        Field:    lblEntreganum3
                            Data Source:    {@lblEntreganum}
                            Data Type:    String

                        Field:    SHIDAT01
                            Data Source:    {SDELIVERY_1.SHIDAT_0}
                            Data Type:    Date
                            Format:    Date and Time
                                Order:    Date Time
                                Date Type:    Custom
                                Date Format:    DD/MM/YYYY hh:mm:ss  AM

                        Field:    lblDir1
                            Data Source:    {@lblDir}
                            Data Type:    String

                        Field:    lblCodPedCli2
                            Data Source:    {@lblCodPedCli}
                            Data Type:    String

                        Field:    CUSORDREF01
                            Data Source:    {SORDER.CUSORDREF_0}
                            Data Type:    String

                        Field:    BPAADD01
                            Data Source:    {SDELIVERY_1.BPAADD_0}
                            Data Type:    String

                Section:    Section c

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    {SINVOICED.SDHNUM_0} = ''

                    Fields

                        Field:    BPDNAM01
                            Data Source:    {BPDLVCUST.BPDNAM_0}
                            Data Type:    String

                        Field:    BPDADDLIG02
                            Data Source:    {SDELIVERY_1.BPDADDLIG_0}
                            Data Type:    String

                Section:    Section d

                    Fields

                        Field:    BPDADDLIG11
                            Data Source:    {SDELIVERY_1.BPDADDLIG_1}
                            Data Type:    String

                Section:    Section e

                    Fields

                        Field:    BPDADDLIG21
                            Data Source:    {SDELIVERY_1.BPDADDLIG_2}
                            Data Type:    String

                Section:    Section f

                    Fields

                        Field:    BPDPOSCOD01
                            Data Source:    {SDELIVERY_1.BPDPOSCOD_0}
                            Data Type:    String

                        Field:    BPDCTY01
                            Data Source:    {SDELIVERY_1.BPDCTY_0}
                            Data Type:    String

                Section:    Section g

                    Fields

                        Field:    BPDSAT01
                            Data Source:    {SDELIVERY_1.BPDSAT_0}
                            Data Type:    String

                Section:    Section h

                    Fields

                        Field:    BPDCRYNAM01
                            Data Source:    {SDELIVERY_1.BPDCRYNAM_0}
                            Data Type:    String

            Group Footer

                Section:    Section a

                    Conditional Formulas

                        Condition:    EnableSuppress
                            Formula:    {SINVOICE.BPR_0}<>'026018'

                    Fields

                        Field:    SumadeMtnet1
                            Data Source:    Sum ({@Mt_net}, {SINVOICED.SDHNUM_0})
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

                    Text Fields

                        Text Field:    Text1
                            Text:    Total Albarán: 

    Detail

        Section:    Section a

            Fields

                Field:    rupturelivraison1
                    Data Source:    {@rupture_origlivraison_fact}
                    Data Type:    String

                Field:    FormNbSddIni1
                    Data Source:    {@SddFormNbSddIni}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

        Section:    Section b

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    WhilePrintingRecords;
                                // Bug 60458
                                global BooleanVar ruptureOrigFact;
                                not (ruptureOrigFact);

            Fields

                Field:    SIHORINUM01
                    Data Source:    {SINVOICED.SIHORINUM_0}
                    Data Type:    String

                Field:    lblFacOrigen3
                    Data Source:    {@lblFacOrigen}
                    Data Type:    String

        Section:    Section c

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    if{SINVOICED.LINTYP_0} = 3 or
                                 {SINVOICED.LINTYP_0} = 4 or
                                 {SINVOICED.LINTYP_0} = 5 or
                                 {SINVOICED.LINTYP_0} = 7 or
                                {SINVOICED.LINTYP_0} = 8 or
                                 {SINVOICED.LINTYP_0} = 9  then true else false;

            Fields

                Field:    Champ55
                    Data Source:    {@lbl_gratuit}
                    Data Type:    String
                    Suppression Formula:    If {SINVOICED.FOCFLG_0} = 3 then false else true

        Section:    Section d

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    if {SINVOICED.LINTYP_0} in [3, 4, 5, 7, 8, 9, 11, 12] or {ITMMASTER.SEAKEY_0} = 'RAPPEL'
                                then true else false;

            Fields

                Field:    Champ61
                    Data Source:    {@Mt_net}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    True
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5 555 555,

                Field:    Champ63
                    Data Source:    {SINVOICED.DISCRGVAL1_0}
                    Data Type:    Number
                    Suppression Formula:    if ({?UsarPrecioNeto} = 1) then true else false
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    True
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5 555 555,

                Field:    Champ64
                    Data Source:    {SINVOICED.DISCRGVAL2_0}
                    Data Type:    Number
                    Suppression Formula:    if ({?UsarPrecioNeto} = 1) then true else false
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    True
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5 555 555,

                Field:    QTY01
                    Data Source:    {SINVOICED.QTY_0}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555

                Field:    DISCRGVAL301
                    Data Source:    {SINVOICED.DISCRGVAL3_0}
                    Data Type:    Number
                    Suppression Formula:    if ({?UsarPrecioNeto} = 1) then true else false
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    True
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    Precio1
                    Data Source:    {@Precio}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    DISCRGVAL401
                    Data Source:    {SINVOICED.DISCRGVAL4_0}
                    Data Type:    Number
                    Suppression Formula:    if ({?UsarPrecioNeto} = 1) then true else false
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    True
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    SAU01
                    Data Source:    {SINVOICED.SAU_0}
                    Data Type:    String

            Text Fields

                Text Field:    Text3
                    Text:    {@ClienteCodART} {@ClienteDesART} 

                Text Field:    Text27
                    Text:     {ITMMASTER.EANCOD_0}

        Section:    Section e

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    if {SINVOICED.LINTYP_0} in [3, 4, 5, 7, 8, 9, 11, 12]
                                then true else false;

            Fields

                Field:    DES01
                    Data Source:    {SPREASON.DES_0}
                    Data Type:    String
                    Suppression Formula:    {SINVOICED.PRIREN_0}<6

            SubReports

                SubReport:    ZINTRASTAT
                    Links:    {BPARTNER.LAN_0} => {?Pm-BPARTNER.LAN_0}
                              {ITMMASTER.CUSREF_0} => {?Pm-ITMMASTER.CUSREF_0}
                    Suppression Formula:    {SINVOICE.VAC_0}='NAC' OR {SINVOICE.VAC_0}='REQ'

        Section:    Section f

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    //if {SINVOICED.LINTYP_0} <> 1 and
                                //   {SINVOICED.LINTYP_0} <> 2 and
                                //   {SINVOICED.LINTYP_0} <> 6 and
                                //   {SINVOICED.INVPRNBOM_0} = 1 then true else false;

            Fields

                Field:    Champ56
                    Data Source:    {@lbl_option_ou_kit}
                    Data Type:    String
                    Suppression Formula:    if {SINVOICED.LINTYP_0} = 2 or
                                               {SINVOICED.LINTYP_0} = 4 or
                                               {SINVOICED.LINTYP_0} = 8 
                                                then
                                                        false
                                                else
                                                        true; 

        Section:    Section g

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    if {SINVOICED.LINTYP_0} in [1, 2, 6, 12]
                                or {SINVOICED.INVPRNBOM_0} = 1 
                                then true else false;

            Fields

                Field:    SAU02
                    Data Source:    {SINVOICED.SAU_0}
                    Data Type:    String

                Field:    QTY02
                    Data Source:    {SINVOICED.QTY_0}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555

            Text Fields

                Text Field:    Text5
                    Text:    {@ClienteCodART}  {SINVOICED.ITMDES_0}

        Section:    Section h

            Fields

                Field:    TEXTE02
                    Data Source:    {TEXCLOB_DET.TEXTE_0}
                    Data Type:    Unknown

    Page Footer

        Section:    Section a

            Fields

                Field:    Sumaysigue1
                    Data Source:    {@Suma y sigue}
                    Data Type:    String
                    Suppression Formula:    PageNumber=TotalPageCount

                Field:    PageNM2
                    Data Source:    PageNofM
                    Data Type:    String
                    Display String Formula:    WhilePrintingRecords;
                                               global stringVar fechs;
                                               fechs:=TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,54) & ' ' & totext(pagenumber, 0) & ' ' & TextOfChapter ({?X3DOS},{BPARTNER.LAN_0},6969,55) & ' ' & totext(totalpagecount, 0)

                Field:    TEXTOPIE1
                    Data Source:    {@TEXTOPIE}
                    Data Type:    String

                Field:    RTotal01
                    Data Source:    {#RTotal0}
                    Data Type:    Number
                    Suppression Formula:    PageNumber=TotalPageCount
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

            Pictures

                Picture:    Picture6
                    Size:    327x64
                    Suppression Formula:    {?impcabecera}<>1 or ({SINVOICE.CPY_0}<>"FA200" )

                Picture:    Picture1
                    Size:    151x37
                    Suppression Formula:    {?impcabecera}<>1 or ({SINVOICE.CPY_0}<>"GT500" and {SINVOICE.CPY_0}<>"IF250" and {SINVOICE.CPY_0}<>"IT350" and {SINVOICE.CPY_0}<>"TI300")

                Picture:    Picture3
                    Size:    159x64
                    Suppression Formula:    {?impcabecera}<>1 or ({SINVOICE.CPY_0}<>"GT500" and {SINVOICE.CPY_0}<>"IF250" and {SINVOICE.CPY_0}<>"IT350" and {SINVOICE.CPY_0}<>"TI300")

Subreport:    MONTANT_TVA_EURO.rpt

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-@sumTaxTVA_Euro
            Data Type:    Number
            Description:    Pm-@sumTaxTVA_Euro
            List Type:    Static

        Parameter:    Pm-?euro
            Data Type:    String
            Description:    Pm-?euro
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.TABCUR
            Connection:    Connection #1
            Used Columns:    {TABCUR.CUR_0} : String[8]
                             {TABCUR.DECNBR_0} : Number

    Record Selection Formulas
        Formula:    //64355
                    {TABCUR.CUR_0} = {?Pm-?euro}

    Formula Fields

        Field:    taxTVA_Euro
            Formula:    {?Pm-@sumTaxTVA_Euro}

        Field:    euro
            Formula:    {?Pm-?euro}

    Detail

        Section:    Section a

            Fields

                Field:    taxTVAEuro1
                    Data Source:    {@taxTVA_Euro}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    euro1
                    Data Source:    {@euro}
                    Data Type:    String

Subreport:    RechAcomptesDdesEtVerses.rpt

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-AREPORTM.RPTCOD_0
            Data Type:    String
            Description:    Pm-AREPORTM.RPTCOD_0
            List Type:    Static

        Parameter:    Pm-AREPORTM.NUMREQ_0
            Data Type:    Number
            Description:    Pm-AREPORTM.NUMREQ_0
            List Type:    Static

        Parameter:    Pm-AREPORTM.USR_0
            Data Type:    String
            Description:    Pm-AREPORTM.USR_0
            List Type:    Static

        Parameter:    Pm-AREPORTM.CLEA1_0
            Data Type:    String
            Description:    Pm-AREPORTM.CLEA1_0
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.TMPSRPT
            Connection:    Connection #1
            Used Columns:    {TMPSRPT.USR_0} : String[12]
                             {TMPSRPT.RPTCOD_0} : String[32]
                             {TMPSRPT.NUMREQ_0} : Number
                             {TMPSRPT.VCRNUM_0} : String[42]
                             {TMPSRPT.SIVACPTDDE_0} : Number
                             {TMPSRPT.SIVACPTVER_0} : Number
                             {TMPSRPT.SIVACPTECH_0} : Number

    Record Selection Formulas
        Formula:    {TMPSRPT.RPTCOD_0} = {?Pm-AREPORTM.RPTCOD_0} and
                    {TMPSRPT.NUMREQ_0} = {?Pm-AREPORTM.NUMREQ_0} and
                    {TMPSRPT.USR_0} = {?Pm-AREPORTM.USR_0} and
                    {TMPSRPT.VCRNUM_0} = {?Pm-AREPORTM.CLEA1_0}

    Formula Fields

        Field:    TotalAcptesDdes
            Formula:    //CPO 83064 
                        Shared Numbervar TotalAcptesDdes := {TMPSRPT.SIVACPTDDE_0};
                        

        Field:    TotalAcptesVerses
            Formula:    //CPO 83064 
                        Shared Numbervar TotalAcptesVerses := {TMPSRPT.SIVACPTVER_0};

        Field:    MtAcptEcheance
            Formula:    //CPO 83064
                        Shared numbervar MtAcptEcheance := {TMPSRPT.SIVACPTECH_0};
                        

    Report Footer

        Section:    Section b

            Fields

                Field:    TotalAcptesDdes1
                    Data Source:    {@TotalAcptesDdes}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    TotalAcptesVerses1
                    Data Source:    {@TotalAcptesVerses}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    MtAcptEcheance1
                    Data Source:    {@MtAcptEcheance}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

Subreport:    SINVOICEV_MENTIONS.rpt - 01

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-SINVOICEV.NUM_0
            Data Type:    String
            Description:    Pm-SINVOICEV.NUM_0
            List Type:    Static

        Parameter:    Pm-BPARTNER.LAN_0
            Data Type:    String
            Description:    Pm-BPARTNER.LAN_0
            List Type:    Static

        Parameter:    Pm-COMPANY.LEG_0
            Data Type:    String
            Description:    Pm-COMPANY.LEG_0
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.AVWTEXTRA
            Connection:    Connection #1
            Used Columns:    {AVWTEXTRA.LAN_0} : String[8]
                             {AVWTEXTRA.CODFIC_0} : String[26]
                             {AVWTEXTRA.ZONE_0} : String[26]
                             {AVWTEXTRA.IDENT1_0} : String[162]
                             {AVWTEXTRA.IDENT2_0} : String[162]
                             {AVWTEXTRA.TEXTE_0} : String[162]

        Table:    x3famesa.FAMESAOF.SVCRVAT
            Connection:    Connection #1
            Used Columns:    {SVCRVAT.VCRTYP_0} : Number
                             {SVCRVAT.VCRNUM_0} : String[42]
                             {SVCRVAT.VAT_0} : String[12]

        Table:    x3famesa.FAMESAOF.TABVAT
            Connection:    Connection #1
            Used Columns:    {TABVAT.VAT_0} : String[12]
                             {TABVAT.LEG_0} : String[42]

    Table Links
        Joins:    x3famesa.FAMESAOF.SVCRVAT INNER JOIN x3famesa.FAMESAOF.TABVAT ON x3famesa.FAMESAOF.SVCRVAT.VAT_0 = x3famesa.FAMESAOF.TABVAT.VAT_0
                  x3famesa.FAMESAOF.TABVAT INNER JOIN x3famesa.FAMESAOF.AVWTEXTRA ON x3famesa.FAMESAOF.TABVAT.VAT_0,LEG_0 = x3famesa.FAMESAOF.AVWTEXTRA.IDENT1_0,IDENT2_0

    Record Selection Formulas
        Formula:    // SVCRVAT  : Clé = VCRNUM_0 + VCRTYP_0 + VAT_0
                        {SVCRVAT.VCRNUM_0} = {?Pm-SINVOICEV.NUM_0} 
                    // VCRTYP_0 : Menu Local 432 / Prise en compte uniquement des Factures (4) Avoir (5) Factures de commandes (18) Factures de livraison (19)
                    and {SVCRVAT.VCRTYP_0} in [4 , 5 , 18 , 19]
                    // Lecture de la désignation traduite du code Taxe par accès à la vue AVWTEXTRA
                    and {AVWTEXTRA.CODFIC_0}="TABVAT" 
                    and {AVWTEXTRA.ZONE_0}="TEXAXX"
                    and {AVWTEXTRA.LAN_0}={?Pm-BPARTNER.LAN_0}
                    //71937 Adaptation multi-législation
                    and {SVCRVAT.VAT_0}={TABVAT.VAT_0}
                    and ({TABVAT.LEG_0}= {?Pm-COMPANY.LEG_0} or {TABVAT.LEG_0}=' ')
                    and ({AVWTEXTRA.IDENT2_0}={?Pm-COMPANY.LEG_0} or {AVWTEXTRA.IDENT2_0}=' ')
                    

    Record Sorting
        Sort By:    SVCRVAT.VAT_0 -- Ascending Order Group #1

    Groups

        Group:    Group #1
            Grouped By:    {SVCRVAT.VAT_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNameVAT01
                            Data Source:    GroupName ({SVCRVAT.VAT_0})
                            Data Type:    String

    Detail

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    //71937 Adaptation multi-législation
                                if {AVWTEXTRA.TEXTE_0}=' ' then true
                                else
                                {TABVAT.LEG_0}<>maximum({TABVAT.LEG_0},{SVCRVAT.VAT_0});

            Fields

                Field:    TEXTE01
                    Data Source:    {AVWTEXTRA.TEXTE_0}
                    Data Type:    String

Subreport:    SINVOICEV_PIED.rpt

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-SINVOICEV.NUM_0
            Data Type:    String
            Description:    Pm-SINVOICEV.NUM_0
            List Type:    Static

        Parameter:    Pm-SINVOICEV.PRITYP_0
            Data Type:    Number
            Description:    Pm-SINVOICEV.PRITYP_0
            List Type:    Static

        Parameter:    Pm-BPARTNER.LAN_0
            Data Type:    String
            Description:    Pm-BPARTNER.LAN_0
            List Type:    Static

        Parameter:    Pm-@decimald
            Data Type:    Number
            Description:    Pm-@decimald
            List Type:    Static

        Parameter:    Pm-?X3DOS
            Data Type:    String
            Description:    Pm-?X3DOS
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.SFOOTINV
            Connection:    Connection #1
            Used Columns:    {SFOOTINV.SFINUM_0} : Number
                             {SFOOTINV.SFINUMCAR_0} : String[8]
                             {SFOOTINV.DACINV_0} : Number

        Table:    x3famesa.FAMESAOF.SVCRFOOT
            Connection:    Connection #1
            Used Columns:    {SVCRFOOT.VCRTYP_0} : Number
                             {SVCRFOOT.VCRNUM_0} : String[42]
                             {SVCRFOOT.DTA_0} : Number
                             {SVCRFOOT.AMTCOD_0} : Number
                             {SVCRFOOT.DTAAMT_0} : Number
                             {SVCRFOOT.DTANOT_0} : Number
                             {SVCRFOOT.DTAVATAMT_0} : Number
                             {SVCRFOOT.DTAVATAMT_1} : Number
                             {SVCRFOOT.DTAVATAMT_2} : Number
                             {SVCRFOOT.DTAVATAMT_3} : Number
                             {SVCRFOOT.DTAVATAMT_4} : Number
                             {SVCRFOOT.DTAVATAMT_5} : Number
                             {SVCRFOOT.DTAVATAMT_6} : Number
                             {SVCRFOOT.DTAVATAMT_7} : Number
                             {SVCRFOOT.DTAVATAMT_8} : Number
                             {SVCRFOOT.DTAVATAMT_9} : Number

        Table:    x3famesa.TRILLA.AVWTEXTRA
            Connection:    Connection #1
            Used Columns:    {AVWTEXTRA.LAN_0} : String[8]
                             {AVWTEXTRA.CODFIC_0} : String[26]
                             {AVWTEXTRA.ZONE_0} : String[26]
                             {AVWTEXTRA.IDENT1_0} : String[162]
                             {AVWTEXTRA.TEXTE_0} : String[162]

    Table Links
        Joins:    x3famesa.FAMESAOF.SVCRFOOT LEFT OUTER JOIN x3famesa.FAMESAOF.SFOOTINV ON x3famesa.FAMESAOF.SVCRFOOT.DTA_0 = x3famesa.FAMESAOF.SFOOTINV.SFINUM_0
                  x3famesa.FAMESAOF.SFOOTINV INNER JOIN x3famesa.TRILLA.AVWTEXTRA ON x3famesa.FAMESAOF.SFOOTINV.SFINUMCAR_0 = x3famesa.TRILLA.AVWTEXTRA.IDENT1_0

    Record Selection Formulas
        Formula:    {AVWTEXTRA.ZONE_0} = "DESAXX" and
                    {AVWTEXTRA.CODFIC_0} = "SFOOTINV" and
                    {SVCRFOOT.VCRTYP_0} in [18, 19, 4, 5] and
                    {SVCRFOOT.VCRNUM_0} = {?Pm-SINVOICEV.NUM_0} and
                    {SVCRFOOT.VCRNUM_0} = {?Pm-SINVOICEV.NUM_0} and
                    {AVWTEXTRA.LAN_0} = {?Pm-BPARTNER.LAN_0}

    Record Sorting
        Sort By:    SFOOTINV.DACINV_0 -- Ascending Order 

    Formula Fields

        Field:    Mt_sfoot
            Formula:    // Si PRITYP = 2, on est en TTC !
                        if {?Pm-SINVOICEV.PRITYP_0} = 2 // and {SFOOTINV.CLCBAS_0} = 2
                        then {SVCRFOOT.DTANOT_0} + {SVCRFOOT.DTAVATAMT_0}+{SVCRFOOT.DTAVATAMT_1}+{SVCRFOOT.DTAVATAMT_2}+{SVCRFOOT.DTAVATAMT_3}+{SVCRFOOT.DTAVATAMT_4}+{SVCRFOOT.DTAVATAMT_5}+{SVCRFOOT.DTAVATAMT_6}+{SVCRFOOT.DTAVATAMT_7}+{SVCRFOOT.DTAVATAMT_8}+{SVCRFOOT.DTAVATAMT_9}
                        else {SVCRFOOT.DTANOT_0}
                        

        Field:    amtcod
            Formula:    WhilePrintingRecords;
                        if {SVCRFOOT.AMTCOD_0} = 1 then '%' else ' ';
                        

    Unused Formula Fields

        Field:    Txt_sfoot
            Formula:    WhilePrintingRecords;
                        stringVar X3TEX := "SFOOTINV~SHOAXX~"+{SFOOTINV.SFINUMCAR_0}+"~~";
                        X3TranslatedText ({?Pm-?X3DOS}, {?Pm-BPARTNER.LAN_0}, X3TEX)
                        
                        

        Field:    Txt_sfoot
            Formula:    WhilePrintingRecords;
                        stringVar X3TEX := "SFOOTINV~SHOAXX~"+{SFOOTINV.SFINUMCAR_0}+"~~";
                        X3TranslatedText ({?Pm-?X3DOS}, {?Pm-BPARTNER.LAN_0}, X3TEX)
                        
                        

    Detail

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    if {SVCRFOOT.DTANOT_0} = 0 then true else false ;
                                

            Fields

                Field:    txtpfoot1
                    Data Source:    {@Txt_sfoot}
                    Data Type:    String

                Field:    Mtsfoot1
                    Data Source:    {@Mt_sfoot}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5 555 555,

                Field:    DTAAMT01
                    Data Source:    {SVCRFOOT.DTAAMT_0}
                    Data Type:    Number
                    Suppression Formula:    // Frais ou Remise de type Montant et pas %
                                            {SVCRFOOT.AMTCOD_0} <> 1 or {SVCRFOOT.DTAAMT_0} = 0
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5 555 555,

                Field:    amtcod1
                    Data Source:    {@amtcod}
                    Data Type:    String
                    Suppression Formula:    {SVCRFOOT.DTAAMT_0} = 0

                Field:    TEXTE01
                    Data Source:    {AVWTEXTRA.TEXTE_0}
                    Data Type:    String

Subreport:    SINVOICEV_TAXE.rpt - 01

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-SINVOICEV.NUM_0
            Data Type:    String
            Description:    Pm-SINVOICEV.NUM_0
            List Type:    Static

        Parameter:    Pm-BPARTNER.LAN_0
            Data Type:    String
            Description:    Pm-BPARTNER.LAN_0
            List Type:    Static

        Parameter:    Pm-@decimald
            Data Type:    Number
            Description:    Pm-@decimald
            List Type:    Static

        Parameter:    Pm-COMPANY.LEG_0
            Data Type:    String
            Description:    Pm-COMPANY.LEG_0
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.SVCRVAT
            Connection:    Connection #1
            Used Columns:    {SVCRVAT.VCRTYP_0} : Number
                             {SVCRVAT.VCRNUM_0} : String[42]
                             {SVCRVAT.VAT_0} : String[12]
                             {SVCRVAT.VATRAT_0} : Number
                             {SVCRVAT.BASTAX_0} : Number
                             {SVCRVAT.AMTTAX_0} : Number

        Table:    x3famesa.FAMESAOF.AVWTEXTRA
            Connection:    Connection #1
            Used Columns:    {AVWTEXTRA.LAN_0} : String[8]
                             {AVWTEXTRA.CODFIC_0} : String[26]
                             {AVWTEXTRA.ZONE_0} : String[26]
                             {AVWTEXTRA.IDENT1_0} : String[162]
                             {AVWTEXTRA.IDENT2_0} : String[162]
                             {AVWTEXTRA.TEXTE_0} : String[162]

        Table:    x3famesa.FAMESAOF.TABVAT
            Connection:    Connection #1
            Used Columns:    {TABVAT.VAT_0} : String[12]
                             {TABVAT.LEG_0} : String[42]

    Table Links
        Joins:    x3famesa.FAMESAOF.SVCRVAT INNER JOIN x3famesa.FAMESAOF.TABVAT ON x3famesa.FAMESAOF.SVCRVAT.VAT_0 = x3famesa.FAMESAOF.TABVAT.VAT_0
                  x3famesa.FAMESAOF.TABVAT INNER JOIN x3famesa.FAMESAOF.AVWTEXTRA ON x3famesa.FAMESAOF.TABVAT.VAT_0,LEG_0 = x3famesa.FAMESAOF.AVWTEXTRA.IDENT1_0,IDENT2_0

    Record Selection Formulas
        Formula:    // SVCRVAT  : Clé = VCRNUM_0 + VCRTYP_0 + VAT_0
                        {SVCRVAT.VCRNUM_0} = {?Pm-SINVOICEV.NUM_0} 
                    // VCRTYP_0 : Menu Local 432 / Prise en compte uniquement des Factures (4) Avoir (5) Factures de commandes (18) Factures de livraison (19)
                    and {SVCRVAT.VCRTYP_0} in [4 , 5 , 18 , 19]
                    // Lecture de la désignation traduite du code Taxe par accès à la vue AVWTEXTRA
                    and {AVWTEXTRA.CODFIC_0}="TABVAT" 
                    and {AVWTEXTRA.ZONE_0}="DESAXX"
                    and {AVWTEXTRA.LAN_0}={?Pm-BPARTNER.LAN_0}
                    // 64355
                    // Nous avons besoin de tester le flag VATCHA (Soumis à TVA)
                    and {SVCRVAT.VAT_0} = {TABVAT.VAT_0}
                    //71937 Adaptation multi-législation
                    and 
                    ({TABVAT.LEG_0}={?Pm-COMPANY.LEG_0} or {TABVAT.LEG_0}=' ')
                    and
                    ({AVWTEXTRA.IDENT2_0}={?Pm-COMPANY.LEG_0} or {AVWTEXTRA.IDENT2_0}=' ')

    Record Sorting
        Sort By:    SVCRVAT.VAT_0 -- Ascending Order Group #1

    Groups

        Group:    Group #1
            Grouped By:    {SVCRVAT.VAT_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNameVAT01
                            Data Source:    GroupName ({SVCRVAT.VAT_0})
                            Data Type:    String

    Detail

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    if {SVCRVAT.AMTTAX_0} = 0 then true 
                                else 
                                    //71937 Adaptation multi-législation
                                    {TABVAT.LEG_0}<>maximum({TABVAT.LEG_0},{SVCRVAT.VAT_0});
                                

            Fields

                Field:    VATRAT01
                    Data Source:    {SVCRVAT.VATRAT_0}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    BASTAX01
                    Data Source:    {SVCRVAT.BASTAX_0}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    AMTTAX01
                    Data Source:    {SVCRVAT.AMTTAX_0}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    TEXTE01
                    Data Source:    {AVWTEXTRA.TEXTE_0}
                    Data Type:    String

            Text Fields

                Text Field:    Text1
                    Text:    :

Subreport:    SINVOICEV_TAXE_Sumtaxe.rpt

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-SINVOICEV.NUM_0
            Data Type:    String
            Description:    Pm-SINVOICEV.NUM_0
            List Type:    Static

        Parameter:    Pm-COMPANY.LEG_0
            Data Type:    String
            Description:    Pm-COMPANY.LEG_0
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.SVCRVAT
            Connection:    Connection #1
            Used Columns:    {SVCRVAT.VCRTYP_0} : Number
                             {SVCRVAT.VCRNUM_0} : String[42]
                             {SVCRVAT.VAT_0} : String[12]
                             {SVCRVAT.AMTTAX_0} : Number

        Table:    x3famesa.FAMESAOF.TABVAT
            Connection:    Connection #1
            Used Columns:    {TABVAT.VAT_0} : String[12]
                             {TABVAT.LEG_0} : String[42]
                             {TABVAT.VATTYP_0} : Number
                             {TABVAT.VATCHA_0} : Number

    Table Links
        Joins:    x3famesa.FAMESAOF.SVCRVAT INNER JOIN x3famesa.FAMESAOF.TABVAT ON x3famesa.FAMESAOF.SVCRVAT.VAT_0 = x3famesa.FAMESAOF.TABVAT.VAT_0

    Record Selection Formulas
        Formula:    {SVCRVAT.VCRNUM_0} = {?Pm-SINVOICEV.NUM_0} and
                    {SVCRVAT.VCRTYP_0} in [18, 19, 4, 5]
                    //71937 Adaptation multi-législation
                    and 
                    ({TABVAT.LEG_0}={?Pm-COMPANY.LEG_0} or {TABVAT.LEG_0}=' ')
                    and
                    {SVCRVAT.VCRNUM_0} = {?Pm-SINVOICEV.NUM_0}

    Record Sorting
        Sort By:    SVCRVAT.VAT_0 -- Ascending Order Group #1

    Formula Fields

        Field:    INIT_Etat
            Formula:    Shared numbervar sumtax;
                        //64355
                        Shared numbervar sumTaxTVA;
                        Shared numbervar sumTaxSoumise;
                        Shared numbervar sumTaxNonSoumise;
                        
                        // En début d'état, on met à 0 le total des taxes pour la pièce courante
                        sumtax := 0;
                        //64355
                        sumTaxTVA        := 0;
                        sumTaxSoumise    := 0;
                        sumTaxNonSoumise := 0;

        Field:    sumtax
            Formula:    Shared numbervar sumtax;
                        // On mémorise alors la somme des taxes dans sumtax pour l'état appelant
                        // Cela permet de palier au BUG Crystal qui ne totalise pas tous les enregistrements possibles en sous-état Fixe
                        sumtax := {#sumtax};

        Field:    sumTaxTVA
            Formula:    //64355
                        Shared numbervar sumTaxTVA;
                        // On mémorise alors la somme des taxes dans sumtax pour l'état appelant
                        // Cela permet de palier au BUG Crystal qui ne totalise pas tous les enregistrements possibles en sous-état Fixe
                        sumTaxTVA := {#sumTaxTVA};

        Field:    sumTaxSoumise
            Formula:    //64355
                        Shared numbervar sumTaxSoumise;
                        // On mémorise alors la somme des taxes dans sumtax pour l'état appelant
                        // Cela permet de palier au BUG Crystal qui ne totalise pas tous les enregistrements possibles en sous-état Fixe
                        sumTaxSoumise := {#sumTaxSoumise};

        Field:    sumTaxNonSoumise
            Formula:    //64355
                        Shared numbervar sumTaxNonSoumise;
                        // On mémorise alors la somme des taxes dans sumtax pour l'état appelant
                        // Cela permet de palier au BUG Crystal qui ne totalise pas tous les enregistrements possibles en sous-état Fixe
                        sumTaxNonSoumise := {#sumTaxNonSoumise};

        Field:    mttTaxeNS
            Formula:    //71937 Adaptation multi-législation
                        if {TABVAT.VATTYP_0}<>1 and {TABVAT.VATCHA_0}<>2 then {SVCRVAT.AMTTAX_0} else 0;

        Field:    mttTaxeS
            Formula:    //71937 Adaptation multi-législation
                        if {TABVAT.VATTYP_0}<>1 and {TABVAT.VATCHA_0}=2 then {SVCRVAT.AMTTAX_0} else 0;

        Field:    mttTVA
            Formula:    //71937 Adaptation multi-législation
                        if {TABVAT.VATTYP_0}=1 then {SVCRVAT.AMTTAX_0} else 0;

    Running Totals

        Running Total:    sumtax
            Field:    sumtax
            Type:    sumtax
            Evaluate:    sumtax
            Evaluate Condition:    sumtax
            Reset:    sumtax
            Reset Condition:    sumtax

        Running Total:    sumTaxTVA
            Field:    sumTaxTVA
            Type:    sumTaxTVA
            Evaluate:    sumTaxTVA
            Evaluate Condition:    sumTaxTVA
            Reset:    sumTaxTVA
            Reset Condition:    sumTaxTVA

        Running Total:    sumTaxSoumise
            Field:    sumTaxSoumise
            Type:    sumTaxSoumise
            Evaluate:    sumTaxSoumise
            Evaluate Condition:    sumTaxSoumise
            Reset:    sumTaxSoumise
            Reset Condition:    sumTaxSoumise

        Running Total:    sumTaxNonSoumise
            Field:    sumTaxNonSoumise
            Type:    sumTaxNonSoumise
            Evaluate:    sumTaxNonSoumise
            Evaluate Condition:    sumTaxNonSoumise
            Reset:    sumTaxNonSoumise
            Reset Condition:    sumTaxNonSoumise

    Report Header

        Section:    Section a

            Fields

                Field:    INITEtat1
                    Data Source:    {@INIT_Etat}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

    Groups

        Group:    Group #1
            Grouped By:    {SVCRVAT.VAT_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNameVAT01
                            Data Source:    GroupName ({SVCRVAT.VAT_0})
                            Data Type:    String

    Detail

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    if {SVCRVAT.AMTTAX_0} = 0 then true 
                                else 
                                    //71937 Adaptation multi-législation
                                    {TABVAT.LEG_0}<>maximum({TABVAT.LEG_0},{SVCRVAT.VAT_0});
                                

            Fields

                Field:    VAT01
                    Data Source:    {TABVAT.VAT_0}
                    Data Type:    String

                Field:    LEG01
                    Data Source:    {TABVAT.LEG_0}
                    Data Type:    String

                Field:    AMTTAX01
                    Data Source:    {SVCRVAT.AMTTAX_0}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    mttTaxeS1
                    Data Source:    {@mttTaxeS}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    mttTVA1
                    Data Source:    {@mttTVA}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    mttTaxeNS1
                    Data Source:    {@mttTaxeNS}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

    Report Footer

        Section:    Section a

            Fields

                Field:    sumTaxNonSoumise1
                    Data Source:    {@sumTaxNonSoumise}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    sumTaxTVA2
                    Data Source:    {@sumTaxTVA}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    sumTaxSoumise1
                    Data Source:    {@sumTaxSoumise}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    sumtax2
                    Data Source:    {@sumtax}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

Subreport:    TABDEPAGIO_multileg.rpt

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-COMPANY.LEG_0
            Data Type:    String
            Description:    Pm-COMPANY.LEG_0
            List Type:    Static

        Parameter:    Pm-SINVOICE.DEP_0
            Data Type:    String
            Description:    Pm-SINVOICE.DEP_0
            List Type:    Static

        Parameter:    Pm-@param_tauxagios
            Data Type:    Number
            Description:    Pm-@param_tauxagios
            List Type:    Static

        Parameter:    Pm-@param_tauxescompte
            Data Type:    Number
            Description:    Pm-@param_tauxescompte
            List Type:    Static

        Parameter:    Pm-@param_X3DOS
            Data Type:    String
            Description:    Pm-@param_X3DOS
            List Type:    Static

        Parameter:    Pm-BPARTNER.LAN_0
            Data Type:    String
            Description:    Pm-BPARTNER.LAN_0
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.TABDEPAGIO
            Connection:    Connection #1
            Used Columns:    {TABDEPAGIO.DEP_0} : String[12]
                             {TABDEPAGIO.DEPRAT_0} : Number
                             {TABDEPAGIO.DEPRAT_1} : Number
                             {TABDEPAGIO.DEPRAT_2} : Number
                             {TABDEPAGIO.DEPRAT_3} : Number
                             {TABDEPAGIO.DEPRAT_4} : Number
                             {TABDEPAGIO.DEPRAT_5} : Number
                             {TABDEPAGIO.DEPRAT_6} : Number
                             {TABDEPAGIO.DEPRAT_7} : Number
                             {TABDEPAGIO.DEPRAT_8} : Number
                             {TABDEPAGIO.DEPRAT_9} : Number
                             {TABDEPAGIO.DEPRAT_10} : Number
                             {TABDEPAGIO.DEPRAT_11} : Number
                             {TABDEPAGIO.LEG_0} : String[42]

    Record Selection Formulas
        Formula:    {TABDEPAGIO.DEP_0} = {?Pm-SINVOICE.DEP_0}
                    and ({TABDEPAGIO.LEG_0} = {?Pm-COMPANY.LEG_0} or {TABDEPAGIO.LEG_0} = ' ')

    Record Sorting
        Sort By:    TABDEPAGIO.DEP_0 -- Ascending Order Group #1
                    TABDEPAGIO.LEG_0 -- Descending Order 

    Formula Fields

        Field:    initTauxEscAgios
            Formula:    //71937 Déclinaison multi-législation TABDEPAGIO (passage par sous-état)
                        WhilePrintingRecords;
                        shared stringVar txtcondiV1;
                        shared stringVar txtcondiV2;
                        shared stringVar txtcondiV3;
                        shared stringVar noescompte;
                        //71937 Adaptation multi-législation (remplacement global par shared pour passage sous-état)
                        //global stringVar txtcondiV1 := TextOfChapter ({?Pm-@param_X3DOS},{?Pm-BPARTNER.LAN_0},2281,50);
                        //global stringVar txtcondiV2 := TextOfChapter ({?Pm-@param_X3DOS},{?Pm-BPARTNER.LAN_0},2281,51);
                        //global stringVar txtcondiV3 := TextOfChapter ({?Pm-@param_X3DOS},{?Pm-BPARTNER.LAN_0},2281,52);
                        //global stringVar noescompte := TextOfChapter ({?Pm-@param_X3DOS},{?Pm-BPARTNER.LAN_0},2281,60);
                        
                        Local NumberVar i;
                        Local NumberVar y;
                        Local NumberVar tauxAgios := 0;
                        Local NumberVar tauxEscompte := 0;
                        
                        Local NumberVar Array x := MakeArray ({TABDEPAGIO.DEPRAT_0}, {TABDEPAGIO.DEPRAT_1}, {TABDEPAGIO.DEPRAT_2}, {TABDEPAGIO.DEPRAT_3}, {TABDEPAGIO.DEPRAT_3}, {TABDEPAGIO.DEPRAT_4}, {TABDEPAGIO.DEPRAT_5}, {TABDEPAGIO.DEPRAT_6}, {TABDEPAGIO.DEPRAT_7}, {TABDEPAGIO.DEPRAT_8}, {TABDEPAGIO.DEPRAT_9}, {TABDEPAGIO.DEPRAT_10}, {TABDEPAGIO.DEPRAT_11});
                        for i := 1 to 12 do
                        (
                            if x[i] > 0 and tauxAgios = 0 then
                                   tauxAgios := x[i];
                            if x[i] < 0 and tauxEscompte = 0 then
                                   tauxEscompte := x[i]*-1;
                        );
                        if tauxAgios = 0 and {?Pm-@param_tauxagios} <> 0 then
                        (
                            tauxAgios := {?Pm-@param_tauxagios}; 
                        );
                        if tauxAgios <> 0 then
                        (
                            txtcondiV2 := replace(txtcondiV2,"~~",ToText(tauxAgios));
                        )
                        else
                            txtcondiV2 := "";
                        if tauxEscompte = 0 and {?Pm-@param_tauxescompte} <> 0 then
                        (    
                            tauxEscompte := {?Pm-@param_tauxescompte};    
                        );
                        if tauxEscompte <> 0 then
                        (
                           txtcondiV3 := replace(txtcondiV3,"~~",ToText(tauxEscompte));
                        )
                        else
                           txtcondiV3 := noescompte;

        Field:    lbl_condivente1
            Formula:    WhilePrintingRecords;
                        shared stringVar txtcondiV1;
                        txtcondiV1;

        Field:    lbl_condivente2
            Formula:    WhilePrintingRecords;
                        shared stringVar txtcondiV2;
                        txtcondiV2;

        Field:    lbl_condivente3
            Formula:    WhilePrintingRecords;
                        shared stringVar txtcondiV3;
                        txtcondiV3;

    Groups

        Group:    Group #1
            Grouped By:    {TABDEPAGIO.DEP_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNameDEP01
                            Data Source:    GroupName ({TABDEPAGIO.DEP_0})
                            Data Type:    String

                        Field:    initTauxEscAgios1
                            Data Source:    {@initTauxEscAgios}
                            Data Type:    String

    Detail

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    //71937 Adaptation multi-législation
                                {TABDEPAGIO.LEG_0}<>maximum({TABDEPAGIO.LEG_0},{TABDEPAGIO.DEP_0});

            Fields

                Field:    lblcondivente11
                    Data Source:    {@lbl_condivente1}
                    Data Type:    String

                Field:    lblcondivente21
                    Data Source:    {@lbl_condivente2}
                    Data Type:    String

                Field:    lblcondivente31
                    Data Source:    {@lbl_condivente3}
                    Data Type:    String

Subreport:    TABPAYTERM_SPA.rpt

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-COMPANY.LEG_0
            Data Type:    String
            Description:    Pm-COMPANY.LEG_0
            List Type:    Static

        Parameter:    Pm-SINVOICE.PTE_0
            Data Type:    String
            Description:    Pm-SINVOICE.PTE_0
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.TABPAYTERM
            Connection:    Connection #1
            Used Columns:    {TABPAYTERM.PTE_0} : String[32]
                             {TABPAYTERM.PTELIN_0} : Number
                             {TABPAYTERM.LEG_0} : String[42]

        Table:    x3famesa.TRILLA.AVWTEXTRA
            Connection:    Connection #1
            Report Alias:    AVWTEXTRA_SPA
            Used Columns:    {AVWTEXTRA_SPA.LAN_0} : String[8]
                             {AVWTEXTRA_SPA.CODFIC_0} : String[26]
                             {AVWTEXTRA_SPA.ZONE_0} : String[26]
                             {AVWTEXTRA_SPA.IDENT2_0} : String[162]
                             {AVWTEXTRA_SPA.TEXTE_0} : String[162]

    Table Links
        Joins:    x3famesa.FAMESAOF.TABPAYTERM INNER JOIN x3famesa.TRILLA.AVWTEXTRA AVWTEXTRA_SPA ON x3famesa.FAMESAOF.TABPAYTERM.LEG_0,PTE_0 = AVWTEXTRA_SPA.IDENT2_0,IDENT1_0

    Record Selection Formulas
        Formula:    {AVWTEXTRA_SPA.LAN_0} = "SPA" and
                    {AVWTEXTRA_SPA.CODFIC_0} = "TABPAYTERM" and
                    {AVWTEXTRA_SPA.ZONE_0} = "DESAXX" and
                    {AVWTEXTRA_SPA.IDENT2_0} in [" ", {?Pm-COMPANY.LEG_0}] and
                    {TABPAYTERM.LEG_0} in [" ", {?Pm-COMPANY.LEG_0}] and
                    {TABPAYTERM.PTELIN_0} = 1 and
                    {TABPAYTERM.PTE_0} = {?Pm-SINVOICE.PTE_0}
                    and
                    {TABPAYTERM.PTE_0} = {?Pm-SINVOICE.PTE_0}
                    and
                    {TABPAYTERM.LEG_0} = {?Pm-COMPANY.LEG_0}

    Record Sorting
        Sort By:    TABPAYTERM.PTE_0 -- Ascending Order Group #1

    Report Header

        Section:    Section a

            Headings

                Heading:    Text2
                    Text:    TEXTE_0

    Groups

        Group:    Group #1
            Grouped By:    {TABPAYTERM.PTE_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNamePTE01
                            Data Source:    GroupName ({TABPAYTERM.PTE_0})
                            Data Type:    String

    Detail

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    //71937 Adaptation multi-législation
                                {TABPAYTERM.LEG_0}<>maximum({TABPAYTERM.LEG_0},{TABPAYTERM.PTE_0});

            Fields

                Field:    TEXTE02
                    Data Source:    {AVWTEXTRA_SPA.TEXTE_0}
                    Data Type:    String

Subreport:    TABPAYTERM_multileg.rpt

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-COMPANY.LEG_0
            Data Type:    String
            Description:    Pm-COMPANY.LEG_0
            List Type:    Static

        Parameter:    Pm-SINVOICE.PTE_0
            Data Type:    String
            Description:    Pm-SINVOICE.PTE_0
            List Type:    Static

        Parameter:    Pm-BPARTNER.LAN_0
            Data Type:    String
            Description:    Pm-BPARTNER.LAN_0
            List Type:    Static

        Parameter:    Pm-@param_X3DOS
            Data Type:    String
            Description:    Pm-@param_X3DOS
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.TABPAYTERM
            Connection:    Connection #1
            Used Columns:    {TABPAYTERM.PTE_0} : String[32]
                             {TABPAYTERM.PTELIN_0} : Number
                             {TABPAYTERM.LEG_0} : String[42]

        Table:    x3famesa.FAMESAOF.AVWTEXTRA
            Connection:    Connection #1
            Used Columns:    {AVWTEXTRA.LAN_0} : String[8]
                             {AVWTEXTRA.CODFIC_0} : String[26]
                             {AVWTEXTRA.ZONE_0} : String[26]
                             {AVWTEXTRA.IDENT1_0} : String[162]
                             {AVWTEXTRA.IDENT2_0} : String[162]
                             {AVWTEXTRA.TEXTE_0} : String[162]

    Table Links
        Joins:    x3famesa.FAMESAOF.TABPAYTERM LEFT OUTER JOIN x3famesa.FAMESAOF.AVWTEXTRA ON x3famesa.FAMESAOF.TABPAYTERM.PTE_0,LEG_0 = x3famesa.FAMESAOF.AVWTEXTRA.IDENT1_0,IDENT2_0

    Record Selection Formulas
        Formula:    {AVWTEXTRA.IDENT2_0} in [" ", {?Pm-COMPANY.LEG_0}] and
                    {AVWTEXTRA.ZONE_0} = "DESAXX" and
                    {AVWTEXTRA.CODFIC_0} = "TABPAYTERM" and
                    {AVWTEXTRA.LAN_0} = {?Pm-BPARTNER.LAN_0} and
                    {TABPAYTERM.LEG_0} in [" ", {?Pm-COMPANY.LEG_0}] and
                    {TABPAYTERM.PTELIN_0} = 1 and
                    {TABPAYTERM.PTE_0} = {?Pm-SINVOICE.PTE_0}

    Record Sorting
        Sort By:    TABPAYTERM.PTE_0 -- Ascending Order Group #1

    Groups

        Group:    Group #1
            Grouped By:    {TABPAYTERM.PTE_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNamePTE01
                            Data Source:    GroupName ({TABPAYTERM.PTE_0})
                            Data Type:    String

    Detail

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    //71937 Adaptation multi-législation
                                {TABPAYTERM.LEG_0}<>maximum({TABPAYTERM.LEG_0},{TABPAYTERM.PTE_0});

            Fields

                Field:    TEXTE01
                    Data Source:    {AVWTEXTRA.TEXTE_0}
                    Data Type:    String

Subreport:    TABVACBPR_multileg.rpt

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-COMPANY.LEG_0
            Data Type:    String
            Description:    Pm-COMPANY.LEG_0
            List Type:    Static

        Parameter:    Pm-SINVOICE.VAC_0
            Data Type:    String
            Description:    Pm-SINVOICE.VAC_0
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.TABVACBPR
            Connection:    Connection #1
            Used Columns:    {TABVACBPR.VACBPR_0} : String[12]
                             {TABVACBPR.LEG_0} : String[42]
                             {TABVACBPR.REGVAC_0} : Number

    Record Selection Formulas
        Formula:    //71937 Adaptation multi-législation
                    {TABVACBPR.VACBPR_0} = {?Pm-SINVOICE.VAC_0}
                    and
                    ({TABVACBPR.LEG_0}= {?Pm-COMPANY.LEG_0} or {TABVACBPR.LEG_0}=' ')

    Record Sorting
        Sort By:    TABVACBPR.VACBPR_0 -- Ascending Order Group #1

    Formula Fields

        Field:    textExoTVA
            Formula:    //71937 Adaptation multi-législation
                        WhilePrintingRecords;
                        shared stringVar txtexoTVA;
                        txtexoTVA;

    Groups

        Group:    Group #1
            Grouped By:    {TABVACBPR.VACBPR_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNameVACBPR01
                            Data Source:    GroupName ({TABVACBPR.VACBPR_0})
                            Data Type:    String

    Detail

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    //71937 Adaptation multi-législation
                                if {TABVACBPR.LEG_0}<>maximum({TABVACBPR.LEG_0},{TABVACBPR.VACBPR_0}) then true
                                else
                                    //Si le type de régime de la table des régimes <> CEE (4)
                                    if {TABVACBPR.REGVAC_0} <> 4 then true else false;

            Fields

                Field:    textExoTVA1
                    Data Source:    {@textExoTVA}
                    Data Type:    String

Subreport:    ZINTRASTAT

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-BPARTNER.LAN_0
            Data Type:    String
            Description:    Pm-BPARTNER.LAN_0
            List Type:    Static

        Parameter:    Pm-ITMMASTER.CUSREF_0
            Data Type:    String
            Description:    Pm-ITMMASTER.CUSREF_0
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.ATEXTRA
            Connection:    Connection #1
            Used Columns:    {ATEXTRA.CODFIC_0} : String[26]
                             {ATEXTRA.ZONE_0} : String[26]
                             {ATEXTRA.LANGUE_0} : String[8]
                             {ATEXTRA.IDENT1_0} : String[162]
                             {ATEXTRA.TEXTE_0} : String[162]

    Record Selection Formulas
        Formula:    {ATEXTRA.CODFIC_0}='ITMCUSNOM' and {ATEXTRA.ZONE_0}='DESAXX'
                    and {ATEXTRA.LANGUE_0} = {?Pm-BPARTNER.LAN_0}
                    and {ATEXTRA.IDENT1_0} = {?Pm-ITMMASTER.CUSREF_0}

    Detail

        Section:    Section a

            Fields

                Field:    TEXTE01
                    Data Source:    {ATEXTRA.TEXTE_0}
                    Data Type:    String

                Field:    IDENT101
                    Data Source:    {ATEXTRA.IDENT1_0}
                    Data Type:    String

Subreport:    logo2.rpt

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    X3DOS
            Data Type:    String
            Description:    Dossier
            List Type:    Static
            List Values:    X3TESTV5;aydaix04.sagefr.adinternal.com;15150;150;FRA
            Default Values:    X3TESTV5;aydaix04.sagefr.adinternal.com;15150;150;FRA

    Tables

        Table:    x3famesa.FAMESAOF.ABLOB
            Connection:    Connection #1
            Used Columns:    {ABLOB.CODBLB_0} : String[22]
                             {ABLOB.IDENT1_0} : String[162]
                             {ABLOB.IDENT2_0} : String[162]
                             {ABLOB.IDENT3_0} : String[22]
                             {ABLOB.BLOB_0} : Unknown

    Record Selection Formulas
        Formula:    {ABLOB.CODBLB_0} = "PJ_ADS" and
                    {ABLOB.IDENT1_0} = Split ({?X3DOS},";")[1] and
                    {ABLOB.IDENT3_0} = "002" and
                    {ABLOB.IDENT2_0} = " "

    Detail

        Section:    Section a

            Pictures (Blobs)

                Picture (Blob):    BLOB01
                    Data Source:    {ABLOB.BLOB_0}
                    Size:    140x56

Subreport:    logo3.rpt

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    X3DOS
            Data Type:    String
            Description:    Dossier
            List Type:    Static
            List Values:    X3TESTV5;aydaix04.sagefr.adinternal.com;15150;150;FRA
            Default Values:    X3TESTV5;aydaix04.sagefr.adinternal.com;15150;150;FRA

    Tables

        Table:    x3famesa.FAMESAOF.ABLOB
            Connection:    Connection #1
            Used Columns:    {ABLOB.CODBLB_0} : String[22]
                             {ABLOB.IDENT1_0} : String[162]
                             {ABLOB.IDENT2_0} : String[162]
                             {ABLOB.IDENT3_0} : String[22]
                             {ABLOB.BLOB_0} : Unknown

    Record Selection Formulas
        Formula:    {ABLOB.IDENT1_0} = Split ({?X3DOS},";")[1] and
                    {ABLOB.CODBLB_0} = "PJ_ADS" and
                    {ABLOB.IDENT3_0} = "003" and
                    {ABLOB.IDENT2_0} = " "

    Detail

        Section:    Section a

            Pictures (Blobs)

                Picture (Blob):    BLOB01
                    Data Source:    {ABLOB.BLOB_0}
                    Size:    151x128

Subreport:    mtacompte_Facture_validee

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    Pm-SINVOICE.GTE_0
            Data Type:    String
            Description:    Pm-SINVOICE.GTE_0
            List Type:    Static

        Parameter:    Pm-SINVOICE.NUM_0
            Data Type:    String
            Description:    Pm-SINVOICE.NUM_0
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.GACCDUDATE
            Connection:    Connection #1
            Used Columns:    {GACCDUDATE.TYP_0} : String[12]
                             {GACCDUDATE.NUM_0} : String[42]
                             {GACCDUDATE.LIG_0} : Number
                             {GACCDUDATE.PAYCUR_0} : Number
                             {GACCDUDATE.TMPCUR_0} : Number

    Record Selection Formulas
        Formula:    {GACCDUDATE.NUM_0} = {?Pm-SINVOICE.NUM_0} and
                    {GACCDUDATE.TYP_0} = {?Pm-SINVOICE.GTE_0} and
                    {GACCDUDATE.LIG_0} = 1

    Formula Fields

        Field:    mt_paycur_tmpcur
            Formula:    // MAJ de la variable Shared pour que l'état principal puisse récupérer le montant des accomptes
                        Shared Numbervar Mtacompte_Facture_validee := Sum ({GACCDUDATE.PAYCUR_0}) + Sum({GACCDUDATE.TMPCUR_0});
                        
                        
                        

    Report Footer

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    // Suppression section si le montant de la somme des accomptes est = 0
                                if {@mt_paycur_tmpcur} = 0 then 
                                   True 
                                else 
                                   False;
                                

            Fields

                Field:    mtpaycurtmpcur1
                    Data Source:    {@mt_paycur_tmpcur}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

            Text Fields

                Text Field:    Texte42
                    Text:    Importe ajustado

Subreport:    s-datech

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    X3DOS
            Data Type:    String
            List Type:    Static
            List Values:     
            Default Values:     

        Parameter:    Pm-SINVOICE.GTE_0
            Data Type:    String
            Description:    Pm-SINVOICE.GTE_0
            List Type:    Static

        Parameter:    Pm-SINVOICE.NUM_0
            Data Type:    String
            Description:    Pm-SINVOICE.NUM_0
            List Type:    Static

        Parameter:    Pm-SINVOICE.STA_0
            Data Type:    Number
            Description:    Pm-SINVOICE.STA_0
            List Type:    Static

        Parameter:    Pm-@Mtacompte_Facture_non_validee
            Data Type:    Number
            Description:    Pm-@Mtacompte_Facture_non_validee
            List Type:    Static

        Parameter:    Pm-COMPANY.LEG_0
            Data Type:    String
            Description:    Pm-COMPANY.LEG_0
            List Type:    Static

        Parameter:    Pm-@afficheSdd
            Data Type:    Boolean
            Description:    Pm-@afficheSdd
            List Type:    Static
            List Values:    False
                            True
            Default Values:    False
                               True

        Parameter:    Pm-BPARTNER.LAN_0
            Data Type:    String
            Description:    Pm-BPARTNER.LAN_0
            List Type:    Static

    Tables

        Table:    x3famesa.FAMESAOF.GACCDUDATE
            Connection:    Connection #1
            Used Columns:    {GACCDUDATE.TYP_0} : String[12]
                             {GACCDUDATE.NUM_0} : String[42]
                             {GACCDUDATE.LIG_0} : Number
                             {GACCDUDATE.DUDLIG_0} : Number
                             {GACCDUDATE.CUR_0} : String[8]
                             {GACCDUDATE.DUDDAT_0} : Date
                             {GACCDUDATE.PAM_0} : String[12]
                             {GACCDUDATE.AMTCUR_0} : Number
                             {GACCDUDATE.PAYCUR_0} : Number
                             {GACCDUDATE.TMPCUR_0} : Number
                             {GACCDUDATE.UMRNUM_0} : String[72]

        Table:    x3famesa.FAMESAOF.TABCUR
            Connection:    Connection #1
            Used Columns:    {TABCUR.CUR_0} : String[8]
                             {TABCUR.DECNBR_0} : Number

        Table:    x3famesa.FAMESAOF.TABPAM
            Connection:    Connection #1
            Used Columns:    {TABPAM.PAM_0} : String[12]
                             {TABPAM.LEG_0} : String[42]

        Table:    x3famesa.FAMESAOF.AVWTEXTRA
            Connection:    Connection #1
            Used Columns:    {AVWTEXTRA.LAN_0} : String[8]
                             {AVWTEXTRA.CODFIC_0} : String[26]
                             {AVWTEXTRA.ZONE_0} : String[26]
                             {AVWTEXTRA.IDENT1_0} : String[162]
                             {AVWTEXTRA.IDENT2_0} : String[162]
                             {AVWTEXTRA.TEXTE_0} : String[162]

    Table Links
        Joins:    x3famesa.FAMESAOF.GACCDUDATE LEFT OUTER JOIN x3famesa.FAMESAOF.TABCUR ON x3famesa.FAMESAOF.GACCDUDATE.CUR_0 = x3famesa.FAMESAOF.TABCUR.CUR_0
                  x3famesa.FAMESAOF.GACCDUDATE LEFT OUTER JOIN x3famesa.FAMESAOF.TABPAM ON x3famesa.FAMESAOF.GACCDUDATE.PAM_0 = x3famesa.FAMESAOF.TABPAM.PAM_0
                  x3famesa.FAMESAOF.TABPAM LEFT OUTER JOIN x3famesa.FAMESAOF.AVWTEXTRA ON x3famesa.FAMESAOF.TABPAM.PAM_0,LEG_0 = x3famesa.FAMESAOF.AVWTEXTRA.IDENT1_0,IDENT2_0

    Record Selection Formulas
        Formula:    {GACCDUDATE.NUM_0} = {?Pm-SINVOICE.NUM_0} and
                    {GACCDUDATE.TYP_0} = {?Pm-SINVOICE.GTE_0} and
                    {GACCDUDATE.LIG_0} = 1.00
                    //71937 Adaptation multi-législation
                    //{ATABDIV.NUMTAB_0} = 3
                    and ({TABPAM.LEG_0}={?Pm-COMPANY.LEG_0} or {TABPAM.LEG_0}=' ')
                    // Lecture de la désignation traduite du code Taxe par accès à la vue AVWTEXTRA
                    and  {AVWTEXTRA.CODFIC_0}="TABPAM" 
                    and  {AVWTEXTRA.ZONE_0}  ="DESAXX"
                    and  {AVWTEXTRA.LAN_0}   = {?Pm-BPARTNER.LAN_0}
                    and ({AVWTEXTRA.IDENT2_0}= {?Pm-COMPANY.LEG_0} or {AVWTEXTRA.IDENT2_0}=' ')
                    

    Record Sorting
        Sort By:    GACCDUDATE.DUDDAT_0 -- Ascending Order Group #1
                    GACCDUDATE.DUDLIG_0 -- Ascending Order Group #2
                    TABPAM.PAM_0 -- Ascending Order Group #3
                    TABPAM.LEG_0 -- Descending Order 
                    GACCDUDATE.DUDDAT_0 -- Ascending Order Group #1
                    GACCDUDATE.DUDLIG_0 -- Ascending Order Group #2

    Formula Fields

        Field:    txtintit
            Formula:    WhilePrintingRecords;
                        //71937 Adaptation multi-législation
                        //stringVar X3TEX := "ATABDIV~LNGDES~3~"+{ATABDIV.CODE_0}+"~";
                        //X3TranslatedText ({?X3DOS},{?Pm-BPARTNER.LAN_0},X3TEX)
                        {AVWTEXTRA.TEXTE_0}
                        

        Field:    decimald
            Formula:    {TABCUR.DECNBR_0}
                        

        Field:    EditMtResteDet
            Formula:    //Bug 52478
                        //Pour calculer le montant des acomptes réglés, dans les états SBONFAC, SBONFACP,SBONFACP2,SBONFACP2PI  :
                        //[F :SIV]INSORDNUM : N°Commande
                        //[F :SIV]INSLIN   : N°Ligne
                        //Nous permettent d’aller lire les échéances de l’acompte dans GACCDUDATE avec la clé DUD0 
                        //TYP : *SO
                        //NUM : [F :SIV]INSORDNUM
                        //LIG : 1
                        //DUDLIG : [F :SIV]INSLIN
                        //On peut avoir jusqu’à 4 acomptes sur une facture. Le pb ensuite, c’est qu’il n’y a pas de lien entre les échéances de la facture et la ou les échéances de l’acompte.
                        //Pour la facture, dans GACCDUDATE nous avons
                        //TYP : [F :SIH]GTE
                        //NUM : [F :SIV]NUM
                        //C’est pour cette raison que l'on décrémente chaque échéance de la facture en fonction du montant total des acomptes réglés. 
                        //Si on a plusieurs acomptes, il faut calculer le total réglé. Et si on a plusieurs échéances sur la facture, il faut déduire le maximum sur la 1ère, puis sur la 2ème etc
                        //{GACCDUDATE.AMTCUR_0} - {GACCDUDATE.PAYCUR_0} - {GACCDUDATE.TMPCUR_0}
                        WhilePrintingRecords;
                        Shared numbervar MtAcptEcheance;
                        local numbervar EcheanceReste := 0;
                        local numbervar MtTotEcheanceFacture := 0;
                        
                        //71937 Adaptation multi-législations
                        //Totalisation des échéances restantes
                        //shared numbervar TotMtReste ;
                        
                        // Si le statut de la facture est Validée.
                        // SINVOICE.STA = Statut de facture / Menu Local n° 429 
                        // (1 = Non Imprimée / 2 = Imprimée  / 3 = Validée)
                        if {?Pm-SINVOICE.STA_0} = 3 then 
                        (
                            MtAcptEcheance := 0;
                            EcheanceReste := {GACCDUDATE.AMTCUR_0} - {GACCDUDATE.PAYCUR_0} - {GACCDUDATE.TMPCUR_0} ;
                        )
                        else
                        ( 
                           if {?Pm-@Mtacompte_Facture_non_validee} < MtAcptEcheance then
                                MtTotEcheanceFacture := {?Pm-@Mtacompte_Facture_non_validee}
                           else
                              MtTotEcheanceFacture := MtAcptEcheance;
                           
                           if {GACCDUDATE.AMTCUR_0} - {GACCDUDATE.PAYCUR_0} - {GACCDUDATE.TMPCUR_0} >= MtTotEcheanceFacture then
                            (
                                EcheanceReste := {GACCDUDATE.AMTCUR_0} - {GACCDUDATE.PAYCUR_0} - {GACCDUDATE.TMPCUR_0} - MtTotEcheanceFacture;
                                MtAcptEcheance := 0;
                            )
                            else
                            (
                                MtAcptEcheance := MtTotEcheanceFacture - ({GACCDUDATE.AMTCUR_0} - {GACCDUDATE.PAYCUR_0} - {GACCDUDATE.TMPCUR_0});
                                EcheanceReste := 0;
                            );
                        );   
                        //71937 Adaptation multi-législations
                        //if {@SiPlus4Ech} then
                        //  TotMtReste := TotMtReste + EcheanceReste
                        //else 
                          //if {GACCDUDATE.DUDLIG_0} <6.00 then
                          EcheanceReste
                        ;
                        
                        
                        
                        
                        

        Field:    NbInit
            Formula:    //Formule : NbInit
                        //Nb échéance traitée
                        shared numbervar NbEch      := 0;
                        shared numbervar NbEchSdd   := 0 ;
                        shared numbervar NbEchSdd2  := 0 ;
                        shared numbervar TotMtReste := 0 ;
                        shared numbervar TotMtEch   := 0 ;
                        shared stringvar TxtEchNo4  :=' ';

        Field:    NbEchAdd
            Formula:    //Formule NbEchAdd
                        WhilePrintingRecords;
                        shared numbervar NbEch ;
                        
                        //Ajout de 1 sur Nb échéance
                        //71937 Adaptation multi-législations 
                        //NbEch := NbEch + 1;
                        If {TABPAM.LEG_0}=maximum({TABPAM.LEG_0},{TABPAM.PAM_0}) Then
                            NbEch := NbEch + 1;
                        
                        if {GACCDUDATE.DUDLIG_0} >0.00 then
                         ' ' ;
                        

        Field:    EditCurTot
            Formula:    // Edition devise si Nb ech > 4 , sinon rien 
                        if {@SiPlus4Ech} then
                          {TABCUR.CUR_0}
                        

        Field:    EditDat
            Formula:    // Edition date 
                        {GACCDUDATE.DUDDAT_0}

        Field:    EditDat5
            Formula:    // Edition de la date s'il y a 5 échéances
                        if not{@SiPlus5Ech} then
                          {GACCDUDATE.DUDDAT_0}
                        

        Field:    EditMtEchDet
            Formula:    WhilePrintingRecords;
                        local numbervar MtEch := 0;
                        //71937 Adaptation multi-législations
                        //shared numbervar TotMtEch;
                        
                        MtEch := {GACCDUDATE.AMTCUR_0}  ;
                        //71937 Adaptation multi-législations 
                        //if {@SiPlus4Ech} then
                        //  TotMtEch := TotMtEch + MtEch
                        //else 
                          MtEch
                        ;
                        

        Field:    EditMtEchTot
            Formula:    // Edition du total autres échéances si Nb ech > 3 , sinon rien 
                        if {@SiPlus4Ech} then
                          shared numbervar TotMtEch
                        

        Field:    EditMtResteTot
            Formula:    // Edition du total autres échéances restantes si Nb ech > 4 , sinon rien 
                        if {@SiPlus4Ech} then
                            shared numbervar TotMtReste
                        

        Field:    NbEch
            Formula:    //Nb échéance traitée
                        shared numbervar NbEch
                        

        Field:    SiPlus4Ech
            Formula:    //{GACCDUDATE.DUDLIG_0} >4.00
                        {@NbEch} >4
                        

        Field:    SiPlus5Ech
            Formula:    //{GACCDUDATE.DUDLIG_0} >5.00
                        {@NbEch} >5
                        

        Field:    TotMtEch
            Formula:    //71937 Adaptation multi-législations
                        WhilePrintingRecords;
                        shared numbervar TotMtEch;
                         
                        if {@SiPlus3Ech} and {TABPAM.LEG_0}=maximum({TABPAM.LEG_0},{TABPAM.PAM_0}) then
                          TotMtEch := TotMtEch + {@EditMtEchDet};

        Field:    TotMtReste
            Formula:    //71937 Adaptation multi-législations
                        WhilePrintingRecords;
                        //Totalisation des échéances restantes
                        shared numbervar TotMtReste ;
                        
                        if {@SiPlus3Ech} and {TABPAM.LEG_0}=maximum({TABPAM.LEG_0},{TABPAM.PAM_0}) then
                          TotMtReste := TotMtReste + {@EditMtResteDet};

        Field:    TxtEchNo4
            Formula:    //71937 Lors de la déclinaison multi-législation
                        WhilePrintingRecords;
                        shared numbervar NbEch;
                        shared stringvar TxtEchNo4;
                        
                        If NbEch=4 and {TABPAM.LEG_0}=maximum({TABPAM.LEG_0},{TABPAM.PAM_0}) Then 
                          TxtEchNo4 := {AVWTEXTRA.TEXTE_0};
                        

        Field:    Sdd2Affiche
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        if {?Pm-@afficheSdd} then true 

        Field:    Sdd2NoMandat
            Formula:    // Edition de la date s'il y a 5 echeances
                        if not{@SiPlus5Ech} and {@Sdd2Affiche} then
                          {GACCDUDATE.UMRNUM_0}

        Field:    Sdd2FormNbEchSdd
            Formula:    // Sam S87923 JDE : Ajout Ref mandat Sdd  --# 
                        //Nb échéance Sdd trouvée
                        WhilePrintingRecords;
                        shared numbervar NbEch;
                        shared numbervar NbEchSdd;
                        shared numbervar NbEchSdd2;
                        
                        //NbEch := NbEch + 1;
                        
                        //Ajout de 1 sur Nb échéance Sdd
                        If {GACCDUDATE.UMRNUM_0}<>'' Then
                            NbEchSdd  := NbEchSdd  + 1;
                        
                        //Ajout de 1 sur Nb échéance Sdd2
                        If {GACCDUDATE.UMRNUM_0}<>'' and (NbEch >4) Then
                            NbEchSdd2  := NbEchSdd2  + 1;
                        
                        if {GACCDUDATE.DUDLIG_0} >0.00 then
                         ' ' ;
                        
                        
                        

        Field:    SiPlus3Ech
            Formula:    //{GACCDUDATE.DUDLIG_0} >3.00
                        {@NbEch} >3
                        

        Field:    lblCondpago
            Formula:    WhilePrintingRecords;
                        global stringVar txtCondPago;

        Field:    lblFVto
            Formula:    WhilePrintingRecords;
                        global stringVar txtFVto;

        Field:    lblMPago
            Formula:    WhilePrintingRecords;
                        global stringVar txtMPago;

        Field:    lblImpVto
            Formula:    WhilePrintingRecords;
                        global stringVar txtImpVto;

        Field:    lblRestoPagar
            Formula:    WhilePrintingRecords;
                        global stringVar txtRestoPagar;

        Field:    lblRefMandato
            Formula:    WhilePrintingRecords;
                        global stringVar txtMPago;

    Unused Formula Fields

        Field:    Txtintitfin
            Formula:    WhilePrintingRecords;
                        //71937 Lors de la déclinaison multi-législation
                        shared stringvar TxtEchNo4;
                        //shared stringVar Int_AutresEch      := TextOfChapter ({?X3DOS},"FRA",2281,117); 
                        shared stringVar Int_AutresEch      := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},2281,117); 
                        //stringVar X3TEX := "ATABDIV~LNGDES~3~"+{ATABDIV.CODE_0}+"~"; //71937
                        shared numbervar NbEch ;
                        
                        // Edition de 'x autres échéances' si Nb ech > 4 , sinon editon du mode de reglement
                        if {@SiPlus5Ech} then
                           totext(NbEch-4,0) + ' '  + Int_AutresEch
                        else
                          //71937 Adaptation multi-législation  
                          //X3TranslatedText ({?X3DOS},{?Pm-BPARTNER.LAN_0},X3TEX) 
                          TxtEchNo4;
                        

        Field:    textofchapter
            Formula:    WhilePrintingRecords;
                        global stringvar txtCondPago := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,32);
                        global stringvar txtFVto := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,33);
                        global stringvar txtMPago := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,34);
                        global stringvar txtImpVto := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,35);
                        global stringvar txtRestoPagar := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,36);
                        global stringvar txtRefMandato := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,37);

        Field:    textofchapter
            Formula:    WhilePrintingRecords;
                        global stringvar txtCondPago := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,32);
                        global stringvar txtFVto := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,33);
                        global stringvar txtMPago := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,34);
                        global stringvar txtImpVto := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,35);
                        global stringvar txtRestoPagar := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,36);
                        global stringvar txtRefMandato := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},6969,37);

        Field:    Txtintitfin
            Formula:    WhilePrintingRecords;
                        //71937 Lors de la déclinaison multi-législation
                        shared stringvar TxtEchNo4;
                        //shared stringVar Int_AutresEch      := TextOfChapter ({?X3DOS},"FRA",2281,117); 
                        shared stringVar Int_AutresEch      := TextOfChapter ({?X3DOS},{?Pm-BPARTNER.LAN_0},2281,117); 
                        //stringVar X3TEX := "ATABDIV~LNGDES~3~"+{ATABDIV.CODE_0}+"~"; //71937
                        shared numbervar NbEch ;
                        
                        // Edition de 'x autres échéances' si Nb ech > 4 , sinon editon du mode de reglement
                        if {@SiPlus5Ech} then
                           totext(NbEch-4,0) + ' '  + Int_AutresEch
                        else
                          //71937 Adaptation multi-législation  
                          //X3TranslatedText ({?X3DOS},{?Pm-BPARTNER.LAN_0},X3TEX) 
                          TxtEchNo4;
                        

    Report Header

        Section:    Section a

            Fields

                Field:    textofchapter1
                    Data Source:    {@textofchapter}
                    Data Type:    String

                Field:    lblCondpago1
                    Data Source:    {@lblCondpago}
                    Data Type:    String

        Section:    Section b

            Fields

                Field:    NbInit1
                    Data Source:    {@NbInit}
                    Data Type:    String

        Section:    Section c

            Fields

                Field:    lblFVto1
                    Data Source:    {@lblFVto}
                    Data Type:    String

                Field:    lblMPago1
                    Data Source:    {@lblMPago}
                    Data Type:    String

                Field:    lblImpVto1
                    Data Source:    {@lblImpVto}
                    Data Type:    String

                Field:    lblRestoPagar1
                    Data Source:    {@lblRestoPagar}
                    Data Type:    String

                Field:    lblRefMandato1
                    Data Source:    {@lblRefMandato}
                    Data Type:    String
                    Suppression Formula:    not {@Sdd2Affiche} 

            Boxes

                Box:    Box1
                    Ends in Section:    ReportFooterSection1
                    Size:    421x228
                    Line Type:    Single
                    Line Thickness:    0

            Lines

                Line:    Line3
                    Ends in Section:    Section1
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line4
                    Ends in Section:    ReportFooterSection1
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line5
                    Ends in Section:    ReportFooterSection1
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line6
                    Ends in Section:    Section1
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line1
                    Ends in Section:    Section3
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line2
                    Ends in Section:    Section3
                    Line Type:    Single
                    Line Thickness:    0

    Groups

        Group:    Group #1
            Grouped By:    {GACCDUDATE.DUDDAT_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNameDUDDAT0weekly1
                            Data Source:    GroupName ({GACCDUDATE.DUDDAT_0}, "weekly")
                            Data Type:    String

        Group:    Group #2
            Grouped By:    {GACCDUDATE.DUDLIG_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNameDUDLIG01
                            Data Source:    GroupName ({GACCDUDATE.DUDLIG_0})
                            Data Type:    String

        Group:    Group #3
            Grouped By:    {TABPAM.PAM_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNamePAM01
                            Data Source:    GroupName ({TABPAM.PAM_0})
                            Data Type:    String

                        Field:    NbEch1
                            Data Source:    {@NbEch}
                            Data Type:    Number
                            Format:    Number
                                Currency Symbol:    None
                                Suppress if Zero:    False
                                Leading Zero:    True
                                Reverse Sign:    False
                                Number Style:    -5.555.555,

    Detail

        Section:    Section a

            Fields

                Field:    TotMtEch1
                    Data Source:    {@TotMtEch}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    TotMtReste1
                    Data Source:    {@TotMtReste}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    TxtEchNo41
                    Data Source:    {@TxtEchNo4}
                    Data Type:    String

                Field:    Sdd2FormNbEchSdd1
                    Data Source:    {@Sdd2FormNbEchSdd}
                    Data Type:    String

        Section:    Section b

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    // test plus de 4 echeances
                                //71937 Adaptation multi-législation
                                //{@SiPlus4Ech}
                                If {@SiPlus3Ech} then true else 
                                {TABPAM.LEG_0}<>maximum({TABPAM.LEG_0},{TABPAM.PAM_0});
                                

            Fields

                Field:    EditDat1
                    Data Source:    {@EditDat}
                    Data Type:    Date
                    Format:    Date and Time
                        Order:    Date Time
                        Date Type:    Custom
                        Date Format:    DD/MM/YYYY hh:mm:ss  AM

                Field:    Champ2
                    Data Source:    {@txtintit}
                    Data Type:    String

                Field:    EditMtEchDet1
                    Data Source:    {@EditMtEchDet}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    CUR01
                    Data Source:    {TABCUR.CUR_0}
                    Data Type:    String

                Field:    Echeancerestante1
                    Data Source:    {@EditMtResteDet}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    Champ4
                    Data Source:    {TABCUR.CUR_0}
                    Data Type:    String

                Field:    Sdd2NoMandat1
                    Data Source:    {@Sdd2NoMandat}
                    Data Type:    String
                    Suppression Formula:    not  {@Sdd2Affiche}

                Field:    NbEchAdd1
                    Data Source:    {@NbEchAdd}
                    Data Type:    String

    Report Footer

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    // test plus de 5 echeances
                                not {@SiPlus4Ech}
                                

            Fields

                Field:    EditDat51
                    Data Source:    {@EditDat5}
                    Data Type:    Date
                    Format:    Date and Time
                        Order:    Date Time
                        Date Type:    Custom
                        Date Format:    DD/MM/YYYY hh:mm:ss  AM

                Field:    EditMtEchTot1
                    Data Source:    {@EditMtEchTot}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    EditCurTot1
                    Data Source:    {@EditCurTot}
                    Data Type:    String

                Field:    EditMtResteTot1
                    Data Source:    {@EditMtResteTot}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    EditCurTot2
                    Data Source:    {@EditCurTot}
                    Data Type:    String

                Field:    Sdd2NoMandat2
                    Data Source:    {@Sdd2NoMandat}
                    Data Type:    String
                    Suppression Formula:    not  {@Sdd2Affiche}

                Field:    Txtintitfin1
                    Data Source:    {@Txtintitfin}
                    Data Type:    String

Subreport:    s_datech_sdd.rpt

    Data Sources

        Source:    Connection #1
            Database DLL:    crdb_odbc.dll
            Database Name:    x3famesa
            Server:    MSSQL Famesa

            Properties:    QE_LogonProperties
                Database:    x3famesa
                DSN:    MSSQL Famesa
                UseDSNProperties:    False
            QE_SQLDB:    False
            SSO Enabled:    False

    Report Parameters

        Parameter:    X3DOS
            Data Type:    String
            List Type:    Static
            List Values:     
            Default Values:     

        Parameter:    Pm-SINVOICE.GTE_0
            Data Type:    String
            Description:    Pm-SINVOICE.GTE_0
            List Type:    Static

        Parameter:    Pm-SINVOICE.NUM_0
            Data Type:    String
            Description:    Pm-SINVOICE.NUM_0
            List Type:    Static

        Parameter:    Pm-SINVOICEV.LAN_0
            Data Type:    String
            Description:    Pm-SINVOICEV.LAN_0
            List Type:    Static

        Parameter:    Pm-SINVOICE.STA_0
            Data Type:    Number
            Description:    Pm-SINVOICE.STA_0
            List Type:    Static

        Parameter:    Pm-@Mtacompte_Facture_non_validee
            Data Type:    Number
            Description:    Pm-@Mtacompte_Facture_non_validee
            List Type:    Static

        Parameter:    Pm-COMPANY.LEG_0
            Data Type:    String
            Description:    Pm-COMPANY.LEG_0
            List Type:    Static

        Parameter:    Pm-@afficheSdd
            Data Type:    Boolean
            Description:    Pm-@afficheSdd
            List Type:    Static
            List Values:    False
                            True
            Default Values:    False
                               True

    Tables

        Table:    x3famesa.FAMESAOF.GACCDUDATE
            Connection:    Connection #1
            Used Columns:    {GACCDUDATE.TYP_0} : String[12]
                             {GACCDUDATE.NUM_0} : String[42]
                             {GACCDUDATE.LIG_0} : Number
                             {GACCDUDATE.DUDLIG_0} : Number
                             {GACCDUDATE.CUR_0} : String[8]
                             {GACCDUDATE.DUDDAT_0} : Date
                             {GACCDUDATE.PAM_0} : String[12]
                             {GACCDUDATE.AMTCUR_0} : Number
                             {GACCDUDATE.PAYCUR_0} : Number
                             {GACCDUDATE.TMPCUR_0} : Number
                             {GACCDUDATE.UMRNUM_0} : String[72]

        Table:    x3famesa.FAMESAOF.TABCUR
            Connection:    Connection #1
            Used Columns:    {TABCUR.CUR_0} : String[8]
                             {TABCUR.DECNBR_0} : Number

        Table:    x3famesa.FAMESAOF.TABPAM
            Connection:    Connection #1
            Used Columns:    {TABPAM.PAM_0} : String[12]
                             {TABPAM.LEG_0} : String[42]

        Table:    x3famesa.FAMESAOF.AVWTEXTRA
            Connection:    Connection #1
            Used Columns:    {AVWTEXTRA.LAN_0} : String[8]
                             {AVWTEXTRA.CODFIC_0} : String[26]
                             {AVWTEXTRA.ZONE_0} : String[26]
                             {AVWTEXTRA.IDENT1_0} : String[162]
                             {AVWTEXTRA.IDENT2_0} : String[162]
                             {AVWTEXTRA.TEXTE_0} : String[162]

    Table Links
        Joins:    x3famesa.FAMESAOF.GACCDUDATE LEFT OUTER JOIN x3famesa.FAMESAOF.TABCUR ON x3famesa.FAMESAOF.GACCDUDATE.CUR_0 = x3famesa.FAMESAOF.TABCUR.CUR_0
                  x3famesa.FAMESAOF.GACCDUDATE LEFT OUTER JOIN x3famesa.FAMESAOF.TABPAM ON x3famesa.FAMESAOF.GACCDUDATE.PAM_0 = x3famesa.FAMESAOF.TABPAM.PAM_0
                  x3famesa.FAMESAOF.TABPAM LEFT OUTER JOIN x3famesa.FAMESAOF.AVWTEXTRA ON x3famesa.FAMESAOF.TABPAM.PAM_0,LEG_0 = x3famesa.FAMESAOF.AVWTEXTRA.IDENT1_0,IDENT2_0

    Record Selection Formulas
        Formula:    {GACCDUDATE.NUM_0} = {?Pm-SINVOICE.NUM_0} and
                    {GACCDUDATE.TYP_0} = {?Pm-SINVOICE.GTE_0} and
                    {GACCDUDATE.LIG_0} = 1.00 and
                    ({TABPAM.LEG_0}={?Pm-COMPANY.LEG_0} or {TABPAM.LEG_0}=' ') and
                    {AVWTEXTRA.CODFIC_0}="TABPAM" and
                    {AVWTEXTRA.ZONE_0}  ="DESAXX" and
                    {AVWTEXTRA.LAN_0}   = {?Pm-SINVOICEV.LAN_0} and
                    {AVWTEXTRA.IDENT2_0} in [" ", {?Pm-COMPANY.LEG_0}]

    Record Sorting
        Sort By:    GACCDUDATE.DUDDAT_0 -- Ascending Order Group #1
                    GACCDUDATE.DUDLIG_0 -- Ascending Order Group #2
                    TABPAM.PAM_0 -- Ascending Order Group #3
                    TABPAM.LEG_0 -- Descending Order 
                    GACCDUDATE.DUDDAT_0 -- Ascending Order Group #1
                    GACCDUDATE.DUDLIG_0 -- Ascending Order Group #2

    Formula Fields

        Field:    txtintit
            Formula:    WhilePrintingRecords;
                        //71937 Adaptation multi-législation
                        //stringVar X3TEX := "ATABDIV~LNGDES~3~"+{ATABDIV.CODE_0}+"~";
                        //X3TranslatedText ({?X3DOS},{?Pm-SINVOICEV.LAN_0},X3TEX)
                        {AVWTEXTRA.TEXTE_0}
                        

        Field:    decimald
            Formula:    {TABCUR.DECNBR_0}
                        

        Field:    EditMtResteDet
            Formula:    //Bug 52478
                        //Pour calculer le montant des acomptes réglés, dans les états SBONFAC, SBONFACP,SBONFACP2,SBONFACP2PI  :
                        //[F :SIV]INSORDNUM : N°Commande
                        //[F :SIV]INSLIN   : N°Ligne
                        //Nous permettent d’aller lire les échéances de l’acompte dans GACCDUDATE avec la clé DUD0 
                        //TYP : *SO
                        //NUM : [F :SIV]INSORDNUM
                        //LIG : 1
                        //DUDLIG : [F :SIV]INSLIN
                        //On peut avoir jusqu’à 4 acomptes sur une facture. Le pb ensuite, c’est qu’il n’y a pas de lien entre les échéances de la facture et la ou les échéances de l’acompte.
                        //Pour la facture, dans GACCDUDATE nous avons
                        //TYP : [F :SIH]GTE
                        //NUM : [F :SIV]NUM
                        //C’est pour cette raison que l'on décrémente chaque échéance de la facture en fonction du montant total des acomptes réglés. 
                        //Si on a plusieurs acomptes, il faut calculer le total réglé. Et si on a plusieurs échéances sur la facture, il faut déduire le maximum sur la 1ère, puis sur la 2ème etc
                        //{GACCDUDATE.AMTCUR_0} - {GACCDUDATE.PAYCUR_0} - {GACCDUDATE.TMPCUR_0}
                        WhilePrintingRecords;
                        Shared numbervar MtAcptEcheance;
                        local numbervar EcheanceReste := 0;
                        local numbervar MtTotEcheanceFacture := 0;
                        
                        //71937 Adaptation multi-législations
                        //Totalisation des échéances restantes
                        //shared numbervar TotMtReste ;
                        
                        // Si le statut de la facture est Validée.
                        // SINVOICE.STA = Statut de facture / Menu Local n° 429 
                        // (1 = Non Imprimée / 2 = Imprimée  / 3 = Validée)
                        if {?Pm-SINVOICE.STA_0} = 3 then 
                        (
                            MtAcptEcheance := 0;
                            EcheanceReste := {GACCDUDATE.AMTCUR_0} - {GACCDUDATE.PAYCUR_0} - {GACCDUDATE.TMPCUR_0} ;
                        )
                        else
                        ( 
                           if {?Pm-@Mtacompte_Facture_non_validee} < MtAcptEcheance then
                                MtTotEcheanceFacture := {?Pm-@Mtacompte_Facture_non_validee}
                           else
                              MtTotEcheanceFacture := MtAcptEcheance;
                           
                           if {GACCDUDATE.AMTCUR_0} - {GACCDUDATE.PAYCUR_0} - {GACCDUDATE.TMPCUR_0} >= MtTotEcheanceFacture then
                            (
                                EcheanceReste := {GACCDUDATE.AMTCUR_0} - {GACCDUDATE.PAYCUR_0} - {GACCDUDATE.TMPCUR_0} - MtTotEcheanceFacture;
                                MtAcptEcheance := 0;
                            )
                            else
                            (
                                MtAcptEcheance := MtTotEcheanceFacture - ({GACCDUDATE.AMTCUR_0} - {GACCDUDATE.PAYCUR_0} - {GACCDUDATE.TMPCUR_0});
                                EcheanceReste := 0;
                            );
                        );   
                        //71937 Adaptation multi-législations
                        //if {@SiPlus4Ech} then
                        //  TotMtReste := TotMtReste + EcheanceReste
                        //else 
                          //if {GACCDUDATE.DUDLIG_0} <6.00 then
                          EcheanceReste
                        ;
                        
                        
                        
                        
                        

        Field:    NbInit
            Formula:    //Formule : NbInit
                        //Nb échéance traitée
                        shared numbervar NbEch := 0 ;
                        shared numbervar TotMtReste := 0 ;
                        //71937 Adaptation multi-législations
                        shared numbervar TotMtEch   := 0 ;
                        shared stringvar TxtEchNo4  :=' ';

        Field:    NbEchAdd
            Formula:    //Formule NbEchAdd
                        WhilePrintingRecords;
                        shared numbervar NbEch ;
                        
                        //Ajout de 1 sur Nb échéance
                        //71937 Adaptation multi-législations 
                        //NbEch := NbEch + 1;
                        If {TABPAM.LEG_0}=maximum({TABPAM.LEG_0},{TABPAM.PAM_0}) Then
                            NbEch := NbEch + 1;
                        
                        if {GACCDUDATE.DUDLIG_0} >0.00 then
                         ' ' ;
                        

        Field:    EditDat
            Formula:    // Edition date 
                        {GACCDUDATE.DUDDAT_0}

        Field:    EditMtEchDet
            Formula:    WhilePrintingRecords;
                        local numbervar MtEch := 0;
                        //71937 Adaptation multi-législations
                        //shared numbervar TotMtEch;
                        
                        MtEch := {GACCDUDATE.AMTCUR_0}  ;
                        //71937 Adaptation multi-législations 
                        //if {@SiPlus4Ech} then
                        //  TotMtEch := TotMtEch + MtEch
                        //else 
                          MtEch
                        ;
                        

        Field:    NbEch
            Formula:    //Nb échéance traitée
                        shared numbervar NbEch
                        

        Field:    SiPlus4Ech
            Formula:    //{GACCDUDATE.DUDLIG_0} >4.00
                        {@NbEch} >4
                        

        Field:    TotMtEch
            Formula:    //71937 Adaptation multi-législations
                        WhilePrintingRecords;
                        shared numbervar TotMtEch;
                         
                        if {@SiPlus4Ech} and {TABPAM.LEG_0}=maximum({TABPAM.LEG_0},{TABPAM.PAM_0}) then
                          TotMtEch := TotMtEch + {@EditMtEchDet};

        Field:    TotMtReste
            Formula:    //71937 Adaptation multi-législations
                        WhilePrintingRecords;
                        //Totalisation des échéances restantes
                        shared numbervar TotMtReste ;
                        
                        if {@SiPlus4Ech} and {TABPAM.LEG_0}=maximum({TABPAM.LEG_0},{TABPAM.PAM_0}) then
                          TotMtReste := TotMtReste + {@EditMtResteDet};

        Field:    TxtEchNo4
            Formula:    //71937 Lors de la déclinaison multi-législation
                        WhilePrintingRecords;
                        shared numbervar NbEch;
                        shared stringvar TxtEchNo4;
                        
                        If NbEch = 5 and {TABPAM.LEG_0}=maximum({TABPAM.LEG_0},{TABPAM.PAM_0}) Then 
                          TxtEchNo4 := {AVWTEXTRA.TEXTE_0};
                        

        Field:    afficheSdd2
            Formula:    if {?Pm-@afficheSdd} then true 

    Unused Formula Fields

        Field:    EditCurTot
            Formula:    // Edition devise si Nb ech > 4 , sinon rien 
                        if {@SiPlus4Ech} then
                          {TABCUR.CUR_0}
                        

        Field:    EditDat5
            Formula:    // Edition de la date s'il y a 5 échéances
                        if not{@SiPlus5Ech} then
                          {GACCDUDATE.DUDDAT_0}
                        

        Field:    EditMtEchTot
            Formula:    // Edition du total autres échéances si Nb ech > 5 , sinon rien 
                        if {@SiPlus4Ech} then
                          shared numbervar TotMtEch
                        

        Field:    EditMtResteTot
            Formula:    // Edition du total autres échéances restantes si Nb ech > 4 , sinon rien 
                        if {@SiPlus4Ech} then
                            shared numbervar TotMtReste
                        

        Field:    SiPlus5Ech
            Formula:    //{GACCDUDATE.DUDLIG_0} >5.00
                        {@NbEch} >5
                        

        Field:    Txtintitfin
            Formula:    WhilePrintingRecords;
                        //71937 Lors de la déclinaison multi-législation
                        shared stringvar TxtEchNo4;
                        //shared stringVar Int_AutresEch      := TextOfChapter ({?X3DOS},"FRA",2281,117); 
                        shared stringVar Int_AutresEch      := TextOfChapter ({?X3DOS},{?Pm-SINVOICEV.LAN_0},2281,117); 
                        //stringVar X3TEX := "ATABDIV~LNGDES~3~"+{ATABDIV.CODE_0}+"~"; //71937
                        shared numbervar NbEch ;
                        
                        // Edition de 'x autres échéances' si Nb ech > 5 , sinon editon du mode de reglement
                        if {@SiPlus5Ech} then
                           totext(NbEch-4,0) + ' '  + Int_AutresEch
                        else
                          //71937 Adaptation multi-législation  
                          //X3TranslatedText ({?X3DOS},{?Pm-SINVOICEV.LAN_0},X3TEX) 
                          TxtEchNo4;
                        

    Report Header

        Section:    Section a

            Fields

                Field:    NUM01
                    Data Source:    {GACCDUDATE.NUM_0}
                    Data Type:    String

            Text Fields

                Text Field:    Text5
                    Text:    Listado de condiciones de pago con mandato

                Text Field:    Text4
                    Text:    Factura :

        Section:    Section b

            Fields

                Field:    NbInit1
                    Data Source:    {@NbInit}
                    Data Type:    String

        Section:    Section c

            Text Fields

                Text Field:    Texte34
                    Text:    Fecha vto

                Text Field:    Text1
                    Text:    Importe vto

                Text Field:    Text3
                    Text:    Resto a pagar

                Text Field:    Text6
                    Text:    Modo de pago

                Text Field:    Text2
                    Text:    Referencia mandato
                    Suppression Formula:    not  {@afficheSdd2} 

            Boxes

                Box:    Box1
                    Ends in Section:    Section3
                    Size:    702x186
                    Line Type:    Single
                    Line Thickness:    0

            Lines

                Line:    Line3
                    Ends in Section:    Section1
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line4
                    Ends in Section:    Section3
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line5
                    Ends in Section:    Section3
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line6
                    Ends in Section:    Section1
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line7
                    Ends in Section:    Section3
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line1
                    Ends in Section:    Section3
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line2
                    Ends in Section:    Section3
                    Line Type:    Single
                    Line Thickness:    0

                Line:    Line8
                    Ends in Section:    Section3
                    Line Type:    Single
                    Line Thickness:    0

    Groups

        Group:    Group #1
            Grouped By:    {GACCDUDATE.DUDDAT_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNameDUDDAT0weekly1
                            Data Source:    GroupName ({GACCDUDATE.DUDDAT_0}, "weekly")
                            Data Type:    String

        Group:    Group #2
            Grouped By:    {GACCDUDATE.DUDLIG_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNameDUDLIG01
                            Data Source:    GroupName ({GACCDUDATE.DUDLIG_0})
                            Data Type:    String

        Group:    Group #3
            Grouped By:    {TABPAM.PAM_0}

            Group Header

                Section:    Section a

                    Fields

                        Field:    GroupNamePAM01
                            Data Source:    GroupName ({TABPAM.PAM_0})
                            Data Type:    String

                        Field:    NbEchAdd1
                            Data Source:    {@NbEchAdd}
                            Data Type:    String

    Detail

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    // test plus de 4 echeances
                                //71937 Adaptation multi-législation
                                //{@SiPlus4Ech}
                                {TABPAM.LEG_0}<>maximum({TABPAM.LEG_0},{TABPAM.PAM_0});

            Fields

                Field:    Champ2
                    Data Source:    {@txtintit}
                    Data Type:    String

                Field:    Champ4
                    Data Source:    {TABCUR.CUR_0}
                    Data Type:    String

                Field:    Echeancerestante1
                    Data Source:    {@EditMtResteDet}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5 555 555,

                Field:    CUR01
                    Data Source:    {TABCUR.CUR_0}
                    Data Type:    String

                Field:    EditDat1
                    Data Source:    {@EditDat}
                    Data Type:    Date
                    Format:    Date and Time
                        Order:    Date Time
                        Date Type:    Custom
                        Date Format:    DD/MM/YYYY hh:mm:ss  AM

                Field:    EditMtEchDet1
                    Data Source:    {@EditMtEchDet}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    TotMtEch1
                    Data Source:    {@TotMtEch}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    TotMtReste1
                    Data Source:    {@TotMtReste}
                    Data Type:    Number
                    Format:    Number
                        Currency Symbol:    None
                        Suppress if Zero:    False
                        Leading Zero:    True
                        Reverse Sign:    False
                        Number Style:    -5.555.555,

                Field:    TxtEchNo41
                    Data Source:    {@TxtEchNo4}
                    Data Type:    String

                Field:    UMRNUM01
                    Data Source:    {GACCDUDATE.UMRNUM_0}
                    Data Type:    String
                    Suppression Formula:    not  {@afficheSdd2} 

    Report Footer

        Section:    Section a

            Conditional Formulas

                Condition:    EnableSuppress
                    Formula:    // test plus de 4 echeances
                                not {@SiPlus4Ech}
                                